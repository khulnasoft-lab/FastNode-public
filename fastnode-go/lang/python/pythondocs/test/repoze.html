

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>repoze.who 2.2 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
  
    <link rel="top" title="None" href="index.html#document-index"/>
 
<!-- RTD Extra Head -->



<!-- 
Read the Docs is acting as the canonical URL for your project. 
If you want to change it, more info is available in our docs:
  http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://repozewho.readthedocs.org/en/latest/" />

<script type="text/javascript">
  // This is included here because other places don't have access to the pagename variable.
  var READTHEDOCS_DATA = {
    project: "repozewho",
    version: "latest",
    language: "en",
    page: "index",
    builder: "sphinx",
    theme: "sphinx_rtd_theme",
    docroot: "/docs/",
    source_suffix: ".rst",
    api_host: "https://readthedocs.org",
    commit: "873722d0d12ca95f9fb97ca896913e841bedba8f"
  }
  // Old variables
  var doc_version = "latest";
  var doc_slug = "repozewho";
  var page_name = "index";
  var html_theme = "sphinx_rtd_theme";
</script>
<!-- RTD Analytics Code -->
<!-- Included in the header because you don't have a footer block. -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- end RTD Analytics Code -->
<!-- end RTD <extrahead> -->


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html#document-index" class="fa fa-home"> repoze.who</a>
        
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-narr"><tt class="docutils literal"><span class="pre">repoze.who</span></tt> Narrative Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-narr#using-repoze-who-as-wsgi-middleware">Using <tt class="docutils literal"><span class="pre">repoze.who</span></tt> as WSGI Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-narr#using-repoze-who-without-wsgi-middleware">Using <tt class="docutils literal"><span class="pre">repoze.who</span></tt> without WSGI Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-narr#mixing-middleware-and-api-uses">Mixing Middleware and API Uses</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-narr#configuring-repoze-who">Configuring <tt class="docutils literal"><span class="pre">repoze.who</span></tt></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-use_cases"><tt class="docutils literal"><span class="pre">repoze.who</span></tt> Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-use_cases#middleware-only-use-cases">Middleware-Only Use Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-use_cases#api-only-use-cases">API-Only Use Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-use_cases#hybrid-use-cases">Hybrid Use Cases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-middleware">Using <tt class="docutils literal"><span class="pre">repoze.who</span></tt> Middleware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-middleware#middleware-responsibilities">Middleware Responsibilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-middleware#lifecycle-of-a-request">Lifecycle of a Request</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api">Using the <tt class="docutils literal"><span class="pre">repoze.who</span></tt> Application Programming Interface (API)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-api#using-repoze-who-without-middleware">Using <tt class="docutils literal"><span class="pre">repoze.who</span></tt> without Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-api#mixed-use-of-repoze-who-middleware-and-api">Mixed Use of <tt class="docutils literal"><span class="pre">repoze.who</span></tt> Middleware and API</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-api#writing-a-custom-login-view">Writing a Custom Login View</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-api#interfaces">Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-configuration">Configuring <tt class="docutils literal"><span class="pre">repoze.who</span></tt></a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-configuration#id1">Configuration Points</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-configuration#module-repoze.who.middleware">Configuring <tt class="docutils literal"><span class="pre">repoze.who</span></tt> via Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-configuration#configuring-repoze-who-via-config-file">Configuring <tt class="docutils literal"><span class="pre">repoze.who</span></tt> via Config File</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-plugins">About <tt class="docutils literal"><span class="pre">repoze.who</span></tt> Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-plugins#plugin-types">Plugin Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-plugins#default-plugin-implementations">Default Plugin Implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-plugins#writing-repoze-who-plugins">Writing <tt class="docutils literal"><span class="pre">repoze.who</span></tt> Plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-plugins#known-plugins-for-repoze-who">Known Plugins for <tt class="docutils literal"><span class="pre">repoze.who</span></tt></a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-plugins#plugins-shipped-with-repoze-who">Plugins shipped with <tt class="docutils literal"><span class="pre">repoze.who</span></tt></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-plugins#deprecated-plugins">Deprecated plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-plugins#third-party-plugins">Third-party Plugins</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-changes">repoze.who Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#unreleased">Unreleased</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id1">2.2 (2013-05-17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id2">2.1 (2013-03-20)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#b1-2012-11-05">2.1b1 (2012-11-05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id3">2.0 (2011-09-28)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#b1-2011-05-24">2.0b1 (2011-05-24)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#a4-2011-02-02">2.0a4 (2011-02-02)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#a3-2010-09-30">2.0a3 (2010-09-30)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#a2-2010-03-25">2.0a2 (2010-03-25)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#a1-2010-02-24">2.0a1 (2010-02-24)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id6">1.0.18 (2009-11-05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id7">1.0.17 (2009-11-05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id8">1.0.16 (2009-11-04)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id9">1.0.15 (2009-06-25)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id10">1.0.14 (2009-06-17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id11">1.0.13 (2009-04-24)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id12">1.0.12 (2009-04-19)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id13">1.0.11 (2009-04-10)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id14">1.0.10 (2009-01-23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id15">1.0.9 (2008-12-18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id16">1.0.8 (2008-12-13)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id17">1.0.7 (2008-08-28)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id18">1.0.6 (2008-08-28)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id19">1.0.5 (2008-08-23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id20">1.0.4 (2008-08-22)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id21">1.0.3 (2008-08-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id22">1.0.2 (2008-06-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id23">1.0.1 (2008-05-24)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id24">1.0 (2008-05-04)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id25">0.9.1 (2008-04-27)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id26">0.9 (2008-04-01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id27">0.8 (2008-03-27)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id28">0.7 (2008-03-26)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id29">0.6 (2008-03-20)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id30">0.5 (2008-03-09)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id31">0.4 (03-07-2008)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id32">0.3 (03-05-2008)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id33">0.2 (03-04-2008)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-changes#id34">0.1 (02-27-2008)</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html#document-index">repoze.who</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html#document-index">Docs</a> &raquo;</li>
      
    <li>repoze.who 2.2 documentation</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://github.com/repoze/repoze.who/blob/master/docs/index.rst" class="fa fa-github"> Edit on GitHub</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="repoze-who-wsgi-authentication-middleware">
<span id="index"></span><h1><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> &#8211; WSGI Authentication Middleware<a class="headerlink" href="#repoze-who-wsgi-authentication-middleware" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Chris McDonough / Tres Seaver</td>
</tr>
<tr class="field-even field"><th class="field-name">Version:</th><td class="field-body">2.2</td>
</tr>
</tbody>
</table>
<span class="target" id="module-repoze.who"></span><div class="topic">
<p class="topic-title first">Overview</p>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> is an identification and authentication framework
for arbitrary WSGI applications.  It can be used as WSGI middleware,
or as an API from within a WSGI application.</p>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> is inspired by Zope 2&#8217;s Pluggable Authentication
Service (PAS) (but <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> is not dependent on Zope in any
way; it is useful for any WSGI application).  It provides no
facility for authorization (ensuring whether a user can or cannot
perform the operation implied by the request).  This is considered
to be the domain of the WSGI application.</p>
<p>It attempts to reuse implementations from <tt class="docutils literal"><span class="pre">paste.auth</span></tt> for some
of its functionality.</p>
</div>
<div class="section" id="sections">
<h2>Sections<a class="headerlink" href="#sections" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-narr"></span><div class="section" id="repoze-who-narrative-documentation">
<h3><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> Narrative Documentation<a class="headerlink" href="#repoze-who-narrative-documentation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="using-repoze-who-as-wsgi-middleware">
<h4>Using <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> as WSGI Middleware<a class="headerlink" href="#using-repoze-who-as-wsgi-middleware" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> was originally developed for use as authentication
middleware in a WSGI pipeline, for use by applications which only
needed to obtain an &#8220;authenticated user&#8221; to enforce a given security
policy.</p>
<p>See <a class="reference internal" href="index.html#middleware-responsibilities"><em>Middleware Responsibilities</em></a> for a description of this use case.</p>
</div>
<div class="section" id="using-repoze-who-without-wsgi-middleware">
<h4>Using <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> without WSGI Middleware<a class="headerlink" href="#using-repoze-who-without-wsgi-middleware" title="Permalink to this headline">¶</a></h4>
<p>Some applications might want to use a configured set of
<a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> plugins to do identification and authentication for
a request, outside the context of using <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> middleware.
For example, a performance-sensitive application might wish to defer
the effort of identifying and authenticating a user until the point at
which authorization is required, knowing that some code paths will not
need to do the work.</p>
<p>See <a class="reference internal" href="index.html#api-narrative"><em>Using the repoze.who Application Programming Interface (API)</em></a> for a description of this use case.</p>
</div>
<div class="section" id="mixing-middleware-and-api-uses">
<h4>Mixing Middleware and API Uses<a class="headerlink" href="#mixing-middleware-and-api-uses" title="Permalink to this headline">¶</a></h4>
<p>Some applications might use the <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> middleware for most
authentication purposes, but need to participate more directly in the
mechanics of identification and authorization for some portions of the
application.  For example, consider a system which allows users to
sign up online for membrship in a site: once the user completes
registration, such an application might wish to log the user in
transparently, and thus needs to interact with the configured
<a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> middleware to generate response headers, ensuring
that the user&#8217;s next request is properly authenticated.</p>
<p>See <a class="reference internal" href="index.html#middleware-api-hybrid"><em>Mixed Use of repoze.who Middleware and API</em></a> for a description of this use case.</p>
</div>
<div class="section" id="configuring-repoze-who">
<h4>Configuring <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a><a class="headerlink" href="#configuring-repoze-who" title="Permalink to this headline">¶</a></h4>
<p>Developers and integrators can configure <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> using either
imperative Python code (see <a class="reference internal" href="index.html#imperative-configuration"><em>Configuring repoze.who via Python Code</em></a>) or using an
INI-style declarative configuration file (see <a class="reference internal" href="index.html#declarative-configuration"><em>Configuring repoze.who via Config File</em></a>).
In either case, the result of the configuration will be a
<tt class="xref py py-class docutils literal"><span class="pre">repoze.who.api:APIFactory</span></tt> instance, complete with a request
classifier, a challenge decider, and a set of plugins for each plugin
interface.</p>
</div>
</div>
<span id="document-use_cases"></span><div class="section" id="repoze-who-use-cases">
<h3><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> Use Cases<a class="headerlink" href="#repoze-who-use-cases" title="Permalink to this headline">¶</a></h3>
<p>How should an application interact with <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a>?  There are three
main scenarios:</p>
<div class="section" id="middleware-only-use-cases">
<h4>Middleware-Only Use Cases<a class="headerlink" href="#middleware-only-use-cases" title="Permalink to this headline">¶</a></h4>
<p>Examples of using the <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> middleware, without explicitly
using its API.</p>
<div class="section" id="simple-bug-tracker-with-remote-user">
<h5>Simple:  Bug Tracker with <tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt><a class="headerlink" href="#simple-bug-tracker-with-remote-user" title="Permalink to this headline">¶</a></h5>
<p>This application expects the <tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt> variable to be set by
the middleware for authenticated requests.  It allows the middleware to
handle challenging the user when needed.</p>
<p>In protected views, such as those which allow creating or following up
to bug reports:</p>
<ul class="simple">
<li>Check <tt class="docutils literal"><span class="pre">environ['REMOTE_USER']</span></tt> to get the authenticated user, and apply
any application-specific policy (who is allowed to edit).<ul>
<li>If the access check fails because the user is not yet authenticated,
return an 401 Unauthorized response.</li>
<li>If the access check fails for authenticated users, return a
403 Forbidden response.</li>
</ul>
</li>
</ul>
<p>Note that the application here doesn&#8217;t depend on <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> at
all:  it would work identically if run behind Apache&#8217;s <tt class="docutils literal"><span class="pre">mod_auth</span></tt>.  The
<tt class="docutils literal"><span class="pre">Trac</span></tt> application works exactly this way.</p>
<p>The middleware can be configured to suit the policy required for the
site, e.g.:</p>
<ul class="simple">
<li>challenge / identify using HTTP basic authentication</li>
<li>authorize via an <tt class="docutils literal"><span class="pre">.htaccces</span></tt>-style file.</li>
</ul>
</div>
<div class="section" id="more-complex-wiki-with-repoze-who-identity">
<h5>More complex:  Wiki with <tt class="docutils literal"><span class="pre">repoze.who.identity</span></tt><a class="headerlink" href="#more-complex-wiki-with-repoze-who-identity" title="Permalink to this headline">¶</a></h5>
<p>This application use the <tt class="docutils literal"><span class="pre">repoze.who.identity</span></tt> variable set in the
WSGI environment by the middleware for authenticated requests.  The application
still allows the middleware to handle challenging the user when needed.</p>
<p>The only difference from the previous example is that protected views,
such as those which allow adding or editing wiki pages, can use the extra
metadata stored inside <tt class="docutils literal"><span class="pre">environ['repoze.who.identity']</span></tt> (a mapping) to
make authorization decisions:  such metadata might include groups or roles
mapped by the middleware onto the user.</p>
</div>
</div>
<div class="section" id="api-only-use-cases">
<h4>API-Only Use Cases<a class="headerlink" href="#api-only-use-cases" title="Permalink to this headline">¶</a></h4>
<p>Examples of using the <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> API without its middleware.</p>
<div class="section" id="simple-wiki-with-its-own-login-and-logout-views">
<h5>Simple:   Wiki with its own login and logout views.<a class="headerlink" href="#simple-wiki-with-its-own-login-and-logout-views" title="Permalink to this headline">¶</a></h5>
<p>This application uses the <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> API to compute the authenticated
user, as well as using its <tt class="docutils literal"><span class="pre">remember</span></tt> API to set headers for cookie-based
authentication.</p>
<p>In each view:</p>
<ul class="simple">
<li>Call <tt class="docutils literal"><span class="pre">api.authenticate</span></tt> to get the authenticated user.</li>
<li>Show a <tt class="docutils literal"><span class="pre">login</span></tt> link for non-authenticated requests.</li>
<li>Show a <tt class="docutils literal"><span class="pre">logout</span></tt> link for authenticated requests.</li>
<li>Don&#8217;t show &#8220;protected&#8221; links for non-authenticated requests.</li>
</ul>
<p>In protected views, such as those which allow adding or editing
wiki pages:</p>
<ul class="simple">
<li>Call <tt class="docutils literal"><span class="pre">api.authenticate</span></tt> to get the authenticated user;  check
the metadata about the user (e.g., any appropriate roles or groups)
to verify access.<ul>
<li>If the access check fails because the user is not yet authenticated,
redirect to the <tt class="docutils literal"><span class="pre">login</span></tt> view, with a <tt class="docutils literal"><span class="pre">came_from</span></tt> value of the
current URL.</li>
<li>If the access check fails for authenticated users, return a
403 Forbidden response.</li>
</ul>
</li>
</ul>
<p>In the login view:</p>
<ul class="simple">
<li>For <tt class="docutils literal"><span class="pre">GET</span></tt> requests, show the login form.</li>
<li>For <tt class="docutils literal"><span class="pre">POST</span></tt> requests, validate the login and password from the form.
If successful, call <tt class="docutils literal"><span class="pre">api.remember</span></tt>, and append the returned headers to
your response, which may also contain, e.g., a <tt class="docutils literal"><span class="pre">Location</span></tt> header for
a redirect to the <tt class="docutils literal"><span class="pre">came_from</span></tt> URL.  In this case, there will be
no authenticator plugin which knows about the login / password at all.</li>
</ul>
<p>In the logout view:</p>
<ul class="simple">
<li>Call <tt class="docutils literal"><span class="pre">api.forget</span></tt> and append the headers to your response, which may
also contain, e.g., a <tt class="docutils literal"><span class="pre">Location</span></tt> header for a redirect to the
<tt class="docutils literal"><span class="pre">came_from</span></tt> URL after logging out.</li>
</ul>
</div>
<div class="section" id="more-complex-multiple-applications-with-single-sign-on">
<h5>More complex:  multiple applications with &#8220;single sign-on&#8221;<a class="headerlink" href="#more-complex-multiple-applications-with-single-sign-on" title="Permalink to this headline">¶</a></h5>
<p>In this scenario, authentication is &#8220;federated&#8221; across multiple applications,
which delegate to a central &#8220;login application.&#8221;  This application verifies
credentials from the user, and then uses headers or other tokens to
communicate the verified identity to the delegating application.</p>
<p>In the login application:</p>
<ul class="simple">
<li>The SSO login application works just like the login view described above:
the difference is that the configured identifier plugins must emit
headers from <tt class="docutils literal"><span class="pre">remember</span></tt> which can be recognized by their counterparts
in the other apps.</li>
</ul>
<p>In the non-login applications:</p>
<ul class="simple">
<li>Challenge plugins here must be configured to implement the specific
SSO protocol, e.g. redirect to the login app with information in the
query string (other protocols might differ).</li>
<li>Identifer plugins must be able to &#8220;crack&#8221; / consume whatever tokens are
returned by the SSO login app.</li>
<li>Authenticators will normally be no-ops (e.g., the <tt class="docutils literal"><span class="pre">auth_tkt</span></tt> plugin
used as an authenticator).</li>
</ul>
</div>
</div>
<div class="section" id="hybrid-use-cases">
<h4>Hybrid Use Cases<a class="headerlink" href="#hybrid-use-cases" title="Permalink to this headline">¶</a></h4>
<p>Examples of using the <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> API in conjuntion with its middleware.</p>
<div class="section" id="most-complex-integrate-trac-and-the-wiki-behind-sso">
<h5>Most complex:  integrate Trac and the wiki behind SSO<a class="headerlink" href="#most-complex-integrate-trac-and-the-wiki-behind-sso" title="Permalink to this headline">¶</a></h5>
<p>This example extends the previous one, but adds into the mix the
requirement that one or more of the non-login applications (e.g., Trac)
be used &#8220;off the shelf,&#8221; without modifying them.  Such applications can
be plugged into the same SSO regime, with the addition of the
:mod:<tt class="docutils literal"><span class="pre">repoze.who</span></tt> middleware as an adapter to bridge the gap (e.g.,
to turn the SSO tokens into the <tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt> required by Trac).</p>
<p>In this scenario, the middleware would be configured identically to the
API used in applications which do not need the middleware shim.</p>
</div>
</div>
</div>
<span id="document-middleware"></span><div class="section" id="using-repoze-who-middleware">
<span id="using-middleware"></span><h3>Using <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> Middleware<a class="headerlink" href="#using-repoze-who-middleware" title="Permalink to this headline">¶</a></h3>
<div class="section" id="middleware-responsibilities">
<span id="id1"></span><h4>Middleware Responsibilities<a class="headerlink" href="#middleware-responsibilities" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> as middleware has one major function on ingress: it
conditionally places identification and authentication information
(including a <tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt> value) into the WSGI environment and
allows the request to continue to a downstream WSGI application.</p>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> as middleware has one major function on egress: it
examines the headers set by the downstream application, the WSGI
environment, or headers supplied by other plugins and conditionally
challenges for credentials.</p>
</div>
<div class="section" id="lifecycle-of-a-request">
<span id="request-lifecycle"></span><h4>Lifecycle of a Request<a class="headerlink" href="#lifecycle-of-a-request" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> performs duties both on middleware &#8220;ingress&#8221; and on
middleware &#8220;egress&#8221;. The following graphic outlines where it sits in the context
of the request and its response:</p>
<img alt="_images/request-lifecycle.png" src="_images/request-lifecycle.png" />
<div class="section" id="request-ingress-stages">
<span id="ingress-stages"></span><h5>Request (Ingress) Stages<a class="headerlink" href="#request-ingress-stages" title="Permalink to this headline">¶</a></h5>
<img alt="_images/ingress.png" src="_images/ingress.png" />
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> performs the following operations in the following
order during middleware ingress:</p>
<ol class="arabic">
<li><p class="first">Environment Setup</p>
<p>The middleware adds a number of keys to the WSGI environment:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repoze.who.plugins</span></tt></dt>
<dd><p class="first last">A reference to the configured plugin set.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">repoze.who.logger</span></tt></dt>
<dd><p class="first last">A reference to the logger configured into the middleware.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">repoze.who.application</span></tt></dt>
<dd><p class="first last">A refererence to the &#8220;right-hand&#8221; application.  The plugins
consulted during request classification / identification /
authentication may replace this application with another
WSGI application, which will be used for the remainer of the
current request.</p>
</dd>
</dl>
</li>
<li><p class="first">Request Classification</p>
<p>The middleware hands the WSGI environment to the configured <tt class="docutils literal"><span class="pre">classifier</span></tt>
plugin, which is responsible for classifying the request into a single
&#8220;type&#8221;.  This plugin must return a single string value classifying the
request, e.g., &#8220;browser&#8221;, &#8220;xml-rpc&#8221;, &#8220;webdav&#8221;, etc.</p>
<p>This classification may serve to filter out plugins consulted later in
the request.  For instance, a plugin which issued a challenge as an
HTML form would be inappropriate for use in requests from an XML-RPC
or WebDAV client.</p>
</li>
<li><p class="first">Identification</p>
<p>Each plugin configured as an identifier for a particular class of
request is called to extract identity data (&#8220;credentials&#8221;) from the
WSGI environment.</p>
<p>For example, a basic auth identifier might use
the <tt class="docutils literal"><span class="pre">HTTP_AUTHORIZATION</span></tt> header to find login and password
information.  Each configured identifier plugin is consulted in turn,
and any non-None identities returned are collected into a list to be
authenticated.</p>
<p>Identifiers are also responsible for providing header information used
to set and remove authentication information in the response during
egress (to &#8220;remember&#8221; or &#8220;forget&#8221; the currently-authenticated user).</p>
</li>
<li><p class="first">Authentication</p>
<p>The middlware consults each plugin configured as an authenticators for
a particular class of request, to compare credentials extracted by the
identification plugins to a given policy, or set of valid credentials.</p>
<p>For example, an htpasswd authenticator might look in a file for a user
record matching any of the extracted credentials.  If it finds one, and
if the password listed in the record matches the password in the
identity, the userid of the user would be returned (which would
be the same as the login name).  Successfully-authenticated ndenties are
&#8220;weighted&#8221;, with the highest weight identity governing the remainder of
the request.</p>
</li>
<li><p class="first">Metadata Assignment</p>
<p>After identifying and authenticating a user, <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> consults
plugins configured as metadata providers, which may augmented the
authenticated identity with arbitrary metadata.</p>
<p>For example, a metadata provider plugin might add the user&#8217;s first,
middle and last names to the identity.  A more specialized metadata
provider might augment the identity with a list of role or group names
assigned to the user.</p>
</li>
</ol>
</div>
<div class="section" id="response-egress-stages">
<span id="egress-stages"></span><h5>Response (Egress) Stages<a class="headerlink" href="#response-egress-stages" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> performs the following operations in the following
order during middleware egress:</p>
<ol class="arabic">
<li><p class="first">Challenge Decision</p>
<p>The middleare examines the WSGI environment and the status and headers
returned by the downstream application to determine whether a
challenge is required.  Typically, only the status is used:  if it
starts with <tt class="docutils literal"><span class="pre">401</span></tt>, a challenge is required, and the challenge
decider returns True.</p>
<p>This behavior can be replaced by configuring a different
<tt class="docutils literal"><span class="pre">challenge_decider</span></tt> plugin for the middleware.</p>
<p>If a challenge is required, the challenge decider returns True; otherwise,
it returns False.</p>
</li>
<li><p class="first">Credentials reset, AKA &#8220;forgetting&#8221;</p>
<p>If the challenge decider returns True, the middleware first delegates
to the identifier plugin which provided the currently-authenticated
identity to &#8220;forget&#8221; the identity, by adding response headers (e.g., to
expire a cookie).</p>
</li>
<li><p class="first">Challenge</p>
<p>The plugin then consults each of the set of plugins configured as
challengers for the current request classification:  the first plugin
which returns a non-None WSGI application will be used perform a
challenge.</p>
<p>Challenger plugins may use application-returned headers, the WSGI
environment, and other items to determine what sort of operation
should be performed to actuate the challenge.</p>
</li>
<li><p class="first">Remember</p>
<p>The identifier plugin that the &#8220;best&#8221; set of credentials came from
(if any) will be consulted to &#8220;remember&#8221; these credentials if the
challenge decider returns False.</p>
</li>
</ol>
</div>
</div>
</div>
<span id="document-api"></span><div class="section" id="using-the-repoze-who-application-programming-interface-api">
<span id="api-narrative"></span><h3>Using the <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> Application Programming Interface (API)<a class="headerlink" href="#using-the-repoze-who-application-programming-interface-api" title="Permalink to this headline">¶</a></h3>
<div class="section" id="using-repoze-who-without-middleware">
<span id="without-middleware"></span><h4>Using <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> without Middleware<a class="headerlink" href="#using-repoze-who-without-middleware" title="Permalink to this headline">¶</a></h4>
<p>An application which does not use the <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> middleware needs
to perform two separate tasks to use <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> machinery:</p>
<ul class="simple">
<li>At application startup, it must create an <tt class="xref py py-class docutils literal"><span class="pre">repoze.who.api:APIFactory</span></tt>
instance, populating it with a request classifier, a challenge decider,
and a set of plugins.  It can do this process imperatively
(see <a class="reference internal" href="index.html#imperative-configuration"><em>Configuring repoze.who via Python Code</em></a>), or using a declarative
configuration file (see <a class="reference internal" href="index.html#declarative-configuration"><em>Configuring repoze.who via Config File</em></a>).  For the latter
case, there is a convenience function,
<tt class="xref py py-func docutils literal"><span class="pre">repoze.who.config.make_api_factory_with_config()</span></tt>:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># myapp/run.py</span>
<span class="kn">from</span> <span class="nn">repoze.who.config</span> <span class="kn">import</span> <span class="n">make_api_factory_with_config</span>
<span class="n">who_api_factory</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="n">global_conf</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">who_api_factory</span>
    <span class="n">who_api_factory</span> <span class="o">=</span> <span class="n">make_api_factory_with_config</span><span class="p">(</span><span class="n">global_conf</span><span class="p">,</span>
                                                   <span class="s">&#39;/path/to/who.config&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>When it needs to use the API, it must call the <tt class="docutils literal"><span class="pre">APIFactory</span></tt>, passing
the WSGI environment to it.  The <tt class="docutils literal"><span class="pre">APIFactory</span></tt> returns an object
implementing the <tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces:IRepozeWhoAPI</span></tt> interface.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># myapp/views.py</span>
<span class="kn">from</span> <span class="nn">myapp.run</span> <span class="kn">import</span> <span class="n">who_api_factory</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">who_api</span> <span class="o">=</span> <span class="n">who_api_factory</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>Calling the <tt class="docutils literal"><span class="pre">APIFactory</span></tt> multiple times within the same request is
allowed, and should be very cheap (the API object is cached in the
request environment).</li>
</ul>
</div>
<div class="section" id="mixed-use-of-repoze-who-middleware-and-api">
<span id="middleware-api-hybrid"></span><h4>Mixed Use of <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> Middleware and API<a class="headerlink" href="#mixed-use-of-repoze-who-middleware-and-api" title="Permalink to this headline">¶</a></h4>
<p>An application which uses the <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> middleware may still need
to interact directly with the <tt class="docutils literal"><span class="pre">IRepozeWhoAPI</span></tt> object for some purposes.
In such cases, it should call <tt class="xref py py-func docutils literal"><span class="pre">repoze.who.api:get_api()</span></tt>, passing
the WSGI environment.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">repoze.who.api</span> <span class="kn">import</span> <span class="n">get_api</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">who_api</span> <span class="o">=</span> <span class="n">get_api</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternately, the application might configure the <tt class="docutils literal"><span class="pre">APIFactory</span></tt> at startup,
as above, and then use it to find the API object, or create it if it was
not already created for the current request (e.g. perhaps by the middleware):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">who_api</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">who_api_factory</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-a-custom-login-view">
<span id="writing-custom-login-view"></span><h4>Writing a Custom Login View<a class="headerlink" href="#writing-a-custom-login-view" title="Permalink to this headline">¶</a></h4>
<p><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.api.API</span></tt> provides a helper method to assist developers
who want to control the details of the login view.  The following
BFG example illustrates how this API might be used:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre> <span class="k">def</span> <span class="nf">login_view</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
     <span class="n">message</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

     <span class="n">who_api</span> <span class="o">=</span> <span class="n">get_api</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
     <span class="k">if</span> <span class="s">&#39;form.login&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
         <span class="n">creds</span> <span class="o">=</span> <span class="p">{}</span>
         <span class="n">creds</span><span class="p">[</span><span class="s">&#39;login&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;login&#39;</span><span class="p">]</span>
         <span class="n">creds</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]</span>
         <span class="n">authenticated</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">who_api</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">creds</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">authenticated</span><span class="p">:</span>
             <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

         <span class="n">message</span> <span class="o">=</span> <span class="s">&#39;Invalid login.&#39;</span>
     <span class="k">else</span><span class="p">:</span>
         <span class="c"># Forcefully forget any existing credentials.</span>
         <span class="n">_</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">who_api</span><span class="o">.</span><span class="n">login</span><span class="p">({})</span>

     <span class="n">request</span><span class="o">.</span><span class="n">response_headerlist</span> <span class="o">=</span> <span class="n">headers</span>
     <span class="k">if</span> <span class="s">&#39;REMOTE_USER&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
         <span class="k">del</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;REMOTE_USER&#39;</span><span class="p">]</span>

     <span class="k">return</span> <span class="p">{</span><span class="s">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This application is written as a &#8220;hybrid&#8221;:  the <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> middleware
injects the API object into the WSGI enviornment on each request.</p>
<ul class="simple">
<li>In line 4, this  application extracts the API object from the environ
using <tt class="xref py py-func docutils literal"><span class="pre">repoze.who.api:get_api()</span></tt>.</li>
<li>Lines 6 - 8 fabricate a set of credentials, based on the values the
user entered in the form.</li>
<li>In line 9, the application asks the API to authenticate those credentials,
returning an identity and a set of respones headers.</li>
<li>Lines 10 and 11 handle the case of successful authentication:  in this
case, the application redirects to the site root, setting the headers
returned by the API object, which will &#8220;remember&#8221; the user across requests.</li>
<li>Line 13 is reached on failed login.  In this case, the headers returned
in line 9 will be &#8220;forget&#8221; headers, clearing any existing cookies or other
tokens.</li>
<li>Lines 14 - 16 perform a &#8220;fake&#8221; login, in order to get the &#8220;forget&#8221; headers.</li>
<li>Line 18 sets the &#8220;forget&#8221; headers to clear any authenticated user for
subsequent requests.</li>
<li>Lines 19 - 20 clear any authenticated user for the current request.</li>
<li>Line 22 returns any message about a failed login to the rendering template.</li>
</ul>
</div>
<div class="section" id="interfaces">
<span id="id1"></span><h4>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h4>
<span class="target" id="module-repoze.who.interfaces"></span><dl class="interface">
<dt id="repoze.who.interfaces.IAPIFactory">
<em class="property">interface </em><tt class="descclassname">repoze.who.interfaces.</tt><tt class="descname">IAPIFactory</tt><a class="headerlink" href="#repoze.who.interfaces.IAPIFactory" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="repoze.who.interfaces.IAPIFactory.__call__">
<tt class="descname">__call__</tt><big>(</big><em>environ</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IAPIFactory.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>environ -&gt; IRepozeWhoAPI</p>
</dd></dl>

</dd></dl>

<dl class="interface">
<dt id="repoze.who.interfaces.IAPI">
<em class="property">interface </em><tt class="descclassname">repoze.who.interfaces.</tt><tt class="descname">IAPI</tt><a class="headerlink" href="#repoze.who.interfaces.IAPI" title="Permalink to this definition">¶</a></dt>
<dd><p>Facade for stateful invocation of underlying plugins.</p>
<dl class="method">
<dt id="repoze.who.interfaces.IAPI.authenticate">
<tt class="descname">authenticate</tt><big>(</big><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IAPI.authenticate" title="Permalink to this definition">¶</a></dt>
<dd><p>-&gt;  {identity}</p>
<p>o Return an authenticated identity mapping, extracted from the
request environment.</p>
<p>o If no identity can be authenticated, return None.</p>
<p>o Identity will include at least a &#8216;repoze.who.userid&#8217; key,
as well as any keys added by metadata plugins.</p>
</dd></dl>

<dl class="method">
<dt id="repoze.who.interfaces.IAPI.forget">
<tt class="descname">forget</tt><big>(</big><em>identity=None</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IAPI.forget" title="Permalink to this definition">¶</a></dt>
<dd><p>-&gt; [headers]</p>
<p>O Return a sequence of response headers which suffice to destroy
any credentials used to establish an identity.</p>
<p>o If &#8216;identity&#8217; is not passed, use the identity in the environment.</p>
</dd></dl>

<dl class="method">
<dt id="repoze.who.interfaces.IAPI.challenge">
<tt class="descname">challenge</tt><big>(</big><em>status='403 Forbidden'</em>, <em>app_headers=()</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IAPI.challenge" title="Permalink to this definition">¶</a></dt>
<dd><p>-&gt; wsgi application</p>
<p>o Return a WSGI application which represents a &#8220;challenge&#8221;
(request for credentials) in response to the current request.</p>
</dd></dl>

<dl class="method">
<dt id="repoze.who.interfaces.IAPI.logout">
<tt class="descname">logout</tt><big>(</big><em>identifier_name=None</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IAPI.logout" title="Permalink to this definition">¶</a></dt>
<dd><p>-&gt; (headers)</p>
<p>o This is an API for browser-based application logout.</p>
<dl class="docutils">
<dt>o If &#8216;identifier_name&#8217; is passed, use it to look up the identifier;</dt>
<dd>othewise, use the first configured identifier.</dd>
</dl>
<p>o Returned headers will be &#8220;forget&#8221; headers.</p>
</dd></dl>

<dl class="method">
<dt id="repoze.who.interfaces.IAPI.login">
<tt class="descname">login</tt><big>(</big><em>credentials</em>, <em>identifier_name=None</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IAPI.login" title="Permalink to this definition">¶</a></dt>
<dd><p>-&gt; (identity, headers)</p>
<p>o This is an API for browser-based application login forms.</p>
<dl class="docutils">
<dt>o If &#8216;identifier_name&#8217; is passed, use it to look up the identifier;</dt>
<dd>othewise, use the first configured identifier.</dd>
<dt>o Attempt to authenticate &#8216;credentials&#8217; as though the identifier</dt>
<dd>had extracted them.</dd>
<dt>o On success, &#8216;identity&#8217; will be authenticated mapping, and &#8216;headers&#8217;</dt>
<dd>will be &#8220;remember&#8221; headers.</dd>
<dt>o On failure, &#8216;identity&#8217; will be None, and response_headers will be</dt>
<dd>&#8220;forget&#8221; headers.</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="repoze.who.interfaces.IAPI.remember">
<tt class="descname">remember</tt><big>(</big><em>identity=None</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IAPI.remember" title="Permalink to this definition">¶</a></dt>
<dd><p>-&gt; [headers]</p>
<p>O Return a sequence of response headers which suffice to remember
the given identity.</p>
<p>o If &#8216;identity&#8217; is not passed, use the identity in the environment.</p>
</dd></dl>

</dd></dl>

<dl class="interface">
<dt id="repoze.who.interfaces.IPlugin">
<em class="property">interface </em><tt class="descclassname">repoze.who.interfaces.</tt><tt class="descname">IPlugin</tt><a class="headerlink" href="#repoze.who.interfaces.IPlugin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="interface">
<dt id="repoze.who.interfaces.IRequestClassifier">
<em class="property">interface </em><tt class="descclassname">repoze.who.interfaces.</tt><tt class="descname">IRequestClassifier</tt><a class="headerlink" href="#repoze.who.interfaces.IRequestClassifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends: <a class="reference internal" href="index.html#repoze.who.interfaces.IPlugin" title="repoze.who.interfaces.IPlugin"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IPlugin</span></tt></a></p>
<p>On ingress: classify a request.</p>
<dl class="method">
<dt id="repoze.who.interfaces.IRequestClassifier.__call__">
<tt class="descname">__call__</tt><big>(</big><em>environ</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IRequestClassifier.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>environ -&gt; request classifier string</p>
<p>This interface is responsible for returning a string
value representing a request classification.</p>
<p>o &#8216;environ&#8217; is the WSGI environment.</p>
</dd></dl>

</dd></dl>

<dl class="interface">
<dt id="repoze.who.interfaces.IChallengeDecider">
<em class="property">interface </em><tt class="descclassname">repoze.who.interfaces.</tt><tt class="descname">IChallengeDecider</tt><a class="headerlink" href="#repoze.who.interfaces.IChallengeDecider" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends: <a class="reference internal" href="index.html#repoze.who.interfaces.IPlugin" title="repoze.who.interfaces.IPlugin"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IPlugin</span></tt></a></p>
<p>On egress: decide whether a challenge needs to be presented
to the user.</p>
<dl class="method">
<dt id="repoze.who.interfaces.IChallengeDecider.__call__">
<tt class="descname">__call__</tt><big>(</big><em>environ</em>, <em>status</em>, <em>headers</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IChallengeDecider.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>args -&gt; True | False</p>
<p>o &#8216;environ&#8217; is the WSGI environment.</p>
<dl class="docutils">
<dt>o &#8216;status&#8217; is the HTTP status as returned by the downstream</dt>
<dd>WSGI application.</dd>
<dt>o &#8216;headers&#8217; are the headers returned by the downstream WSGI</dt>
<dd>application.</dd>
</dl>
<p>This interface is responsible for returning True if
a challenge needs to be presented to the user, False otherwise.</p>
</dd></dl>

</dd></dl>

<dl class="interface">
<dt id="repoze.who.interfaces.IIdentifier">
<em class="property">interface </em><tt class="descclassname">repoze.who.interfaces.</tt><tt class="descname">IIdentifier</tt><a class="headerlink" href="#repoze.who.interfaces.IIdentifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends: <a class="reference internal" href="index.html#repoze.who.interfaces.IPlugin" title="repoze.who.interfaces.IPlugin"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IPlugin</span></tt></a></p>
<p>On ingress: Extract credentials from the WSGI environment and
turn them into an identity.</p>
<p>On egress (remember): Conditionally set information in the response headers
allowing the remote system to remember this identity.</p>
<p>On egress (forget): Conditionally set information in the response
headers allowing the remote system to forget this identity (during
a challenge).</p>
<dl class="method">
<dt id="repoze.who.interfaces.IIdentifier.forget">
<tt class="descname">forget</tt><big>(</big><em>environ</em>, <em>identity</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IIdentifier.forget" title="Permalink to this definition">¶</a></dt>
<dd><p>On egress (challenge required):</p>
<p>args -&gt; [ (header-name, header-value), ...] | None</p>
<p>Return a list of headers suitable for allowing the requesting
system to forget the identification information (e.g. a
Set-Cookie header with an expires date in the past).  Return
None if no headers need to be set.  These headers will be
included in the response provided by the challenge app.</p>
</dd></dl>

<dl class="method">
<dt id="repoze.who.interfaces.IIdentifier.identify">
<tt class="descname">identify</tt><big>(</big><em>environ</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IIdentifier.identify" title="Permalink to this definition">¶</a></dt>
<dd><p>On ingress:</p>
<dl class="docutils">
<dt>environ -&gt; {   k1 <span class="classifier-delimiter">:</span> <span class="classifier">v1</span></dt>
<dd>,   ...
, kN : vN
} | None</dd>
</dl>
<p>o &#8216;environ&#8217; is the WSGI environment.</p>
<dl class="docutils">
<dt>o If credentials are found, the returned identity mapping will</dt>
<dd>contain an arbitrary set of key/value pairs.  If the
identity is based on a login and password, the environment
is recommended to contain at least &#8216;login&#8217; and &#8216;password&#8217;
keys as this provides compatibility between the plugin and
existing authenticator plugins.  If the identity can be
&#8216;preauthenticated&#8217; (e.g. if the userid is embedded in the
identity, such as when we&#8217;re using ticket-based
authentication), the plugin should set the userid in the
special &#8216;repoze.who.userid&#8217; key; no authenticators will be
asked to authenticate the identity thereafer.</dd>
<dt>o Return None to indicate that the plugin found no appropriate</dt>
<dd>credentials.</dd>
<dt>o Only IIdentifier plugins which match one of the the current</dt>
<dd>request&#8217;s classifications will be asked to perform
identification.</dd>
<dt>o An identifier plugin is permitted to add a key to the</dt>
<dd>environment named &#8216;repoze.who.application&#8217;, which should be
an arbitrary WSGI application.  If an identifier plugin does
so, this application is used instead of the downstream
application set up within the middleware.  This feature is
useful for identifier plugins which need to perform
redirection to obtain credentials.  If two identifier
plugins add a &#8216;repoze.who.application&#8217; WSGI application to
the environment, the last one consulted will&#8221;win&#8221;.</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="repoze.who.interfaces.IIdentifier.remember">
<tt class="descname">remember</tt><big>(</big><em>environ</em>, <em>identity</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IIdentifier.remember" title="Permalink to this definition">¶</a></dt>
<dd><p>On egress (no challenge required):</p>
<p>args -&gt; [ (header-name, header-value), ...] | None</p>
<p>Return a list of headers suitable for allowing the requesting
system to remember the identification information (e.g. a
Set-Cookie header).  Return None if no headers need to be set.
These headers will be appended to any headers returned by the
downstream application.</p>
</dd></dl>

</dd></dl>

<dl class="interface">
<dt id="repoze.who.interfaces.IAuthenticator">
<em class="property">interface </em><tt class="descclassname">repoze.who.interfaces.</tt><tt class="descname">IAuthenticator</tt><a class="headerlink" href="#repoze.who.interfaces.IAuthenticator" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends: <a class="reference internal" href="index.html#repoze.who.interfaces.IPlugin" title="repoze.who.interfaces.IPlugin"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IPlugin</span></tt></a></p>
<p>On ingress: validate the identity and return a user id or None.</p>
<dl class="method">
<dt id="repoze.who.interfaces.IAuthenticator.authenticate">
<tt class="descname">authenticate</tt><big>(</big><em>environ</em>, <em>identity</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IAuthenticator.authenticate" title="Permalink to this definition">¶</a></dt>
<dd><p>identity -&gt; &#8216;userid&#8217; | None</p>
<p>o &#8216;environ&#8217; is the WSGI environment.</p>
<dl class="docutils">
<dt>o &#8216;identity&#8217; will be a dictionary (with arbitrary keys and</dt>
<dd>values).</dd>
<dt>o The IAuthenticator should return a single user id (optimally</dt>
<dd>a string) if the identity can be authenticated.  If the
identify cannot be authenticated, the IAuthenticator should
return None.</dd>
</dl>
<p>Each instance of a registered IAuthenticator plugin that
matches the request classifier will be called N times during a
single request, where N is the number of identities found by
any IIdentifierPlugin instances.</p>
<p>An authenticator must not raise an exception if it is provided
an identity dictionary that it does not understand (e.g. if it
presumes that &#8216;login&#8217; and &#8216;password&#8217; are keys in the
dictionary, it should check for the existence of these keys
before attempting to do anything; if they don&#8217;t exist, it
should return None).</p>
<p>An authenticator is permitted to add extra keys to the &#8216;identity&#8217;
dictionary (e.g., to save metadata from a database query, rather
than requiring a separate query from an IMetadataProvider plugin).</p>
</dd></dl>

</dd></dl>

<dl class="interface">
<dt id="repoze.who.interfaces.IChallenger">
<em class="property">interface </em><tt class="descclassname">repoze.who.interfaces.</tt><tt class="descname">IChallenger</tt><a class="headerlink" href="#repoze.who.interfaces.IChallenger" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends: <a class="reference internal" href="index.html#repoze.who.interfaces.IPlugin" title="repoze.who.interfaces.IPlugin"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IPlugin</span></tt></a></p>
<p>On egress: Conditionally initiate a challenge to the user to
provide credentials.</p>
<p>Only challenge plugins which match one of the the current
response&#8217;s classifications will be asked to perform a
challenge.</p>
<dl class="method">
<dt id="repoze.who.interfaces.IChallenger.challenge">
<tt class="descname">challenge</tt><big>(</big><em>environ</em>, <em>status</em>, <em>app_headers</em>, <em>forget_headers</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IChallenger.challenge" title="Permalink to this definition">¶</a></dt>
<dd><p>args -&gt; WSGI application or None</p>
<p>o &#8216;environ&#8217; is the WSGI environment.</p>
<dl class="docutils">
<dt>o &#8216;status&#8217; is the status written into start_response by the</dt>
<dd>downstream application.</dd>
<dt>o &#8216;app_headers&#8217; is the headers list written into start_response by the</dt>
<dd>downstream application.</dd>
<dt>o &#8216;forget_headers&#8217; is a list of headers which must be passed</dt>
<dd>back in the response in order to perform credentials reset
(logout).  These come from the &#8216;forget&#8217; method of
IIdentifier plugin used to do the request&#8217;s identification.</dd>
</dl>
<p>Examine the values passed in and return a WSGI application
(a callable which accepts environ and start_response as its
two positional arguments, ala PEP 333) which causes a
challenge to be performed.  Return None to forego performing a
challenge.</p>
</dd></dl>

</dd></dl>

<dl class="interface">
<dt id="repoze.who.interfaces.IMetadataProvider">
<em class="property">interface </em><tt class="descclassname">repoze.who.interfaces.</tt><tt class="descname">IMetadataProvider</tt><a class="headerlink" href="#repoze.who.interfaces.IMetadataProvider" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends: <a class="reference internal" href="index.html#repoze.who.interfaces.IPlugin" title="repoze.who.interfaces.IPlugin"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IPlugin</span></tt></a></p>
<p>On ingress: When an identity is authenticated, metadata
providers may scribble on the identity dictionary arbitrarily.
Return values from metadata providers are ignored.</p>
<dl class="method">
<dt id="repoze.who.interfaces.IMetadataProvider.add_metadata">
<tt class="descname">add_metadata</tt><big>(</big><em>environ</em>, <em>identity</em><big>)</big><a class="headerlink" href="#repoze.who.interfaces.IMetadataProvider.add_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Add metadata to the identity (which is a dictionary).  One
value is always guaranteed to be in the dictionary when
add_metadata is called: &#8216;repoze.who.userid&#8217;, representing the
user id of the identity.  Availability and composition of
other keys will depend on the identifier plugin which created
the identity.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-configuration"></span><div class="section" id="configuring-repoze-who">
<span id="configuration-points"></span><h3>Configuring <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a><a class="headerlink" href="#configuring-repoze-who" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>Configuration Points<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="section" id="classifiers">
<h5>Classifiers<a class="headerlink" href="#classifiers" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> &#8220;classifies&#8221; the request on middleware ingress.
Request classification happens before identification and
authentication.  A request from a browser might be classified a
different way than a request from an XML-RPC client.
<a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> uses request classifiers to decide which other
components to consult during subsequent identification,
authentication, and challenge steps.  Plugins are free to advertise
themselves as willing to participate in identification and
authorization for a request based on this classification.  The request
classification system is pluggable.  <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> provides a
default classifier that you may use.</p>
<p>You may extend the classification system by making <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> aware
of a different request classifier implementation.</p>
</div>
<div class="section" id="challenge-deciders">
<h5>Challenge Deciders<a class="headerlink" href="#challenge-deciders" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> uses a &#8220;challenge decider&#8221; to decide whether the
response returned from a downstream application requires a challenge
plugin to fire.  When using the default challenge decider, only the
status is used (if it starts with <tt class="docutils literal"><span class="pre">401</span></tt>, a challenge is required).</p>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> also provides an alternate challenge decider,
<tt class="docutils literal"><span class="pre">repoze.who.classifiers.passthrough_challenge_decider</span></tt>, which avoids
challenging <tt class="docutils literal"><span class="pre">401</span></tt> responses which have been &#8220;pre-challenged&#8221; by the
application.</p>
<p>You may supply a different challenge decider as necessary.</p>
</div>
<div class="section" id="plugins">
<h5>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> has core functionality designed around the concept
of plugins.  Plugins are instances that are willing to perform one or
more identification- and/or authentication-related duties.  Each
plugin can be configured arbitrarily.</p>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> consults the set of configured plugins when it
intercepts a WSGI request, and gives some subset of them a chance to
influence what <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> does for the current request.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As of <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> 1.0.7, the <tt class="docutils literal"><span class="pre">repoze.who.plugins</span></tt>
package is a namespace package, intended to make it possible for
people to ship eggs which are who plugins as,
e.g. <tt class="docutils literal"><span class="pre">repoze.who.plugins.mycoolplugin</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="module-repoze.who.middleware">
<span id="configuring-repoze-who-via-python-code"></span><span id="imperative-configuration"></span><h4>Configuring <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> via Python Code<a class="headerlink" href="#module-repoze.who.middleware" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="repoze.who.middleware.PluggableAuthenticationMiddleware">
<em class="property">class </em><tt class="descclassname">repoze.who.middleware.</tt><tt class="descname">PluggableAuthenticationMiddleware</tt><big>(</big><em>app</em>, <em>identifiers</em>, <em>challengers</em>, <em>authenticators</em>, <em>mdproviders</em>, <em>classifier</em>, <em>challenge_decider</em><span class="optional">[</span>, <em>log_stream=None</em><span class="optional">[</span>, <em>log_level=logging.INFO</em><span class="optional">[</span>, <em>remote_user_key='REMOTE_USER'</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#repoze.who.middleware.PluggableAuthenticationMiddleware" title="Permalink to this definition">¶</a></dt>
<dd><p>The primary method of configuring the <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> middleware is
to use straight Python code, meant to be consumed by frameworks
which construct and compose middleware pipelines without using a
configuration file.</p>
<p>In the middleware constructor: <em>app</em> is the &#8220;next&#8221; application in
the WSGI pipeline. <em>identifiers</em> is a sequence of <tt class="docutils literal"><span class="pre">IIdentifier</span></tt>
plugins, <em>challengers</em> is a sequence of <tt class="docutils literal"><span class="pre">IChallenger</span></tt> plugins,
<em>mdproviders</em> is a sequence of <tt class="docutils literal"><span class="pre">IMetadataProvider</span></tt> plugins.  Any
of these can be specified as the empty sequence.  <em>classifier</em> is a
request classifier callable, <em>challenge_decider</em> is a challenge
decision callable.  <em>log_stream</em> is a stream object (an object with
a <tt class="docutils literal"><span class="pre">write</span></tt> method) <em>or</em> a <tt class="docutils literal"><span class="pre">logging.Logger</span></tt> object, <em>log_level</em> is
a numeric value that maps to the <tt class="docutils literal"><span class="pre">logging</span></tt> module&#8217;s notion of log
levels, <em>remote_user_key</em> is the key in which the <tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt>
(userid) value should be placed in the WSGI environment for
consumption by downstream applications.</p>
</dd></dl>

<p>An example configuration which uses the default plugins follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">repoze.who.middleware</span> <span class="kn">import</span> <span class="n">PluggableAuthenticationMiddleware</span>
<span class="kn">from</span> <span class="nn">repoze.who.interfaces</span> <span class="kn">import</span> <span class="n">IIdentifier</span>
<span class="kn">from</span> <span class="nn">repoze.who.interfaces</span> <span class="kn">import</span> <span class="n">IChallenger</span>
<span class="kn">from</span> <span class="nn">repoze.who.plugins.basicauth</span> <span class="kn">import</span> <span class="n">BasicAuthPlugin</span>
<span class="kn">from</span> <span class="nn">repoze.who.plugins.auth_tkt</span> <span class="kn">import</span> <span class="n">AuthTktCookiePlugin</span>
<span class="kn">from</span> <span class="nn">repoze.who.plugins.redirector</span> <span class="kn">import</span> <span class="n">RedirectorPlugin</span>
<span class="kn">from</span> <span class="nn">repoze.who.plugins.htpasswd</span> <span class="kn">import</span> <span class="n">HTPasswdPlugin</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="n">salt</span> <span class="o">=</span> <span class="s">&#39;aa&#39;</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">password</span> <span class="ow">in</span> <span class="p">[</span> <span class="p">(</span><span class="s">&#39;admin&#39;</span><span class="p">,</span> <span class="s">&#39;admin&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;chris&#39;</span><span class="p">,</span> <span class="s">&#39;chris&#39;</span><span class="p">)</span> <span class="p">]:</span>
    <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
<span class="n">io</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cleartext_check</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">hashed</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">password</span> <span class="o">==</span> <span class="n">hashed</span>
<span class="n">htpasswd</span> <span class="o">=</span> <span class="n">HTPasswdPlugin</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">cleartext_check</span><span class="p">)</span>
<span class="n">basicauth</span> <span class="o">=</span> <span class="n">BasicAuthPlugin</span><span class="p">(</span><span class="s">&#39;repoze.who&#39;</span><span class="p">)</span>
<span class="n">auth_tkt</span> <span class="o">=</span> <span class="n">AuthTktCookiePlugin</span><span class="p">(</span><span class="s">&#39;secret&#39;</span><span class="p">,</span> <span class="s">&#39;auth_tkt&#39;</span><span class="p">)</span>
<span class="n">redirector</span> <span class="o">=</span> <span class="n">RedirectorPlugin</span><span class="p">(</span><span class="s">&#39;/login.html&#39;</span><span class="p">)</span>
<span class="n">redirector</span><span class="o">.</span><span class="n">classifications</span> <span class="o">=</span> <span class="p">{</span><span class="n">IChallenger</span><span class="p">:[</span><span class="s">&#39;browser&#39;</span><span class="p">],}</span> <span class="c"># only for browser</span>
<span class="n">identifiers</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;auth_tkt&#39;</span><span class="p">,</span> <span class="n">auth_tkt</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&#39;basicauth&#39;</span><span class="p">,</span> <span class="n">basicauth</span><span class="p">)]</span>
<span class="n">authenticators</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;auth_tkt&#39;</span><span class="p">,</span> <span class="n">auth_tkt</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;htpasswd&#39;</span><span class="p">,</span> <span class="n">htpasswd</span><span class="p">)]</span>
<span class="n">challengers</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;redirector&#39;</span><span class="p">,</span> <span class="n">redirector</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&#39;basicauth&#39;</span><span class="p">,</span> <span class="n">basicauth</span><span class="p">)]</span>
<span class="n">mdproviders</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kn">from</span> <span class="nn">repoze.who.classifiers</span> <span class="kn">import</span> <span class="n">default_request_classifier</span>
<span class="kn">from</span> <span class="nn">repoze.who.classifiers</span> <span class="kn">import</span> <span class="n">default_challenge_decider</span>
<span class="n">log_stream</span> <span class="o">=</span> <span class="bp">None</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;WHO_LOG&#39;</span><span class="p">):</span>
    <span class="n">log_stream</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

<span class="n">middleware</span> <span class="o">=</span> <span class="n">PluggableAuthenticationMiddleware</span><span class="p">(</span>
    <span class="n">app</span><span class="p">,</span>
    <span class="n">identifiers</span><span class="p">,</span>
    <span class="n">authenticators</span><span class="p">,</span>
    <span class="n">challengers</span><span class="p">,</span>
    <span class="n">mdproviders</span><span class="p">,</span>
    <span class="n">default_request_classifier</span><span class="p">,</span>
    <span class="n">default_challenge_decider</span><span class="p">,</span>
    <span class="n">log_stream</span> <span class="o">=</span> <span class="n">log_stream</span><span class="p">,</span>
    <span class="n">log_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The above example configures the repoze.who middleware with:</p>
<ul class="simple">
<li>Two <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> plugins (auth_tkt cookie, and a
basic auth plugin).  In this setup, when &#8220;identification&#8221; needs to
be performed, the auth_tkt plugin will be checked first, then
the basic auth plugin.  The application is responsible for handling
login via a form:  this view would use the API (via <a href="#id2"><span class="problematic" id="id3">:method:`remember`</span></a>)
to generate apprpriate response headers.</li>
<li>Two <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt> plugins: the auth_tkt plugin and an htpasswd plugin.
The auth_tkt plugin performs both <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> and <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt>
functions.  The htpasswd plugin is configured with two valid username /
password combinations: chris/chris, and admin/admin.  When an username
and password is found via any identifier, it will be checked against this
authenticator.</li>
<li>Two <tt class="docutils literal"><span class="pre">IChallenger</span></tt> plugins: the redirector plugin, then the basic auth
plugin.  The redirector auth will fire if the request is a <tt class="docutils literal"><span class="pre">browser</span></tt>
request, otherwise the basic auth plugin will fire.</li>
</ul>
<p>The rest of the middleware configuration is for values like logging
and the classifier and decider implementations.  These use the &#8220;stock&#8221;
implementations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">app</span></tt> referred to in the example is the &#8220;downstream&#8221;
WSGI application that who is wrapping.</p>
</div>
</div>
<div class="section" id="configuring-repoze-who-via-config-file">
<span id="declarative-configuration"></span><h4>Configuring <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> via Config File<a class="headerlink" href="#configuring-repoze-who-via-config-file" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> may be configured using a ConfigParser-style .INI
file.  The configuration file has five main types of sections: plugin
sections, a general section, an identifiers section, an authenticators
section, and a challengers section.  Each &#8220;plugin&#8221; section defines a
configuration for a particular plugin.  The identifiers,
authenticators, and challengers sections refer to these plugins to
form a site configuration.  The general section is general middleware
configuration.</p>
<p>To configure <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> in Python, using an .INI file, call
the <cite>make_middleware_with_config</cite> entry point, passing the right-hand
application, the global configuration dictionary, and the path to the
config file. The global configuration dictionary is a dictonary passed
by PasteDeploy. The only key &#8216;make_middleware_with_config&#8217; needs is
&#8216;here&#8217; pointing to the config file directory. For debugging people
might find it useful to enable logging by adding the log_file argument,
e.g. log_file=&#8221;repoze_who.log&#8221;</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">repoze.who.config</span> <span class="kn">import</span> <span class="n">make_middleware_with_config</span>
<span class="n">global_conf</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;here&quot;</span><span class="p">:</span> <span class="s">&quot;.&quot;</span><span class="p">}</span>  <span class="c"># if this is not defined elsewhere</span>
<span class="n">who</span> <span class="o">=</span> <span class="n">make_middleware_with_config</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">global_conf</span><span class="p">,</span> <span class="s">&#39;who.ini&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a>&#8216;s configuration file can be pointed to within a PasteDeploy
configuration file</p>
<div class="highlight-python"><div class="highlight"><pre>[filter:who]
use = egg:repoze.who#config
config_file = %(here)s/who.ini
log_file = stdout
log_level = debug
</pre></div>
</div>
<p>Below is an example of a configuration file (what <tt class="docutils literal"><span class="pre">config_file</span></tt>
might point at above ) that might be used to configure the
<a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> middleware.  A set of plugins are defined, and they
are referred to by following non-plugin sections.</p>
<p>In the below configuration, five plugins are defined.  The form, and
basicauth plugins are nominated to act as challenger plugins.  The
form, cookie, and basicauth plugins are nominated to act as
identification plugins.  The htpasswd and sqlusers plugins are
nominated to act as authenticator plugins.</p>
<div class="highlight-python"><div class="highlight"><pre>[plugin:redirector]
# identificaion and challenge
use = repoze.who.plugins.redirector:make_plugin
login_url = /login.html

[plugin:auth_tkt]
# identification and authentication
use = repoze.who.plugins.auth_tkt:make_plugin
secret = s33kr1t
cookie_name = oatmeal
secure = False
include_ip = False

[plugin:basicauth]
# identification and challenge
use = repoze.who.plugins.basicauth:make_plugin
realm = &#39;sample&#39;

[plugin:htpasswd]
# authentication
use = repoze.who.plugins.htpasswd:make_plugin
filename = %(here)s/passwd
check_fn = repoze.who.plugins.htpasswd:crypt_check

[plugin:sqlusers]
# authentication
use = repoze.who.plugins.sql:make_authenticator_plugin
# Note the double %%:  we have to escape it from the config parser in
# order to preserve it as a template for the psycopg2, whose &#39;paramstyle&#39;
# is &#39;pyformat&#39;.
query = SELECT userid, password FROM users where login = %%(login)s
conn_factory = repoze.who.plugins.sql:make_psycopg_conn_factory
compare_fn = repoze.who.plugins.sql:default_password_compare

[plugin:sqlproperties]
name = properties
use = repoze.who.plugins.sql:make_metadata_plugin
# Note the double %%:  we have to escape it from the config parser in
# order to preserve it as a template for the psycopg2, whose &#39;paramstyle&#39;
# is &#39;pyformat&#39;.
query = SELECT firstname, lastname FROM users where userid = %%(__userid)s
filter = my.package:filter_propmd
conn_factory = repoze.who.plugins.sql:make_psycopg_conn_factory

[general]
request_classifier = repoze.who.classifiers:default_request_classifier
challenge_decider = repoze.who.classifiers:default_challenge_decider
remote_user_key = REMOTE_USER

[identifiers]
# plugin_name;classifier_name:.. or just plugin_name (good for any)
plugins =
      auth_tkt
      basicauth

[authenticators]
# plugin_name;classifier_name.. or just plugin_name (good for any)
plugins =
      auth_tkt
      htpasswd
      sqlusers

[challengers]
# plugin_name;classifier_name:.. or just plugin_name (good for any)
plugins =
      redirector;browser
      basicauth

[mdproviders]
plugins =
      sqlproperties
</pre></div>
</div>
<p>The basicauth section configures a plugin that does identification and
challenge for basic auth credentials.  The redirector section configures a
plugin that does challenges.  The auth_tkt section configures a plugin that
does identification for cookie auth credentials, as well as authenticating
them.  The htpasswd plugin obtains its user info from a file.  The sqlusers
plugin obtains its user info from a Postgres database.</p>
<p>The identifiers section provides an ordered list of plugins that are
willing to provide identification capability.  These will be consulted
in the defined order.  The tokens on each line of the <tt class="docutils literal"><span class="pre">plugins=</span></tt> key
are in the form &#8220;plugin_name;requestclassifier_name:...&#8221;  (or just
&#8220;plugin_name&#8221; if the plugin can be consulted regardless of the
classification of the request).  The configuration above indicates
that the system will look for credentials using the auth_tkt cookie
identifier (unconditionally), then the basic auth plugin
(unconditionally).</p>
<p>The authenticators section provides an ordered list of plugins that
provide authenticator capability.  These will be consulted in the
defined order, so the system will look for users in the file, then in
the sql database when attempting to validate credentials.  No
classification prefixes are given to restrict which of the two plugins
are used, so both plugins are consulted regardless of the
classification of the request.  Each authenticator is called with each
set of identities found by the identifier plugins.  The first identity
that can be authenticated is used to set <tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt>.</p>
<p>The mdproviders section provides an ordered list of plugins that
provide metadata provider capability.  These will be consulted in the
defined order.  Each will have a chance (on ingress) to provide add
metadata to the authenticated identity.  Our example mdproviders
section shows one plugin configured: &#8220;sqlproperties&#8221;.  The
sqlproperties plugin will add information related to user properties
(e.g. first name and last name) to the identity dictionary.</p>
<p>The challengers section provides an ordered list of plugins that
provide challenger capability.  These will be consulted in the defined
order, so the system will consult the cookie auth plugin first, then
the basic auth plugin.  Each will have a chance to initiate a
challenge.  The above configuration indicates that the redirector challenger
will fire if it&#8217;s a browser request, and the basic auth challenger
will fire if it&#8217;s not (fallback).</p>
</div>
</div>
<span id="document-plugins"></span><div class="section" id="about-repoze-who-plugins">
<span id="about-plugins"></span><h3>About <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> Plugins<a class="headerlink" href="#about-repoze-who-plugins" title="Permalink to this headline">¶</a></h3>
<div class="section" id="plugin-types">
<h4>Plugin Types<a class="headerlink" href="#plugin-types" title="Permalink to this headline">¶</a></h4>
<div class="section" id="identifier-plugins">
<h5>Identifier Plugins<a class="headerlink" href="#identifier-plugins" title="Permalink to this headline">¶</a></h5>
<p>You can register a plugin as willing to act as an &#8220;identifier&#8221;.  An
identifier examines the WSGI environment and attempts to extract
credentials from the environment.  These credentials are used by
authenticator plugins to perform authentication.</p>
</div>
<div class="section" id="authenticator-plugins">
<h5>Authenticator Plugins<a class="headerlink" href="#authenticator-plugins" title="Permalink to this headline">¶</a></h5>
<p>You may register a plugin as willing to act as an &#8220;authenticator&#8221;.
Authenticator plugins are responsible for resolving a set of
credentials provided by an identifier plugin into a user id.
Typically, authenticator plugins will perform a lookup into a database
or some other persistent store, check the provided credentials against
the stored data, and return a user id if the credentials can be
validated.</p>
<p>The user id provided by an authenticator is eventually passed to
downstream WSGI applications in the &#8220;REMOTE_USER&#8217; environment
variable.  Additionally, the &#8220;identity&#8221; of the user (as provided by
the identifier from whence the identity came) is passed along to
downstream application in the <tt class="docutils literal"><span class="pre">repoze.who.identity</span></tt> environment
variable.</p>
</div>
<div class="section" id="metadata-provider-plugins">
<h5>Metadata Provider Plugins<a class="headerlink" href="#metadata-provider-plugins" title="Permalink to this headline">¶</a></h5>
<p>You may register a plugin as willing to act as a &#8220;metadata provider&#8221;
(aka mdprovider).  Metadata provider plugins are responsible for
adding arbitrary information to the identity dictionary for
consumption by downstream applications.  For instance, a metadata
provider plugin may add &#8220;group&#8221; information to the the identity.</p>
</div>
<div class="section" id="challenger-plugins">
<h5>Challenger Plugins<a class="headerlink" href="#challenger-plugins" title="Permalink to this headline">¶</a></h5>
<p>You may register a plugin as willing to act as a &#8220;challenger&#8221;.
Challenger plugins are responsible for initiating a challenge to the
requesting user.  Challenger plugins are invoked by <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> when it
decides a challenge is necessary. A challenge might consist of
displaying a form or presenting the user with a basic or digest
authentication dialog.</p>
</div>
</div>
<div class="section" id="default-plugin-implementations">
<span id="default-plugins"></span><h4>Default Plugin Implementations<a class="headerlink" href="#default-plugin-implementations" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> ships with a variety of default plugins that do
authentication, identification, challenge and metadata provision.</p>
<span class="target" id="module-repoze.who.plugins.auth_tkt"></span><dl class="class">
<dt id="repoze.who.plugins.auth_tkt.AuthTktCookiePlugin">
<em class="property">class </em><tt class="descclassname">repoze.who.plugins.auth_tkt.</tt><tt class="descname">AuthTktCookiePlugin</tt><big>(</big><em>secret</em><span class="optional">[</span>, <em>cookie_name='auth_tkt'</em><span class="optional">[</span>, <em>secure=False</em><span class="optional">[</span>, <em>include_ip=False</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#repoze.who.plugins.auth_tkt.AuthTktCookiePlugin" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference internal" href="index.html#repoze.who.plugins.auth_tkt.AuthTktCookiePlugin" title="repoze.who.plugins.auth_tkt.AuthTktCookiePlugin"><tt class="xref py py-class docutils literal"><span class="pre">AuthTktCookiePlugin</span></tt></a> is an <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> and <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt>
plugin which remembers its identity state in a client-side cookie.
This plugin uses the <tt class="docutils literal"><span class="pre">paste.auth.auth_tkt</span></tt>&#8220;auth ticket&#8221; protocol.
It should be instantiated passing a <em>secret</em>, which is used to encrypt the
cookie on the client side and decrypt the cookie on the server side.
The cookie name used to store the cookie value can be specified
using the <em>cookie_name</em> parameter.  If <em>secure</em> is False, the cookie
will be sent across any HTTP or HTTPS connection; if it is True, the
cookie will be sent only across an HTTPS connection.  If
<em>include_ip</em> is True, the <tt class="docutils literal"><span class="pre">REMOTE_ADDR</span></tt> of the WSGI environment
will be placed in the cookie.</p>
<p>Normally, using the plugin as an identifier requires also using it as
an authenticator.</p>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using the <em>include_ip</em> setting for public-facing applications may
cause problems for some users.  <a class="reference external" href="http://westpoint.ltd.uk/advisories/Paul_Johnston_GSEC.pdf">One study</a> reports
that as many as 3% of users change their IP addresses legitimately
during a session.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Plugin supports remembering user data in the cookie by saving user dict into <tt class="docutils literal"><span class="pre">identity['userdata']</span></tt>
parameter of <tt class="docutils literal"><span class="pre">remember</span></tt> method. They are sent unencrypted and protected by checksum.
Data will then be returned every time by <tt class="docutils literal"><span class="pre">identify</span></tt>. This dict must be compatible with
<tt class="docutils literal"><span class="pre">urllib.urlencode</span></tt> function (<tt class="docutils literal"><span class="pre">urllib.urlparse.urlencode</span></tt> in python 3).
Saving keys/values with unicode characters is supported only under python 3.</p>
</div>
<span class="target" id="module-repoze.who.plugins.basicauth"></span><dl class="class">
<dt id="repoze.who.plugins.basicauth.BasicAuthPlugin">
<em class="property">class </em><tt class="descclassname">repoze.who.plugins.basicauth.</tt><tt class="descname">BasicAuthPlugin</tt><big>(</big><em>realm</em><big>)</big><a class="headerlink" href="#repoze.who.plugins.basicauth.BasicAuthPlugin" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="index.html#repoze.who.plugins.basicauth.BasicAuthPlugin" title="repoze.who.plugins.basicauth.BasicAuthPlugin"><tt class="xref py py-class docutils literal"><span class="pre">BasicAuthPlugin</span></tt></a> plugin is both an <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> and
<tt class="docutils literal"><span class="pre">IChallenger</span></tt> plugin that implements the Basic Access
Authentication scheme described in <span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2617.html"><strong>RFC 2617</strong></a>.  It looks for
credentials within the <tt class="docutils literal"><span class="pre">HTTP-Authorization</span></tt> header sent by
browsers.  It challenges by sending an <tt class="docutils literal"><span class="pre">WWW-Authenticate</span></tt> header
to the browser.  The single argument <em>realm</em> indicates the basic
auth realm that should be sent in the <tt class="docutils literal"><span class="pre">WWW-Authenticate</span></tt> header.</p>
</dd></dl>

<span class="target" id="module-repoze.who.plugins.htpasswd"></span><dl class="class">
<dt id="repoze.who.plugins.htpasswd.HTPasswdPlugin">
<em class="property">class </em><tt class="descclassname">repoze.who.plugins.htpasswd.</tt><tt class="descname">HTPasswdPlugin</tt><big>(</big><em>filename</em>, <em>check</em><big>)</big><a class="headerlink" href="#repoze.who.plugins.htpasswd.HTPasswdPlugin" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="index.html#repoze.who.plugins.htpasswd.HTPasswdPlugin" title="repoze.who.plugins.htpasswd.HTPasswdPlugin"><tt class="xref py py-class docutils literal"><span class="pre">HTPasswdPlugin</span></tt></a> is an <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt> implementation
which compares identity information against an Apache-style htpasswd
file.  The <em>filename</em> argument should be an absolute path to the
htpasswd file&#8217; the <em>check</em> argument is a callable which takes two
arguments: &#8220;password&#8221; and &#8220;hashed&#8221;, where the &#8220;password&#8221; argument is
the unencrypted password provided by the identifier plugin, and the
hashed value is the value stored in the htpasswd file.  If the
hashed value of the password matches the hash, this callable should
return True.  A default implementation named <tt class="docutils literal"><span class="pre">crypt_check</span></tt> is
available for use as a check function (on UNIX) as
<tt class="docutils literal"><span class="pre">repoze.who.plugins.htpasswd:crypt_check</span></tt>; it assumes the values
in the htpasswd file are encrypted with the UNIX <tt class="docutils literal"><span class="pre">crypt</span></tt> function.</p>
</dd></dl>

<span class="target" id="module-repoze.who.plugins.redirector"></span><dl class="class">
<dt id="repoze.who.plugins.redirector.RedirectorPlugin">
<em class="property">class </em><tt class="descclassname">repoze.who.plugins.redirector.</tt><tt class="descname">RedirectorPlugin</tt><big>(</big><em>login_url</em>, <em>came_from_param</em>, <em>reason_param</em>, <em>reason_header</em><big>)</big><a class="headerlink" href="#repoze.who.plugins.redirector.RedirectorPlugin" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="index.html#repoze.who.plugins.redirector.RedirectorPlugin" title="repoze.who.plugins.redirector.RedirectorPlugin"><tt class="xref py py-class docutils literal"><span class="pre">RedirectorPlugin</span></tt></a> is an <tt class="docutils literal"><span class="pre">IChallenger</span></tt> plugin.
It redirects to a configured login URL at egress if a challenge is
required .
<em>login_url</em> is the URL that should be redirected to when a
challenge is required.  <em>came_from_param</em> is the name of an optional
query string parameter:  if configured, the plugin provides the current
request URL in the redirected URL&#8217;s query string, using the supplied
parameter name.  <em>reason_param</em> is the name of an optional
query string parameter:  if configured, and the application supplies
a header matching <em>reason_header</em> (defaulting to
<tt class="docutils literal"><span class="pre">X-Authorization-Failure-Reason</span></tt>), the plugin includes that reason in
the query string of the redirected URL, using the supplied parameter name.
<em>reason_header</em> is an optional parameter overriding the default response
header name (<tt class="docutils literal"><span class="pre">X-Authorization-Failure-Reason</span></tt>) which
the plugin checks to find the application-supplied reason for the challenge.
<em>reason_header</em> cannot be set unless <em>reason_param</em> is also set.</p>
</dd></dl>

<span class="target" id="module-repoze.who.plugins.sql"></span><dl class="class">
<dt id="repoze.who.plugins.sql.SQLAuthenticatorPlugin">
<em class="property">class </em><tt class="descclassname">repoze.who.plugins.sql.</tt><tt class="descname">SQLAuthenticatorPlugin</tt><big>(</big><em>query</em>, <em>conn_factory</em>, <em>compare_fn</em><big>)</big><a class="headerlink" href="#repoze.who.plugins.sql.SQLAuthenticatorPlugin" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="index.html#repoze.who.plugins.sql.SQLAuthenticatorPlugin" title="repoze.who.plugins.sql.SQLAuthenticatorPlugin"><tt class="xref py py-class docutils literal"><span class="pre">SQLAuthenticatorPlugin</span></tt></a> is an <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt>
implementation which compares login-password identity information
against data in an arbitrary SQL database.  The <em>query</em> argument
should be a SQL query that returns two columns in a single row
considered to be the user id and the password respectively.  The SQL
query should contain Python-DBAPI style substitution values for
<tt class="docutils literal"><span class="pre">%(login)</span></tt>, e.g. <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">user_id,</span> <span class="pre">password</span> <span class="pre">FROM</span> <span class="pre">users</span> <span class="pre">WHERE</span> <span class="pre">login</span>
<span class="pre">=</span> <span class="pre">%(login)</span></tt>.  The <em>conn_factory</em> argument should be a callable that
returns a DBAPI database connection.  The <em>compare_fn</em> argument
should be a callable that accepts two arguments: <tt class="docutils literal"><span class="pre">cleartext</span></tt> and
<tt class="docutils literal"><span class="pre">stored_password_hash</span></tt>.  It should compare the hashed version of
cleartext and return True if it matches the stored password hash,
otherwise it should return False.  A comparison function named
<tt class="docutils literal"><span class="pre">default_password_compare</span></tt> exists in the
<tt class="docutils literal"><span class="pre">repoze.who.plugins.sql</span></tt> module demonstrating this.  The
<a class="reference internal" href="index.html#repoze.who.plugins.sql.SQLAuthenticatorPlugin" title="repoze.who.plugins.sql.SQLAuthenticatorPlugin"><tt class="xref py py-class docutils literal"><span class="pre">SQLAuthenticatorPlugin</span></tt></a>&#8216;s <tt class="docutils literal"><span class="pre">authenticate</span></tt> method will
return the user id of the user unchanged to <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a>.</p>
</dd></dl>

<dl class="class">
<dt id="repoze.who.plugins.sql.SQLMetadataProviderPlugin">
<em class="property">class </em><tt class="descclassname">repoze.who.plugins.sql.</tt><tt class="descname">SQLMetadataProviderPlugin</tt><big>(</big><em>name</em>, <em>query</em>, <em>conn_factory</em>, <em>filter</em><big>)</big><a class="headerlink" href="#repoze.who.plugins.sql.SQLMetadataProviderPlugin" title="Permalink to this definition">¶</a></dt>
<dd><p>A <tt class="xref py py-class docutils literal"><span class="pre">SQLMetatadaProviderPlugin</span></tt> is an <tt class="docutils literal"><span class="pre">IMetadataProvider</span></tt>
implementation which adds arbitrary metadata to the identity on
ingress using data from an arbitrary SQL database.  The <em>name</em>
argument should be a string.  It will be used as a key in the
identity dictionary.  The <em>query</em> argument should be a SQL query
that returns arbitrary data from the database in a form that accepts
Python-binding style DBAPI arguments.  It should expect that a
<tt class="docutils literal"><span class="pre">__userid</span></tt> value will exist in the dictionary that is bound.  The
SQL query should contain Python-DBAPI style substitution values for
(at least) <tt class="docutils literal"><span class="pre">%(__userid)</span></tt>, e.g. <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">group</span> <span class="pre">FROM</span> <span class="pre">groups</span> <span class="pre">WHERE</span>
<span class="pre">user_id</span> <span class="pre">=</span> <span class="pre">%(__userid)</span></tt>.  The <em>conn_factory</em> argument should be a
callable that returns a DBAPI database connection.  The <em>filter</em>
argument should be a callable that accepts the result of the DBAPI
<tt class="docutils literal"><span class="pre">fetchall</span></tt> based on the SQL query.  It should massage the data
into something that will be set in the environment under the <em>name</em>
key.</p>
</dd></dl>

</div>
<div class="section" id="writing-repoze-who-plugins">
<h4>Writing <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> Plugins<a class="headerlink" href="#writing-repoze-who-plugins" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> can be extended arbitrarily through the creation of
plugins.  Plugins are of one of four types: identifier plugins,
authenticator plugins, metadata provider plugins, and challenge
plugins.</p>
<div class="section" id="writing-an-identifier-plugin">
<h5>Writing An Identifier Plugin<a class="headerlink" href="#writing-an-identifier-plugin" title="Permalink to this headline">¶</a></h5>
<p>An identifier plugin (aka an <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> plugin) must do three
things: extract credentials from the request and turn them into an
&#8220;identity&#8221;, &#8220;remember&#8221; credentials, and &#8220;forget&#8221; credentials.</p>
<p>Here&#8217;s a simple cookie identification plugin that does these three
things</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">InsecureCookiePlugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cookie_name</span> <span class="o">=</span> <span class="n">cookie_name</span>

    <span class="k">def</span> <span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">paste.request</span> <span class="kn">import</span> <span class="n">get_cookies</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="n">get_cookies</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cookie_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cookie</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="kn">import</span> <span class="nn">binascii</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;base64&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">binascii</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span> <span class="c"># can&#39;t decode</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">login</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">&#39;login&#39;</span><span class="p">:</span><span class="n">login</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">:</span><span class="n">password</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="c"># not enough values to unpack</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">remember</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">identity</span><span class="p">):</span>
        <span class="n">cookie_value</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(login)s</span><span class="s">:</span><span class="si">%(password)s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">identity</span>
        <span class="n">cookie_value</span> <span class="o">=</span> <span class="n">cookie_value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;base64&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">paste.request</span> <span class="kn">import</span> <span class="n">get_cookies</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="n">get_cookies</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">existing</span> <span class="o">=</span> <span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cookie_name</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">cookie_value</span><span class="p">:</span>
            <span class="c"># return a Set-Cookie header</span>
            <span class="n">set_cookie</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">; Path=/;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cookie_name</span><span class="p">,</span> <span class="n">cookie_value</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[(</span><span class="s">&#39;Set-Cookie&#39;</span><span class="p">,</span> <span class="n">set_cookie</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">forget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">identity</span><span class="p">):</span>
        <span class="c"># return a expires Set-Cookie header</span>
        <span class="n">expired</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">=&quot;&quot;; Path=/; Expires=Sun, 10-May-1971 11:59:00 GMT&#39;</span> <span class="o">%</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">cookie_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s">&#39;Set-Cookie&#39;</span><span class="p">,</span> <span class="n">expired</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&lt;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="identify">
<h6>.identify<a class="headerlink" href="#identify" title="Permalink to this headline">¶</a></h6>
<p>The <tt class="docutils literal"><span class="pre">identify</span></tt> method of our InsecureCookiePlugin accepts a single
argument &#8220;environ&#8221;.  This will be the WSGI environment dictionary.
Our plugin attempts to grub through the cookies sent by the client,
trying to find one that matches our cookie name.  If it finds one that
matches, it attempts to decode it and turn it into a login and a
password, which it returns as values in a dictionary.  This dictionary
is thereafter known as an &#8220;identity&#8221;.  If it finds no credentials in
cookies, it returns None (which is not considered an identity).</p>
<p>More generally, the <tt class="docutils literal"><span class="pre">identify</span></tt> method of an <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> plugin
is called once on WSGI request &#8220;ingress&#8221;, and it is expected to grub
arbitrarily through the WSGI environment looking for credential
information.  In our above plugin, the credential information is
expected to be in a cookie but credential information could be in a
cookie, a form field, basic/digest auth information, a header, a WSGI
environment variable set by some upstream middleware or whatever else
someone might use to stash authentication information.  If the plugin
finds credentials in the request, it&#8217;s expected to return an
&#8220;identity&#8221;: this must be a dictionary.  The dictionary is not required
to have any particular keys or value composition, although it&#8217;s wise
if the identification plugin looks for both a login name and a
password information to return at least {&#8216;login&#8217;:login_name,
&#8216;password&#8217;:password}, as some authenticator plugins may depend on
presence of the names &#8220;login&#8221; and &#8220;password&#8221; (e.g. the htpasswd and
sql <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt> plugins).  If an <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> plugin finds
no credentials, it is expected to return None.</p>
</div>
<div class="section" id="remember">
<h6>.remember<a class="headerlink" href="#remember" title="Permalink to this headline">¶</a></h6>
<p>If we&#8217;ve passed a REMOTE_USER to the WSGI application during ingress
(as a result of providing an identity that could be authenticated),
and the downstream application doesn&#8217;t kick back with an unauthorized
response, on egress we want the requesting client to &#8220;remember&#8221; the
identity we provided if there&#8217;s some way to do that and if he hasn&#8217;t
already, in order to ensure he will pass it back to us on subsequent
requests without requiring another login.  The remember method of an
<tt class="docutils literal"><span class="pre">IIdentifier</span></tt> plugin is called for each non-unauthenticated
response.  It is the responsibility of the <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> plugin to
conditionally return HTTP headers that will cause the client to
remember the credentials implied by &#8220;identity&#8221;.</p>
<p>Our InsecureCookiePlugin implements the &#8220;remember&#8221; method by returning
headers which set a cookie if and only if one is not already set with
the same name and value in the WSGI environment.  These headers will
be tacked on to the response headers provided by the downstream
application during the response.</p>
<p>When you write a remember method, most of the work involved is
determining <em>whether or not</em> you need to return headers.  It&#8217;s typical
to see remember methods that compute an &#8220;old state&#8221; and a &#8220;new state&#8221;
and compare the two against each other in order to determine if
headers need to be returned.  In our example InsecureCookiePlugin, the
&#8220;old state&#8221; is <tt class="docutils literal"><span class="pre">cookie_value</span></tt> and the &#8220;new state&#8221; is <tt class="docutils literal"><span class="pre">value</span></tt>.</p>
</div>
<div class="section" id="forget">
<h6>.forget<a class="headerlink" href="#forget" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt>Eventually the WSGI application we&#8217;re serving will issue a &#8220;401</dt>
<dd><p class="first">Unauthorized&#8221; or another status signifying that the request could not
be authorized.  <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> intercepts this status and calls
<tt class="docutils literal"><span class="pre">IIdentifier</span></tt> plugins asking them to &#8220;forget&#8221; the credentials
implied by the identity.  It is the &#8220;forget&#8221; method&#8217;s job at this
point to return HTTP headers that will effectively clear any
credentials on the requesting client implied by the &#8220;identity&#8221;
argument.</p>
<p class="last">Our InsecureCookiePlugin implements the &#8220;forget&#8221; method by returning
a header which resets the cookie that was set earlier by the remember
method to one that expires in the past (on my birthday, in fact).
This header will be tacked onto the response headers provided by the
downstream application.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="writing-an-authenticator-plugin">
<h5>Writing an Authenticator Plugin<a class="headerlink" href="#writing-an-authenticator-plugin" title="Permalink to this headline">¶</a></h5>
<p>An authenticator plugin (aka an <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt> plugin) must do
only one thing (on &#8220;ingress&#8221;): accept an identity and check if the
identity is &#8220;good&#8221;.  If the identity is good, it should return a &#8220;user
id&#8221;.  This user id may or may not be the same as the &#8220;login&#8221; provided
by the user.  An <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt> plugin will be called for each
identity found during the identification phase (there may be multiple
identities for a single request, as there may be multiple
<tt class="docutils literal"><span class="pre">IIdentifier</span></tt> plugins active at any given time), so it may be called
multiple times in the same request.</p>
<p>Here&#8217;s a simple authenticator plugin that attempts to match an
identity against ones defined in an &#8220;htpasswd&#8221; file that does just
that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SimpleHTPasswdPlugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>

    <span class="c"># IAuthenticatorPlugin</span>
    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">identity</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">login</span> <span class="o">=</span> <span class="n">identity</span><span class="p">[</span><span class="s">&#39;login&#39;</span><span class="p">]</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">identity</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">username</span><span class="p">,</span> <span class="n">hashed</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">username</span> <span class="o">==</span> <span class="n">login</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">crypt_check</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">hashed</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">username</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">crypt_check</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">hashed</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">crypt</span> <span class="kn">import</span> <span class="n">crypt</span>
    <span class="n">salt</span> <span class="o">=</span> <span class="n">hashed</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">hashed</span> <span class="o">==</span> <span class="n">crypt</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span>
</pre></div>
</div>
<p>An <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt> plugin implements one &#8220;interface&#8221; method:
&#8220;authentictate&#8221;.  The formal specification for the arguments and
return values expected from these methods are available in the
<tt class="docutils literal"><span class="pre">interfaces.py</span></tt> file in <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> as the <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt>
interface, but let&#8217;s examine this method here less formally.</p>
<div class="section" id="authenticate">
<h6>.authenticate<a class="headerlink" href="#authenticate" title="Permalink to this headline">¶</a></h6>
<p>The <tt class="docutils literal"><span class="pre">authenticate</span></tt> method accepts two arguments: the WSGI
environment and an identity.  Our SimpleHTPasswdPlugin
<tt class="docutils literal"><span class="pre">authenticate</span></tt> implementation grabs the login and password out of
the identity and attempts to find the login in the htpasswd file.  If
it finds it, it compares the crypted version of the password provided
by the user to the crypted version stored in the htpasswd file, and
finally, if they match, it returns the login.  If they do not match,
it returns None.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Our plugin&#8217;s <tt class="docutils literal"><span class="pre">authenticate</span></tt> method does not assume that the keys
<tt class="docutils literal"><span class="pre">login</span></tt> or <tt class="docutils literal"><span class="pre">password</span></tt> exist in the identity; although it
requires them to do &#8220;real work&#8221; it returns None if they are not
present instead of raising an exception.  This is required by the
<tt class="docutils literal"><span class="pre">IAuthenticator</span></tt> interface specification.</p>
</div>
</div>
</div>
<div class="section" id="writing-a-challenger-plugin">
<h5>Writing a Challenger Plugin<a class="headerlink" href="#writing-a-challenger-plugin" title="Permalink to this headline">¶</a></h5>
<p>A challenger plugin (aka an <tt class="docutils literal"><span class="pre">IChallenger</span></tt> plugin) must do only one
thing on &#8220;egress&#8221;: return a WSGI application which performs a
&#8220;challenge&#8221;.  A WSGI application is a callable that accepts an
&#8220;environ&#8221; and a &#8220;start_response&#8221; as its parameters; see &#8220;PEP 333&#8221; for
further definition of what a WSGI application is.  A challenge asks
the user for credentials.</p>
<p>Here&#8217;s an example of a simple challenger plugin:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">paste.httpheaders</span> <span class="kn">import</span> <span class="n">WWW_AUTHENTICATE</span>
<span class="kn">from</span> <span class="nn">paste.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPUnauthorized</span>

<span class="k">class</span> <span class="nc">BasicAuthChallengerPlugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">realm</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">realm</span> <span class="o">=</span> <span class="n">realm</span>

    <span class="c"># IChallenger</span>
    <span class="k">def</span> <span class="nf">challenge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">app_headers</span><span class="p">,</span> <span class="n">forget_headers</span><span class="p">):</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">WWW_AUTHENTICATE</span><span class="o">.</span><span class="n">tuples</span><span class="p">(</span><span class="s">&#39;Basic realm=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">realm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">head</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">forget_headers</span><span class="p">:</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">head</span> <span class="o">+</span> <span class="n">forget_headers</span>
        <span class="k">return</span> <span class="n">HTTPUnauthorized</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="n">head</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the plugin implements a single &#8220;interface&#8221; method:
&#8220;challenge&#8221;.  The formal specification for the arguments and return
values expected from this method is available in the &#8220;interfaces.py&#8221;
file in <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> as the <tt class="docutils literal"><span class="pre">IChallenger</span></tt> interface.  This method
is called when <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> determines that the application has
returned an &#8220;unauthorized&#8221; response (e.g. a 401).  Only one challenger
will be consulted during &#8220;egress&#8221; as necessary (the first one to
return a non-None response).</p>
<div class="section" id="challenge">
<h6>.challenge<a class="headerlink" href="#challenge" title="Permalink to this headline">¶</a></h6>
<p>The challenge method takes environ (the WSGI environment), &#8216;status&#8217;
(the status as set by the downstream application), the &#8220;app_headers&#8221;
(headers returned by the application), and the &#8220;forget_headers&#8221;
(headers returned by all participating <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> plugins whom
were asked to &#8220;forget&#8221; this user).</p>
<p>Our BasicAuthChallengerPlugin takes advantage of the fact that the
HTTPUnauthorized exception imported from paste.httpexceptions can be
used as a WSGI application.  It first makes sure that we don&#8217;t repeat
headers if an identification plugin has already set a
&#8220;WWW-Authenticate&#8221; header like ours, then it returns an instance of
HTTPUnauthorized, passing in merged headers.  This will cause a basic
authentication dialog to be presented to the user.</p>
</div>
</div>
<div class="section" id="writing-a-metadata-provider-plugin">
<h5>Writing a Metadata Provider Plugin<a class="headerlink" href="#writing-a-metadata-provider-plugin" title="Permalink to this headline">¶</a></h5>
<p>A metadata provider plugin (aka an <tt class="docutils literal"><span class="pre">IMetadataProvider</span></tt> plugin) must
do only one thing (on &#8220;ingress&#8221;): &#8220;scribble&#8221; on the identity
dictionary provided to it when it is called.  An <tt class="docutils literal"><span class="pre">IMetadataProvider</span></tt>
plugin will be called with the final &#8220;best&#8221; identity found during the
authentication phase, or not at all if no &#8220;best&#8221; identity could be
authenticated.  Thus, each <tt class="docutils literal"><span class="pre">IMetadataProvider</span></tt> plugin will be called
exactly zero or one times during a request.</p>
<p>Here&#8217;s a simple metadata provider plugin that provides &#8220;property&#8221;
information from a dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">_DATA</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;chris&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;first_name&#39;</span><span class="p">:</span><span class="s">&#39;Chris&#39;</span><span class="p">,</span> <span class="s">&#39;last_name&#39;</span><span class="p">:</span><span class="s">&#39;McDonough&#39;</span><span class="p">}</span> <span class="p">,</span>
    <span class="s">&#39;whit&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;first_name&#39;</span><span class="p">:</span><span class="s">&#39;Whit&#39;</span><span class="p">,</span> <span class="s">&#39;last_name&#39;</span><span class="p">:</span><span class="s">&#39;Morriss&#39;</span><span class="p">}</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">SimpleMetadataProvider</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">add_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">identity</span><span class="p">):</span>
        <span class="n">userid</span> <span class="o">=</span> <span class="n">identity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;repoze.who.userid&#39;</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">userid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">identity</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="add-metadata">
<h6>.add_metadata<a class="headerlink" href="#add-metadata" title="Permalink to this headline">¶</a></h6>
<p>Arbitrarily add information to the identity dict based in other data
in the environment or identity.  Our plugin adds <tt class="docutils literal"><span class="pre">first_name</span></tt> and
<tt class="docutils literal"><span class="pre">last_name</span></tt> values to the identity if the userid matches <tt class="docutils literal"><span class="pre">chris</span></tt>
or <tt class="docutils literal"><span class="pre">whit</span></tt>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="known-plugins-for-repoze-who">
<h3>Known Plugins for <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a><a class="headerlink" href="#known-plugins-for-repoze-who" title="Permalink to this headline">¶</a></h3>
<div class="section" id="plugins-shipped-with-repoze-who">
<h4>Plugins shipped with <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a><a class="headerlink" href="#plugins-shipped-with-repoze-who" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="index.html#default-plugins"><em>Default Plugin Implementations</em></a>.</p>
</div>
<div class="section" id="deprecated-plugins">
<h4>Deprecated plugins<a class="headerlink" href="#deprecated-plugins" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="xref py py-mod docutils literal"><span class="pre">repoze.who.deprecatedplugins</span></tt> distribution bundles the following
plugin implementations which were shipped with <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a> prior
to version 2.0a3.  These plugins are deprecated, and should only be used
while migrating an existing deployment to replacement versions.</p>
<dl class="docutils">
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.cookie.InsecureCookiePlugin</span></tt></dt>
<dd>An <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> plugin which stores identification information in an
insecure form (the base64 value of the username and password separated by
a colon) in a client-side cookie.  Please use the
<tt class="xref py py-class docutils literal"><span class="pre">AuthTktCookiePlugin</span></tt> instead.</dd>
</dl>
<p><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.form.FormPlugin</span></tt></p>
<blockquote>
<div><p>An <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> and <tt class="docutils literal"><span class="pre">IChallenger</span></tt> plugin,  which intercepts form POSTs
to gather identification at ingress and conditionally displays a login form
at egress if challenge is required.</p>
<p>Applications should supply their
own login form, and use <tt class="xref py py-class docutils literal"><span class="pre">repoze.who.api.API</span></tt> to authenticate
and remember users.  To replace the challenger role, please use
<a class="reference internal" href="index.html#repoze.who.plugins.redirector.RedirectorPlugin" title="repoze.who.plugins.redirector.RedirectorPlugin"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.redirector.RedirectorPlugin</span></tt></a>, configured with
the URL of your application&#8217;s login form.</p>
</div></blockquote>
<p><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.form.RedirectingFormPlugin</span></tt></p>
<blockquote>
<div><p>An <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> and <tt class="docutils literal"><span class="pre">IChallenger</span></tt> plugin, which intercepts form POSTs
to gather identification at ingress and conditionally redirects a login form
at egress if challenge is required.</p>
<p>Applications should supply their
own login form, and use <tt class="xref py py-class docutils literal"><span class="pre">repoze.who.api.API</span></tt> to authenticate
and remember users.  To replace the challenger role, please use
<a class="reference internal" href="index.html#repoze.who.plugins.redirector.RedirectorPlugin" title="repoze.who.plugins.redirector.RedirectorPlugin"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.redirector.RedirectorPlugin</span></tt></a>, configured with
the URL of your application&#8217;s login form.</p>
</div></blockquote>
</div>
<div class="section" id="third-party-plugins">
<h4>Third-party Plugins<a class="headerlink" href="#third-party-plugins" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.zodb.ZODBPlugin</span></tt></dt>
<dd>This class implements the <a class="reference internal" href="index.html#repoze.who.interfaces.IAuthenticator" title="repoze.who.interfaces.IAuthenticator"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IAuthenticator</span></tt></a>
and <a class="reference internal" href="index.html#repoze.who.interfaces.IMetadataProvider" title="repoze.who.interfaces.IMetadataProvider"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IMetadataProvider</span></tt></a> plugin interfaces
using ZODB database lookups.  See
<a class="reference external" href="http://pypi.python.org/pypi/repoze.whoplugins.zodb/">http://pypi.python.org/pypi/repoze.whoplugins.zodb/</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.ldap.LDAPAuthenticatorPlugin</span></tt></dt>
<dd>This class implements the <a class="reference internal" href="index.html#repoze.who.interfaces.IAuthenticator" title="repoze.who.interfaces.IAuthenticator"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IAuthenticator</span></tt></a>
plugin interface using the <tt class="xref py py-mod docutils literal"><span class="pre">python-ldap</span></tt> library to query an LDAP
database.  See <a class="reference external" href="http://code.gustavonarea.net/repoze.who.plugins.ldap/">http://code.gustavonarea.net/repoze.who.plugins.ldap/</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.ldap.LDAPAttributesPlugin</span></tt></dt>
<dd>This class implements the <a class="reference internal" href="index.html#repoze.who.interfaces.IMetadataProvider" title="repoze.who.interfaces.IMetadataProvider"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IMetadataProvider</span></tt></a>
plugin interface using the <tt class="xref py py-mod docutils literal"><span class="pre">python-ldap</span></tt> library to query an LDAP
database.  See <a class="reference external" href="http://code.gustavonarea.net/repoze.who.plugins.ldap/">http://code.gustavonarea.net/repoze.who.plugins.ldap/</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.friendlyform.FriendlyFormPlugin</span></tt></dt>
<dd><p class="first">This class implements the <a class="reference internal" href="index.html#repoze.who.interfaces.IIdentifier" title="repoze.who.interfaces.IIdentifier"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IIdentifier</span></tt></a> and
<a class="reference internal" href="index.html#repoze.who.interfaces.IChallenger" title="repoze.who.interfaces.IChallenger"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IChallenger</span></tt></a> plugin interfaces.  It is
similar to <tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.form.RedirectingFormPlugin</span></tt>,
bt with with additional features:</p>
<ul class="simple">
<li>Users are not challenged on logout, unless the referrer URL is a
private one (but that’s up to the application).</li>
<li>Developers may define post-login and/or post-logout pages.</li>
<li>In the login URL, the amount of failed logins is available in the
environ. It’s also increased by one on every login try. This counter
will allow developers not using a post-login page to handle logins that
fail/succeed.</li>
</ul>
<p class="last">See <a class="reference external" href="http://code.gustavonarea.net/repoze.who-friendlyform/">http://code.gustavonarea.net/repoze.who-friendlyform/</a></p>
</dd>
<dt><tt class="xref py py-func docutils literal"><span class="pre">repoze.who.plugins.openid.identifiers.OpenIdIdentificationPlugin()</span></tt></dt>
<dd>This class implements the <a class="reference internal" href="index.html#repoze.who.interfaces.IIdentifier" title="repoze.who.interfaces.IIdentifier"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IIdentifier</span></tt></a>,
<a class="reference internal" href="index.html#repoze.who.interfaces.IAuthenticator" title="repoze.who.interfaces.IAuthenticator"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IAuthenticator</span></tt></a>, and
<a class="reference internal" href="index.html#repoze.who.interfaces.IChallenger" title="repoze.who.interfaces.IChallenger"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IChallenger</span></tt></a> plugin interfaces using OpenId.
See <a class="reference external" href="http://quantumcore.org/docs/repoze.who.plugins.openid/">http://quantumcore.org/docs/repoze.who.plugins.openid/</a></dd>
<dt><tt class="xref py py-func docutils literal"><span class="pre">repoze.who.plugins.openid.classifiers.openid_challenge_decider()</span></tt></dt>
<dd>This function provides the <a class="reference internal" href="index.html#repoze.who.interfaces.IChallengeDecider" title="repoze.who.interfaces.IChallengeDecider"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IChallengeDecider</span></tt></a>
interface using OpenId.  See
<a class="reference external" href="http://quantumcore.org/docs/repoze.who.plugins.openid/">http://quantumcore.org/docs/repoze.who.plugins.openid/</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.use_beaker.UseBeakerPlugin</span></tt></dt>
<dd>This packkage provids a <a class="reference internal" href="index.html#repoze.who.interfaces.IIdentifier" title="repoze.who.interfaces.IIdentifier"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IIdentifier</span></tt></a> plugin
using <tt class="xref py py-mod docutils literal"><span class="pre">beaker.session</span></tt> cache.  See
<a class="reference external" href="http://pypi.python.org/pypi/repoze.who-use_beaker/">http://pypi.python.org/pypi/repoze.who-use_beaker/</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.cas.main_plugin.CASChallengePlugin</span></tt></dt>
<dd>This class implements the <a class="reference internal" href="index.html#repoze.who.interfaces.IIdentifier" title="repoze.who.interfaces.IIdentifier"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IIdentifier</span></tt></a>
<a class="reference internal" href="index.html#repoze.who.interfaces.IAuthenticator" title="repoze.who.interfaces.IAuthenticator"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IAuthenticator</span></tt></a>, and
<a class="reference internal" href="index.html#repoze.who.interfaces.IChallenger" title="repoze.who.interfaces.IChallenger"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IChallenger</span></tt></a> plugin interfaces using CAS.
See <a class="reference external" href="http://pypi.python.org/pypi/repoze.who.plugins.cas">http://pypi.python.org/pypi/repoze.who.plugins.cas</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.cas.challenge_decider.my_challenge_decider</span></tt></dt>
<dd>This function provides the <a class="reference internal" href="index.html#repoze.who.interfaces.IChallengeDecider" title="repoze.who.interfaces.IChallengeDecider"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IChallengeDecider</span></tt></a>
interface using CAS.  See
<a class="reference external" href="http://pypi.python.org/pypi/repoze.who.plugins.cas/">http://pypi.python.org/pypi/repoze.who.plugins.cas/</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.recaptcha.captcha.RecaptchaPlugin</span></tt></dt>
<dd>This class implements the <a class="reference internal" href="index.html#repoze.who.interfaces.IAuthenticator" title="repoze.who.interfaces.IAuthenticator"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IAuthenticator</span></tt></a>
plugin interface, using the recaptch API.
See <a class="reference external" href="http://pypi.python.org/pypi/repoze.who.plugins.recaptcha/">http://pypi.python.org/pypi/repoze.who.plugins.recaptcha/</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.sa.SQLAlchemyUserChecker</span></tt></dt>
<dd>User existence checker for
<a class="reference internal" href="index.html#repoze.who.plugins.auth_tkt.AuthTktCookiePlugin" title="repoze.who.plugins.auth_tkt.AuthTktCookiePlugin"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.auth_tkt.AuthTktCookiePlugin</span></tt></a>, based on
the SQLAlchemy ORM. See <a class="reference external" href="http://pypi.python.org/pypi/repoze.who.plugins.sa/">http://pypi.python.org/pypi/repoze.who.plugins.sa/</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.sa.SQLAlchemyAuthenticatorPlugin</span></tt></dt>
<dd>This class implements the <a class="reference internal" href="index.html#repoze.who.interfaces.IAuthenticator" title="repoze.who.interfaces.IAuthenticator"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IAuthenticator</span></tt></a>
plugin interface, using the the SQLAlchemy ORM.
See <a class="reference external" href="http://pypi.python.org/pypi/repoze.who.plugins.sa/">http://pypi.python.org/pypi/repoze.who.plugins.sa/</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.sa.SQLAlchemyUserMDPlugin</span></tt></dt>
<dd>This class implements the <a class="reference internal" href="index.html#repoze.who.interfaces.IMetadataProvider" title="repoze.who.interfaces.IMetadataProvider"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IMetadataProvider</span></tt></a>
plugin interface, using the the SQLAlchemy ORM.
See <a class="reference external" href="http://pypi.python.org/pypi/repoze.who.plugins.sa/">http://pypi.python.org/pypi/repoze.who.plugins.sa/</a></dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.formcookie.CookieRedirectingFormPlugin</span></tt></dt>
<dd>This class implements the <a class="reference internal" href="index.html#repoze.who.interfaces.IIdentifier" title="repoze.who.interfaces.IIdentifier"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IIdentifier</span></tt></a> and
<a class="reference internal" href="index.html#repoze.who.interfaces.IChallenger" title="repoze.who.interfaces.IChallenger"><tt class="xref py py-class docutils literal"><span class="pre">repoze.who.interfaces.IChallenger</span></tt></a> plugin interfaces, similar
to <tt class="xref py py-class docutils literal"><span class="pre">repoze.who.plugins.form.RedirectingFormPlugin</span></tt>.  The
plugin tracks the <tt class="docutils literal"><span class="pre">came_from</span></tt> URL via a cookie, rather than the query
string.  See <a class="reference external" href="http://pypi.python.org/pypi/repoze.who.plugins.formcookie/">http://pypi.python.org/pypi/repoze.who.plugins.formcookie/</a></dd>
</dl>
</div>
</div>
</div>
</div>
<div class="section" id="change-history">
<h2>Change History<a class="headerlink" href="#change-history" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-changes"></span><div class="section" id="repoze-who-changelog">
<h3>repoze.who Changelog<a class="headerlink" href="#repoze-who-changelog" title="Permalink to this headline">¶</a></h3>
<div class="section" id="unreleased">
<h4>Unreleased<a class="headerlink" href="#unreleased" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">plugins.auth_tkt</span></tt>:  Fix storage of &#8220;userdata&#8221; to save dict.  Fixes
<a class="reference external" href="https://github.com/repoze/repoze.who/issues/14">https://github.com/repoze/repoze.who/issues/14</a> via
<a class="reference external" href="https://github.com/repoze/repoze.who/pull/18">https://github.com/repoze/repoze.who/pull/18</a>.</li>
<li>Add support for Python 3.4, PyPy3.</li>
<li>middleware:  avoid UnboundLocalError when wrapped generater yields no
items.  See:  <a class="reference external" href="http://bugs.repoze.org/issue184">http://bugs.repoze.org/issue184</a></li>
<li>Make cookie expiration date RFC-2616 compliant (independent of locale,
including &#8216;GMT&#8217; zone). See <a class="reference external" href="https://github.com/repoze/repoze.who/pull/11">https://github.com/repoze/repoze.who/pull/11</a></li>
</ul>
</div>
<div class="section" id="id1">
<h4>2.2 (2013-05-17)<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Parse INI-file configuration using <tt class="docutils literal"><span class="pre">SafeConfigParser</span></tt>:  allows
escaping the <tt class="docutils literal"><span class="pre">'%'</span></tt> so that e.g. a query template using for a DB-API
connection using <tt class="docutils literal"><span class="pre">pyformat</span></tt> preserves the template.</li>
<li>Added support for Python 3.3, PyPy.</li>
</ul>
</div>
<div class="section" id="id2">
<h4>2.1 (2013-03-20)<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">_compat</span></tt> module:  tolerate missing <tt class="docutils literal"><span class="pre">CONTENT_TYPE</span></tt> key in the WSGI
environment.  Thanks to Dag Hoidal for the patch.</li>
<li><tt class="docutils literal"><span class="pre">htpasswd</span></tt> plugin:  add a <tt class="docutils literal"><span class="pre">sha1_check</span></tt> checker function (the <tt class="docutils literal"><span class="pre">crypt</span></tt>
module is not available on Windows).  Thanks to Chandrashekar Jayaraman
for the patch.</li>
<li>Documentation typo fixes from Carlos de la Guardia and Atsushi Odagiri.</li>
</ul>
</div>
<div class="section" id="b1-2012-11-05">
<h4>2.1b1 (2012-11-05)<a class="headerlink" href="#b1-2012-11-05" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Ported to Py3k using the &#8220;compatible subset&#8221; mode.
- Dropped support for Python &lt; 2.6.x.
- Dropped dependency on Paste (forking some code from it).
- Added dependency on WebOb instead.
Thanks to Atsushi Odagiri (aodag) for the initial effort.</li>
</ul>
</div>
<div class="section" id="id3">
<h4>2.0 (2011-09-28)<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">auth_tkt</span></tt> plugin:  strip any port number from the &#8216;Domain&#8217; of generated
cookies.  <a class="reference external" href="http://bugs.repoze.org/issue66">http://bugs.repoze.org/issue66</a></li>
<li>Further harden middleware, calling <tt class="docutils literal"><span class="pre">close()</span></tt> on the iterable even if
raising an exception for a missing challenger.
<a class="reference external" href="http://bugs.repoze.org/issue174">http://bugs.repoze.org/issue174</a></li>
</ul>
</div>
<div class="section" id="b1-2011-05-24">
<h4>2.0b1 (2011-05-24)<a class="headerlink" href="#b1-2011-05-24" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Enabled standard use of logging module&#8217;s configuration mechanism.
See <a class="reference external" href="http://docs.python.org/dev/howto/logging.html#configuring-logging-for-a-library">http://docs.python.org/dev/howto/logging.html#configuring-logging-for-a-library</a>
Thanks to jgoldsmith for the patch: <a class="reference external" href="http://bugs.repoze.org/issue178">http://bugs.repoze.org/issue178</a></li>
<li><tt class="docutils literal"><span class="pre">repoze.who.plugins.htpasswd</span></tt>:  defend against timing-based attacks.</li>
</ul>
</div>
<div class="section" id="a4-2011-02-02">
<h4>2.0a4 (2011-02-02)<a class="headerlink" href="#a4-2011-02-02" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Ensure that the middleware calls <tt class="docutils literal"><span class="pre">close()</span></tt> (if it exists) on the
iterable returned from thw wrapped application, as required by PEP 333.
<a class="reference external" href="http://bugs.repoze.org/issue174">http://bugs.repoze.org/issue174</a></li>
<li>Make <tt class="docutils literal"><span class="pre">make_api_factory_with_config</span></tt> tolerant of invalid filenames /
content for the config file:  in such cases, the API factory will have
<em>no</em> configured plugins or policies:  it will only be useful for retrieving
the API from an environment populated by middleware.</li>
<li>Fix bug in <tt class="docutils literal"><span class="pre">repoze.who.api</span></tt> where the <tt class="docutils literal"><span class="pre">remember()</span></tt> or <tt class="docutils literal"><span class="pre">forget()</span></tt>
methods could return a None if the identifier plugin returned a None.</li>
<li>Fix <tt class="docutils literal"><span class="pre">auth_tkt</span></tt> plugin to not hand over tokens as strings to paste. See
<a class="reference external" href="http://lists.repoze.org/pipermail/repoze-dev/2010-November/003680.html">http://lists.repoze.org/pipermail/repoze-dev/2010-November/003680.html</a></li>
<li>Fix <tt class="docutils literal"><span class="pre">auth_tkt</span></tt> plugin to add &#8220;secure&#8221; and &#8220;HttpOnly&#8221; to cookies when
configured with <tt class="docutils literal"><span class="pre">secure=True</span></tt>:  these attributes prevent the browser from
sending cookies over insecure channels, which could be vulnerable to some
XSS attacks.</li>
<li>Avoid propagating unicode &#8216;max_age&#8217; value into cookie headers.  See
<a class="reference external" href="https://bugs.launchpad.net/bugs/674123">https://bugs.launchpad.net/bugs/674123</a> .</li>
<li>Added a single-file example BFG application demonstrating the use of
the new &#8216;login&#8217; and &#8216;logout&#8217; methods of the API object.</li>
<li>Add <tt class="docutils literal"><span class="pre">login</span></tt> and <tt class="docutils literal"><span class="pre">logout</span></tt> methods to the <tt class="docutils literal"><span class="pre">repoze.who.api.API</span></tt> object,
as a convenience for application-driven login / logout code, which would
otherwise need to use private methods of the API, and reach down into
its plugins.</li>
</ul>
</div>
<div class="section" id="a3-2010-09-30">
<h4>2.0a3 (2010-09-30)<a class="headerlink" href="#a3-2010-09-30" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Deprecated the following plugins, moving their modules, tests, and docs
to a new project, <tt class="docutils literal"><span class="pre">repoze.who.deprecatedplugins</span></tt>:<ul>
<li><tt class="docutils literal"><span class="pre">repoze.who.plugins.cookie.InsecureCookiePlugin</span></tt></li>
<li><tt class="docutils literal"><span class="pre">repoze.who.plugins.form.FormPlugin</span></tt></li>
<li><tt class="docutils literal"><span class="pre">repoze.who.plugins.form.RedirectingFormPlugin</span></tt></li>
</ul>
</li>
<li>Made the <tt class="docutils literal"><span class="pre">repoze.who.plugins.cookie.InsecureCookiePlugin</span></tt> take a
<tt class="docutils literal"><span class="pre">charset</span></tt> argument, and use to to encode / decode login and password.
See <a class="reference external" href="http://bugs.repoze.org/issue155">http://bugs.repoze.org/issue155</a></li>
<li>Updated <tt class="docutils literal"><span class="pre">repoze.who.restrict</span></tt> to return headers as a list, to keep
<tt class="docutils literal"><span class="pre">wsgiref</span></tt> from complaining.</li>
<li>Helped default request classifier cope with xml submissions with an
explicit charset defined: <a class="reference external" href="http://bugs.repoze.org/issue145">http://bugs.repoze.org/issue145</a> (Lorenzo
M. Catucci)</li>
<li>Corrected the handling of type and subtype when matching an XML post
to <tt class="docutils literal"><span class="pre">xmlpost</span></tt> in the default classifier, which, according to RFC
2045, must be matched case-insensitively:
<a class="reference external" href="http://bugs.repoze.org/issue145">http://bugs.repoze.org/issue145</a> (Lorenzo M. Catucci)</li>
<li>Added <tt class="docutils literal"><span class="pre">repoze.who.config:make_api_factory_with_config</span></tt>, a convenience
method for applications which want to set up their own API Factory from
a configuration file.</li>
<li>Fixed example call to <tt class="docutils literal"><span class="pre">repoze.who.config:make_middleware_with_config</span></tt>
(added missing <tt class="docutils literal"><span class="pre">global_config</span></tt> argument).  See
<a class="reference external" href="http://bugs.repoze.org/issue114">http://bugs.repoze.org/issue114</a></li>
</ul>
</div>
<div class="section" id="a2-2010-03-25">
<h4>2.0a2 (2010-03-25)<a class="headerlink" href="#a2-2010-03-25" title="Permalink to this headline">¶</a></h4>
<div class="section" id="bugs-fixed">
<h5>Bugs Fixed<a class="headerlink" href="#bugs-fixed" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Fixed failure to pass substution values in log message string formatting
for <tt class="docutils literal"><span class="pre">repoze.who.api:API.challenge</span></tt>.  Fix included adding tests for all
logging done by the API object.  See <a class="reference external" href="http://bugs.repoze.org/issue122">http://bugs.repoze.org/issue122</a></li>
</ul>
</div>
<div class="section" id="backward-incompatibilities">
<h5>Backward Incompatibilities<a class="headerlink" href="#backward-incompatibilities" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Adjusted logging level for some lower-level details from <tt class="docutils literal"><span class="pre">info</span></tt>
to <tt class="docutils literal"><span class="pre">debug</span></tt>.</li>
</ul>
</div>
</div>
<div class="section" id="a1-2010-02-24">
<h4>2.0a1 (2010-02-24)<a class="headerlink" href="#a1-2010-02-24" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Restored the ability to create the middleware using the old <tt class="docutils literal"><span class="pre">classifier</span></tt>
argument.  That argument is now a deprecated-but-will-work-forever alias for
<tt class="docutils literal"><span class="pre">request_classifier</span></tt>.</li>
<li>The <tt class="docutils literal"><span class="pre">auth_tkt</span></tt> plugin now implements the <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt> interface,
and should normally be used both as an <tt class="docutils literal"><span class="pre">IIdentifier</span></tt> and an
<tt class="docutils literal"><span class="pre">IAuthenticator</span></tt>.</li>
<li>Factored out the API of the middleware object to make it useful from
within the application.  Applications using <tt class="docutils literal"><span class="pre">repoze.who`</span></tt> now fall into
one of three catgeories:<ul>
<li>&#8220;middleware-only&#8221; applications are configured with middleware, and
use either <tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt> or <tt class="docutils literal"><span class="pre">repoze.who.identity</span></tt> from the environment
to determing the authenticated user.</li>
<li>&#8220;bare metal&#8221; applications use no <tt class="docutils literal"><span class="pre">repoze.who</span></tt> middleware at all:
instead, they configure and an <tt class="docutils literal"><span class="pre">APIFactory</span></tt> object at startup, and
use it to create an <tt class="docutils literal"><span class="pre">API</span></tt> object when needed on a per-request basis.</li>
<li>&#8220;hybrid&#8221; applications are configured with <tt class="docutils literal"><span class="pre">repoze.who</span></tt> middleware,
but use a new library function to fetch the <tt class="docutils literal"><span class="pre">API</span></tt> object from the
environ, e.g. to permit calling <tt class="docutils literal"><span class="pre">remember</span></tt> after a signup or successful
login.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id4">
<h5>Bugs Fixed<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Fix <a class="reference external" href="http://bugs.repoze.org/issue102">http://bugs.repoze.org/issue102</a>: when no challengers existed,
logging would cause an exception.</li>
<li>Remove <tt class="docutils literal"><span class="pre">ez_setup.py</span></tt> and dependency on it in setup.py (support
distribute).</li>
</ul>
</div>
<div class="section" id="id5">
<h5>Backward Incompatibilities<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The middleware used to allow identifier plugins to &#8220;pre-authenticate&#8221;
an identity.  This feature is no longer supported: the <tt class="docutils literal"><span class="pre">auth_tkt</span></tt>
plugin, which used to use the feature, is now configured to work as
an authenticator plugin (as well as an identifier).</li>
<li>The <tt class="docutils literal"><span class="pre">repoze.who.middleware:PluggableAuthenticationMiddleware</span></tt> class
no longer has the following (non-API) methods (now made API methods
of the <tt class="docutils literal"><span class="pre">repoze.who.api:API</span></tt> class):<ul>
<li><tt class="docutils literal"><span class="pre">add_metadata</span></tt></li>
<li><tt class="docutils literal"><span class="pre">authenticate</span></tt></li>
<li><tt class="docutils literal"><span class="pre">challenge</span></tt></li>
<li><tt class="docutils literal"><span class="pre">identify</span></tt></li>
</ul>
</li>
<li>The following (non-API) functions moved from <tt class="docutils literal"><span class="pre">repoze.who.middleware</span></tt> to
<tt class="docutils literal"><span class="pre">repoze.who.api</span></tt>:<ul>
<li><tt class="docutils literal"><span class="pre">make_registries</span></tt></li>
<li><tt class="docutils literal"><span class="pre">match_classification</span></tt></li>
<li><tt class="docutils literal"><span class="pre">verify</span></tt></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="id6">
<h4>1.0.18 (2009-11-05)<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Issue #104:  AuthTkt plugin was passing an invalid cookie value in
headers from <tt class="docutils literal"><span class="pre">forget</span></tt>, and was not setting the <tt class="docutils literal"><span class="pre">Max-Age</span></tt> and
<tt class="docutils literal"><span class="pre">Expires</span></tt> attributes of those cookies.</li>
</ul>
</div>
<div class="section" id="id7">
<h4>1.0.17 (2009-11-05)<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fixed the <tt class="docutils literal"><span class="pre">repoze.who.plugins.form.make_plugin</span></tt> factory&#8217;s <tt class="docutils literal"><span class="pre">formcallable</span></tt>
argument handling, to allow passing in a dotted name (e.g., from a config
file).</li>
</ul>
</div>
<div class="section" id="id8">
<h4>1.0.16 (2009-11-04)<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Exposed <tt class="docutils literal"><span class="pre">formcallable</span></tt> argument for <tt class="docutils literal"><span class="pre">repoze.who.plugins.form.FormPlugin</span></tt>
to the callers of the <tt class="docutils literal"><span class="pre">repoze.who.plugins.form.make_plugin</span></tt> factory.
Thanks to Roland Hedburg for the report.</p>
</li>
<li><p class="first">Fixed an issue that caused the following symptom when using the
ini configuration parser:</p>
<div class="highlight-python"><div class="highlight"><pre>TypeError: _makePlugin() got multiple values for keyword argument &#39;name&#39;
</pre></div>
</div>
<p>See <a class="reference external" href="http://bugs.repoze.org/issue92">http://bugs.repoze.org/issue92</a> for more details.  Thanks to vaab
for the bug report and initial fix.</p>
</li>
</ul>
</div>
<div class="section" id="id9">
<h4>1.0.15 (2009-06-25)<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>If the form post value <tt class="docutils literal"><span class="pre">max_age</span></tt> exists while in the <tt class="docutils literal"><span class="pre">identify</span></tt>
method is handling the <tt class="docutils literal"><span class="pre">login_handler_path</span></tt>, pass the max_age
value in the returned identity dictionary as <tt class="docutils literal"><span class="pre">max_age</span></tt>.  See the
below bullet point for why.</li>
<li>If the <tt class="docutils literal"><span class="pre">identity</span></tt> dict passed to the <tt class="docutils literal"><span class="pre">auth_tkt</span></tt> <tt class="docutils literal"><span class="pre">remember</span></tt>
method contains a <tt class="docutils literal"><span class="pre">max_age</span></tt> key with a string (or integer) value,
treat it as a cue to set the <tt class="docutils literal"><span class="pre">Max-Age</span></tt> and <tt class="docutils literal"><span class="pre">Expires</span></tt> headers in
the returned cookies.  The cookie <tt class="docutils literal"><span class="pre">Max-Age</span></tt> is set to the value
and the <tt class="docutils literal"><span class="pre">Expires</span></tt> is computed from the current time.</li>
</ul>
</div>
<div class="section" id="id10">
<h4>1.0.14 (2009-06-17)<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Fix test breakage on Windows.  See <a class="reference external" href="http://bugs.repoze.org/issue79">http://bugs.repoze.org/issue79</a> .</p>
</li>
<li><p class="first">Documented issue with using <tt class="docutils literal"><span class="pre">include_ip</span></tt> setting in the <tt class="docutils literal"><span class="pre">auth_tkt</span></tt>
plugin.  See <a class="reference external" href="http://bugs.repoze.org/issue81">http://bugs.repoze.org/issue81</a> .</p>
</li>
<li><p class="first">Added &#8216;passthrough_challenge_decider&#8217;, which avoids re-challenging 401
responses which have been &#8220;pre-challenged&#8221; by the application.</p>
</li>
<li><p class="first">One-hundred percent unit test coverage.</p>
</li>
<li><p class="first">Add <tt class="docutils literal"><span class="pre">timeout</span></tt> and <tt class="docutils literal"><span class="pre">reissue_time</span></tt> arguments to the auth_tkt
identifier plugin, courtesty of Paul Johnston.</p>
</li>
<li><p class="first">Add a <tt class="docutils literal"><span class="pre">userid_checker</span></tt> argument to the auth_tkt identifier plugin,
courtesty of Gustavo Narea.</p>
<p>If <tt class="docutils literal"><span class="pre">userid_checker</span></tt> is provided, it must be a dotted Python name
that resolves to a function which accepts a userid and returns a
boolean True or False, indicating whether that user exists in a
database.  This is a workaround.  Due to a design bug in repoze.who,
the only way who can check for user existence is to use one or more
IAuthenticator plugin <tt class="docutils literal"><span class="pre">authenticate</span></tt> methods.  If an
IAuthenticator&#8217;s <tt class="docutils literal"><span class="pre">authenticate</span></tt> method returns true, it means that
the user exists.  However most IAuthenticator plugins expect <em>both</em>
a username and a password, and will return False unconditionally if
both aren&#8217;t supplied.  This means that an authenticator can&#8217;t be
used to check if the user &#8220;only&#8221; exists.  The identity provided by
an auth_tkt does not contain a password to check against.  The
actual design bug in repoze.who is this: when a user presents
credentials from an auth_tkt, he is considered &#8220;preauthenticated&#8221;.
IAuthenticator.authenticate is just never called for a
&#8220;preauthenticated&#8221; identity, which works fine, but it means that the
user will be considered authenticated even if you deleted the user&#8217;s
record from whatever database you happen to be using.  However, if
you use a userid_checker, you can ensure that a user exists for the
auth_tkt supplied userid.  If the userid_checker returns False, the
auth_tkt credentials are considered &#8220;no good&#8221;.</p>
</li>
</ul>
</div>
<div class="section" id="id11">
<h4>1.0.13 (2009-04-24)<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Added a paragraph to <tt class="docutils literal"><span class="pre">IAuthenticator</span></tt> docstring, documenting that plugins
are allowed to add keys to the <tt class="docutils literal"><span class="pre">identity</span></tt> dictionary (e.g., to save a
second database query in an <tt class="docutils literal"><span class="pre">IMetadataProvider</span></tt> plugin).</li>
<li>Patch supplied for issue #71 (<a class="reference external" href="http://bugs.repoze.org/issue71">http://bugs.repoze.org/issue71</a>)
whereby a downstream app can return a generator, relying on an
upstream component to call start_response.  We do this because the
challenge decider needs the status and headers to decide what to do.</li>
</ul>
</div>
<div class="section" id="id12">
<h4>1.0.12 (2009-04-19)<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>auth_tkt plugin tried to append REMOTE_USER_TOKENS data to
existing tokens data returned by auth_tkt.parse_tkt; this was
incorrect; just overwrite.</li>
<li>Extended auth_tkt plugin factory to allow passing secret in a separate
file from the main config file.  See <a class="reference external" href="http://bugs.repoze.org/issue40">http://bugs.repoze.org/issue40</a> .</li>
</ul>
</div>
<div class="section" id="id13">
<h4>1.0.11 (2009-04-10)<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix auth_tkt plugin; cookie values are now quoted, making it possible
to put spaces and other whitespace, etc in usernames. (thanks to Michael
Pedersen).</li>
<li>Fix corner case issue of an exception raised when attempting to log
when there are no identifiers or authenticators.</li>
</ul>
</div>
<div class="section" id="id14">
<h4>1.0.10 (2009-01-23)<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The RedirectingFormPlugin now passes along SetCookie headers set
into the response by the application within the NotFound response
(fixes TG2 &#8220;flash&#8221; issue).</li>
</ul>
</div>
<div class="section" id="id15">
<h4>1.0.9 (2008-12-18)<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The RedirectingFormPlugin now attempts to find a header named
<tt class="docutils literal"><span class="pre">X-Authentication-Failure-Reason</span></tt> among the response headers set
by the application when a challenge is issued.  If a value for this
header exists (and is non-blank), the value is attached to the
redirect URL&#8217;s query string as the <tt class="docutils literal"><span class="pre">reason</span></tt> parameter (or a
user-settable key).  This makes it possible for downstream
applications to issue a response that initiates a challenge with
this header and subsequently display the reason in the login form
rendered as a result of the challenge.</li>
</ul>
</div>
<div class="section" id="id16">
<h4>1.0.8 (2008-12-13)<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">PluggableAuthenticationMiddleware</span></tt> constructor accepts a
<tt class="docutils literal"><span class="pre">log_stream</span></tt> argument, which is typically a file.  After this
release, it can also be a PEP 333 <tt class="docutils literal"><span class="pre">Logger</span></tt> instance; if it is a
PEP 333 <tt class="docutils literal"><span class="pre">Logger</span></tt> instance, this logger will be used as the
repoze.who logger (instead of one being constructed by the
middleware, as was previously always the case).  When the
<tt class="docutils literal"><span class="pre">log_stream</span></tt> argument is a PEP 333 Logger object, the
<tt class="docutils literal"><span class="pre">log_level</span></tt> argument is ignored.</li>
</ul>
</div>
<div class="section" id="id17">
<h4>1.0.7 (2008-08-28)<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">repoze.who</span></tt> and <tt class="docutils literal"><span class="pre">repoze.who.plugins</span></tt> were not added to the
<tt class="docutils literal"><span class="pre">namespace_packages</span></tt> list in setup.py, potentially making 1.0.6 a
brownbag release, given that making these packages namespace
packages was the only reason for its release.</li>
</ul>
</div>
<div class="section" id="id18">
<h4>1.0.6 (2008-08-28)<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Make repoze.who and repoze.who.plugins into namespace packages
mainly so we can allow plugin authors to distribute packages in the
repoze.who.plugins namespace.</li>
</ul>
</div>
<div class="section" id="id19">
<h4>1.0.5 (2008-08-23)<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix auth_tkt plugin to set the same cookies in its <tt class="docutils literal"><span class="pre">remember</span></tt>
method that it does in its <tt class="docutils literal"><span class="pre">forget</span></tt> method.  Previously, logging
out and relogging back in to a site that used auth_tkt identifier
plugin was slightly dicey and would only work sometimes.</li>
<li>The FormPlugin plugin has grown a redirect-on-unauthorized feature.
Any response from a downstream application that causes a challenge
and includes a Location header will cause a redirect to the value of
the Location header.</li>
</ul>
</div>
<div class="section" id="id20">
<h4>1.0.4 (2008-08-22)<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Added a key to the &#8216;[general]&#8217; config section: <tt class="docutils literal"><span class="pre">remote_user_key</span></tt>.
If you use this key in the config file, it tells who to 1) not
perform any authentication if it exists in the environment during
ingress and 2) to set the key in the environment for the downstream
app to use as the REMOTE_USER variable.  The default is
<tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt>.</li>
<li>Using unicode user ids in combination with the auth_tkt plugin would
cause problems under mod_wsgi.</li>
<li>Allowed &#8216;cookie_path&#8217; argument to InsecureCookiePlugin (and config
constructor).  Thanks to Gustavo Narea.</li>
</ul>
</div>
<div class="section" id="id21">
<h4>1.0.3 (2008-08-16)<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>A bug in the middleware&#8217;s <tt class="docutils literal"><span class="pre">authenticate</span></tt> method made it impossible
to authenticate a user with a userid that was null (e.g. 0, False),
which are valid identifiers.  The only invalid userid is now None.</li>
<li>Applied patch from Olaf Conradi which logs an error when an invalid
filename is passed to the HTPasswdPlugin.</li>
</ul>
</div>
<div class="section" id="id22">
<h4>1.0.2 (2008-06-16)<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Fix bug found by Chris Perkins: the auth_tkt plugin&#8217;s &#8220;remember&#8221;
method didn&#8217;t handle userids which are Python &#8220;long&#8221; instances
properly.  Symptom: TypeError: cannot concatenate &#8216;str&#8217; and &#8216;long&#8217;
objects in &#8220;paste.auth.auth_tkt&#8221;.</p>
</li>
<li><p class="first">Added predicate-based &#8220;restriction&#8221; middleware support
(repoze.who.restrict), allowing configuratio-driven authorization as
a WSGI filter.  One example predicate, &#8216;authenticated_predicate&#8217;, is
supplied, which requires that the user be authenticated either via
&#8216;REMOTE_USER&#8217; or via &#8216;repoze.who.identity&#8217;.  To use the filter to
restrict access:</p>
<div class="highlight-python"><div class="highlight"><pre>  [filter:authenticated_only]
  use = egg:repoze.who#authenticated

or::

  [filter:some_predicate]
  use = egg:repoze.who#predicate
  predicate = my.module:some_predicate
  some_option = a value
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id23">
<h4>1.0.1 (2008-05-24)<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Remove dependency-link to dist.repoze.org to prevent easy_install
from inserting that path into its search paths (the dependencies are
available from PyPI).</li>
</ul>
</div>
<div class="section" id="id24">
<h4>1.0 (2008-05-04)<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">The plugin at plugins.form.FormPlugin didn&#8217;t redirect properly after
collecting identification information.  Symptom: a downstream app
would receive a POST request with a blank body, which would
sometimes result in a Bad Request error.</p>
</li>
<li><p class="first">Fixed interface declarations of
&#8216;classifiers.default_request_classifier&#8217; and
&#8216;classifiers.default_password_compare&#8217;.</p>
</li>
<li><p class="first">Added actual config-driven middleware factory,
&#8216;config.make_middleware_with_config&#8217;</p>
</li>
<li><p class="first">Removed fossilized &#8216;who_conf&#8217; argument from plugin factory functions.</p>
</li>
<li><p class="first">Added ConfigParser-based WhoConfig, implementing the spec outlined at
<a class="reference external" href="http://www.plope.com/static/misc/sphinxtest/intro.html#middleware-configuration-via-config-file">http://www.plope.com/static/misc/sphinxtest/intro.html#middleware-configuration-via-config-file</a>,
with the following changes:</p>
<ul>
<li><dl class="first docutils">
<dt>&#8220;Bare&#8221; plugins (requiring no configuration options) may be specified</dt>
<dd><p class="first last">as either egg entry points (e.g., &#8216;egg:distname#entry_point_name&#8217;) or
as dotted-path-with-colon (e.g., &#8216;dotted.name:object_id&#8217;).</p>
</dd>
</dl>
</li>
<li><p class="first">Therefore, the separator between a plugin and its classifier is now
a semicolon, rather than a colon. E.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>[plugins:id_plugin]
use = egg:another.package#identify_with_frobnatz
frobnatz = baz

[identifiers]
plugins =
  egg:my.egg#identify;browser
  dotted.name:identifier
  id_plugin
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id25">
<h4>0.9.1 (2008-04-27)<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix auth_tkt plugin to be able to encode and decode integer user
ids.</li>
</ul>
</div>
<div class="section" id="id26">
<h4>0.9 (2008-04-01)<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix bug introduced in FormPlugin in 0.8 release (rememberer headers
not set).</li>
<li>Add PATH_INFO to started and ended log info.</li>
<li>Add a SQLMetadataProviderPlugin (in plugins/sql).</li>
<li>Change constructor of SQLAuthenticatorPlugin: it now accepts only
&#8220;query&#8221;, &#8220;conn_factory&#8221;, and &#8220;compare_fn&#8221;.  The old constructor
accepted a DSN, but some database systems don&#8217;t use DBAPI DSNs.  The
new constructor accepts no DSN; the conn_factory is assumed to do
all the work to make a connection, including knowing the DSN if one
is required.  The &#8220;conn_factory&#8221; should return something that, when
called with no arguments, returns a database connection.</li>
<li>The &#8220;make_plugin&#8221; helper in plugins/sql has been renamed
&#8220;make_authenticator_plugin&#8221;.  When called, this helper will return a
SQLAuthenticatorPlugin.  A bit of helper logic in the
&#8220;make_authenticator_plugin&#8221; allows a connection factory to be
computed.  The top-level callable referred to by conn_factory in
this helper should return a function that, when called with no
arguments, returns a datbase connection.  The top-level callable
itself is called with &#8220;who_conf&#8221; (global who configuration) and any
number of non-top-level keyword arguments as they are passed into
the helper, to allow for a DSN or URL or whatever to be passed in.</li>
<li>A &#8220;make_metatata_plugin&#8221; helper has been added to plugins/sql. When
called, this will make a SQLMetadataProviderPlugin.  See the
implementation for details.  It is similar to the
&#8220;make_authenticator_plugin&#8221; helper.</li>
</ul>
</div>
<div class="section" id="id27">
<h4>0.8 (2008-03-27)<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Add a RedirectingFormIdentifier plugin.  This plugin is willing to
redirect to an external (or downstream application) login form to
perform identification.  The external login form must post to the
&#8220;login_handler_path&#8221; of the plugin (optimally with a &#8220;came_from&#8221;
value to tell the plugin where to redirect the response to if the
authentication works properly).  The &#8220;logout_handler_path&#8221; of this
plugin can be visited to perform a logout.  The &#8220;came_from&#8221; value
also works there.</li>
<li>Identifier plugins are now permitted to set a key in the environment
named &#8216;repoze.who.application&#8217; on ingress (in &#8216;identify&#8217;).  If an
identifier plugin does so, this application is used instead of the
&#8220;normal&#8221; downstream application.  This feature was added to more
simply support the redirecting form identifier plugin.</li>
</ul>
</div>
<div class="section" id="id28">
<h4>0.7 (2008-03-26)<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Change the IMetadataProvider interface: this interface used to have
a &#8220;metadata&#8221; method which returned a dictionary.  This method is not
part of that API anymore.  It&#8217;s been replaced with an &#8220;add_metadata&#8221;
method which has the signature:</p>
<div class="highlight-python"><div class="highlight"><pre> def add_metadata(environ, identity):
     &quot;&quot;&quot;
     Add metadata to the identity (which is a dictionary)
     &quot;&quot;&quot;

The return value is ignored.  IMetadataProvider plugins are now
assumed to be responsible for &#39;scribbling&#39; directly on the identity
that is passed in (it&#39;s a dictionary).  The user id can always be
retrieved from the identity via identity[&#39;repoze.who.userid&#39;] for
metadata plugins that rely on that value.
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id29">
<h4>0.6 (2008-03-20)<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Renaming: repoze.pam is now repoze.who</li>
<li>Bump ez_setup.py version.</li>
<li>Add IMetadataProvider plugin type.  Chris says &#8216;Whit rules&#8217;.</li>
</ul>
</div>
<div class="section" id="id30">
<h4>0.5 (2008-03-09)<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Allow &#8220;remote user key&#8221; (default: REMOTE_USER) to be overridden
(pass in remote_user_key to middleware constructor).</li>
<li>Allow form plugin to override the default form.</li>
<li>API change: IIdentifiers are no longer required to put both &#8216;login&#8217;
and &#8216;password&#8217; in a returned identity dictionary.  Instead, an
IIdentifier can place arbitrary key/value pairs in the identity
dictionary (or return an empty dictionary).</li>
<li>API return value change: the &#8220;failure&#8221; identity which IIdentifiers
return is now None rather than an empty dictionary.</li>
<li>The IAuthenticator interface now specifies that IAuthenticators must
not raise an exception when evaluating an identity that does not
have &#8220;expected&#8221; key/value pairs (e.g. when an IAuthenticator that
expects login and password inspects an identity returned by an
IP-based auth system which only puts the IP address in the
identity); instead they fail gracefully by returning None.</li>
<li>Add (cookie) &#8220;auth_tkt&#8221; identification plugin.</li>
<li>Stamp identity dictionaries with a userid by placing a key named
&#8216;repoze.pam.userid&#8217; into the identity for each authenticated
identity.</li>
<li>If an IIdentifier plugin inserts a &#8216;repoze.pam.userid&#8217; key into the
identity dictionary, consider this identity &#8220;preauthenticated&#8221;.  No
authenticator plugins will be asked to authenticate this identity.
This is designed for things like the recently added auth_tkt plugin,
which embeds the user id into the ticket.  This effectively alllows
an IIdentifier plugin to become an IAuthenticator plugin when
breaking apart the responsibility into two separate plugins is
&#8220;make-work&#8221;.  Preauthenticated identities will be selected first
when deciding which identity to use for any given request.</li>
<li>Insert a &#8216;repoze.pam.identity&#8217; key into the WSGI environment on
ingress if an identity is found.  Its value will be the identity
dictionary related to the identity selected by repoze.pam on
ingress.  Downstream consumers are allowed to mutate this
dictionary; this value is passed to &#8220;remember&#8221; and &#8220;forget&#8221;, so its
main use is to do a &#8220;credentials reset&#8221;; e.g. a user has changed his
username or password within the application, but we don&#8217;t want to
force him to log in again after he does so.</li>
</ul>
</div>
<div class="section" id="id31">
<h4>0.4 (03-07-2008)<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Allow plugins to specify a classifiers list per interface (instead
of a single classifiers list per plugin).</li>
</ul>
</div>
<div class="section" id="id32">
<h4>0.3 (03-05-2008)<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Make SQLAuthenticatorPlugin&#8217;s default_password_compare use hexdigest
sha instead of base64&#8217;ed binary sha for simpler conversion.</li>
</ul>
</div>
<div class="section" id="id33">
<h4>0.2 (03-04-2008)<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Added SQLAuthenticatorPlugin (see plugins/sql.py).</li>
</ul>
</div>
<div class="section" id="id34">
<h4>0.1 (02-27-2008)<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Initial release (no configuration file support yet).</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="support-and-development">
<h2>Support and Development<a class="headerlink" href="#support-and-development" title="Permalink to this headline">¶</a></h2>
<p>To report bugs, use the <a class="reference external" href="http://bugs.repoze.org">Repoze bug tracker</a>.</p>
<p>If you&#8217;ve got questions that aren&#8217;t answered by this documentation,
contact the <a class="reference external" href="http://lists.repoze.org/listinfo/repoze-dev">Repoze-dev maillist</a> or join the <a class="reference external" href="irc://irc.freenode.net/#repoze">#repoze
IRC channel</a>.</p>
<p>Browse and check out tagged and trunk versions of <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a>
via the <a class="reference external" href="https://github.com/repoze/repoze.who/">Repoze github repository</a>.  To check out the trunk
via git, use this command:</p>
<div class="highlight-python"><div class="highlight"><pre>git clone https://github.com:repoze/repoze.who.git
</pre></div>
</div>
<p>Or, if you are logged in:</p>
<blockquote>
<div>git clone <a class="reference external" href="mailto:git&#37;&#52;&#48;github&#46;com">git<span>&#64;</span>github<span>&#46;</span>com</a>:repoze/repoze.who.git</div></blockquote>
<p>To find out how to become a contributor to <a class="reference internal" href="#module-repoze.who" title="repoze.who: WSGI authentication middleware"><tt class="xref py py-mod docutils literal"><span class="pre">repoze.who</span></tt></a>, please
see the <a class="reference external" href="http://repoze.org/contributing.html">contributor&#8217;s page</a>.</p>
</div>
<div class="section" id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2008 - 2013, Agendaless Consulting.
      Last updated on Dec 18, 2014.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/latest/">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://readthedocs.org/projects/repozewho/downloads/pdf/latest/">PDF</a></dd>
        
          <dd><a href="https://readthedocs.org/projects/repozewho/downloads/htmlzip/latest/">HTML</a></dd>
        
          <dd><a href="https://readthedocs.org/projects/repozewho/downloads/epub/latest/">Epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/repozewho/?fromdocs=repozewho">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/repozewho/?fromdocs=repozewho">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
