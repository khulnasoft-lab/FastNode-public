

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>webassets 0.11.dev documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
  

  
    <link rel="top" title="None" href="index.html#document-index"/>
 
<!-- RTD Extra Head -->



<!-- 
Read the Docs is acting as the canonical URL for your project. 
If you want to change it, more info is available in our docs:
  http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://webassets.readthedocs.org/en/latest/" />

<script type="text/javascript">
  // This is included here because other places don't have access to the pagename variable.
  var READTHEDOCS_DATA = {
    project: "webassets",
    version: "latest",
    language: "en",
    page: "index",
    builder: "sphinx",
    theme: "sphinx_rtd_theme",
    docroot: "/docs/",
    source_suffix: ".rst",
    api_host: "https://readthedocs.org",
    commit: "f5b40222e616b1f2a44ee9e3582973585fde39a7"
  }
  // Old variables
  var doc_version = "latest";
  var doc_slug = "webassets";
  var page_name = "index";
  var html_theme = "sphinx_rtd_theme";
</script>
<!-- RTD Analytics Code -->
<!-- Included in the header because you don't have a footer block. -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);

  // User Analytics Code
  _gaq.push(['user._setAccount', 'None']);
  _gaq.push(['user._trackPageview']);
  // End User Analytics Code


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- end RTD Analytics Code -->
<!-- end RTD <extrahead> -->


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html#document-index" class="fa fa-home"> webassets</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference external" href="http://django-assets.readthedocs.org/en/latest/">With Django</a></li>
<li class="toctree-l1"><a class="reference external" href="http://flask-assets.readthedocs.org/en/latest/">With Flask</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sontek/pyramid_webassets">With Pyramid</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-generic/index">Other or no framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-generic/index#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-generic/index#further-reading">Further Reading</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-environment">The environment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-environment#registering-bundles">Registering bundles</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-environment#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-environment#filter-configuration">Filter configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-bundles">Bundles</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-bundles#nested-bundles">Nested bundles</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-bundles#building-bundles">Building bundles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-script">Command Line Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-script#build-a-custom-command-line-client">Build a custom command line client</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-script#included-commands">Included Commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-builtin_filters">Included Filters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-builtin_filters#javascript-compressors">Javascript compressors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-builtin_filters#css-compressors">CSS compressors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-builtin_filters#js-css-compilers">JS/CSS compilers</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-builtin_filters#javascript-templates">JavaScript templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-builtin_filters#other">Other</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-expiring">URL Expiry (cache busting)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-expiring#for-beginners">For beginners</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-expiring#what-is-the-version-of-a-file">What is the version of a file</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-expiring#expire-using-a-querystring">Expire using a querystring</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-expiring#expire-using-the-filename">Expire using the filename</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-expiring#about-manifests">About manifests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-custom_filters">Creating custom filters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-custom_filters#the-very-easy-way">The very easy way</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-custom_filters#the-easy-way">The easy way</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-custom_filters#more">More?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-css_compilers">CSS compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-loaders">Loaders</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-integration/index">Integration with other libraries</a><ul>
<li class="toctree-l2"><a class="reference external" href="http://elsdoerfer.name/docs/django-assets/">Django</a></li>
<li class="toctree-l2"><a class="reference external" href="http://elsdoerfer.name/docs/flask-assets/">Flask-Assets</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-integration/jinja2">Jinja2</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/sontek/pyramid_webassets">pyramid</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-faq">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-faq#is-there-a-cache-busting-feature">Is there a cache-busting feature?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-faq#relative-urls-in-my-css-code-break-if-the-merged-asset-is-written-to-a-different-location-than-the-source-files-how-do-i-fix-this">Relative URLs in my CSS code break if the merged asset is written to a different location than the source files. How do I fix this?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-faq#i-am-using-a-css-compiler-and-i-need-its-filter-to-apply-even-in-debug-mode">I am using a CSS compiler and I need its filter to apply even in debug mode!</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-faq#is-google-app-engine-supported">Is Google App Engine supported?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-upgrading">Upgrading</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-upgrading#in-0-10">In 0.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-upgrading#in-0-9">In 0.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-upgrading#in-0-8">In 0.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-upgrading#in-0-7">In 0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-upgrading#in-0-6">In 0.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-upgrading#in-0-4">In 0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-upgrading#in-0-2">In 0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-upgrading#in-0-1">In 0.1</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html#document-index">webassets</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html#document-index">Docs</a> &raquo;</li>
      
    <li>webassets 0.11.dev documentation</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://github.com/miracle2k/webassets/blob/master/docs/index.rst" class="fa fa-github"> Edit on GitHub</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="webassets-asset-management-for-python">
<span id="index"></span><h1>webassets - Asset management for Python<a class="headerlink" href="#webassets-asset-management-for-python" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>webassets is a general, dependency-independent library for managing
the assets of your web application. It can merge and compress your CSS
and JavaScript files, supporting a wide variety of different filters,
and supports working with compilers like CoffeeScript or Sass.</p>
</div>
<div class="section" id="framework-integration">
<h2>Framework integration<a class="headerlink" href="#framework-integration" title="Permalink to this headline">¶</a></h2>
<p>For some web frameworks, <tt class="docutils literal"><span class="pre">webassets</span></tt> provides special
integration. If you are using one of the supported frameworks, go to
the respective page:</p>
<div class="toctree-wrapper compound">
<span id="document-generic/index"></span><div class="section" id="using-webassets-in-standalone-mode">
<h3>Using <tt class="docutils literal"><span class="pre">webassets</span></tt> in standalone mode<a class="headerlink" href="#using-webassets-in-standalone-mode" title="Permalink to this headline">¶</a></h3>
<p>You don&#8217;t need to use one of the frameworks into which <tt class="docutils literal"><span class="pre">webassets</span></tt> can
integrate. Using the underlaying facilites directly it is almost as easy.</p>
<p>And depending on what libraries you use, there may still be some things
<em>webassets</em> can help you with, see <a class="reference internal" href="index.html#document-integration/index"><em>Integration with other libraries</em></a>.</p>
<div class="section" id="quick-start">
<h4>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h4>
<p>First, create an environment instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets</span> <span class="kn">import</span> <span class="n">Environment</span>
<span class="n">my_env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="s">&#39;../static/media&#39;</span><span class="p">,</span> <span class="s">&#39;/media&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, the environment requires two arguments, the path in which
your media files are located, as well as the url prefix under which the
media directory is available. This prefix will be used when generating
output urls.</p>
<p>Next, you need to define your assets, in the form of so called <em>bundles</em>,
and register them with the environment. The easist way to do it is directly
in code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets</span> <span class="kn">import</span> <span class="n">Bundle</span>
<span class="n">js</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;common/jquery.js&#39;</span><span class="p">,</span> <span class="s">&#39;site/base.js&#39;</span><span class="p">,</span> <span class="s">&#39;site/widgets.js&#39;</span><span class="p">,</span>
            <span class="n">filters</span><span class="o">=</span><span class="s">&#39;jsmin&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;gen/packed.js&#39;</span><span class="p">)</span>
<span class="n">my_env</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;js_all&#39;</span><span class="p">,</span> <span class="n">js</span><span class="p">)</span>
</pre></div>
</div>
<p>However, if you prefer, you can of course just as well define your assets
in an external config file, and read them from there. <tt class="docutils literal"><span class="pre">webassets</span></tt>
includes a number of <a class="reference internal" href="index.html#document-loaders"><em>helper classes</em></a> for some popular
formats like YAML.</p>
<div class="section" id="using-the-bundles">
<h5>Using the bundles<a class="headerlink" href="#using-the-bundles" title="Permalink to this headline">¶</a></h5>
<p>Now with your assets properly defined, you want to merge and minify
them, and include a link to the compressed result in your web page. How
you do this depends a bit on how your site is rendered.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">my_env</span><span class="p">[</span><span class="s">&#39;js_all&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">urls</span><span class="p">()</span>
<span class="go">(&#39;/media/gen/packed.js?9ae572c&#39;,)</span>
</pre></div>
</div>
<p>This will always work. You can call your bundle&#8217;s <tt class="docutils literal"><span class="pre">urls()</span></tt> method, which
will  automatically merge and compress the source files, and return the
url to the final output file. Or, in debug mode, it would return the urls
of each source file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">my_env</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_env</span><span class="p">[</span><span class="s">&#39;js_all&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">urls</span><span class="p">()</span>
<span class="go">(&#39;/media/common/jquery.js&#39;,</span>
<span class="go"> &#39;/media/site/base.js&#39;,</span>
<span class="go"> &#39;/media/site/widgets.js&#39;,)</span>
</pre></div>
</div>
<p>Take these urls, pass them to your templates, or otherwise ensure they&#8217;ll
be used on your website when linking to your Javascript and CSS files.</p>
<p>For some templating languages, <tt class="docutils literal"><span class="pre">webassets</span></tt> provides extensions to access
your bundles directly within the template. See <a class="reference internal" href="index.html#document-integration/index"><em>Integration with other libraries</em></a> for
more information.</p>
</div>
<div class="section" id="using-the-command-line-interface">
<h5>Using the Command Line Interface<a class="headerlink" href="#using-the-command-line-interface" title="Permalink to this headline">¶</a></h5>
<p>See <a class="reference internal" href="index.html#document-script"><em>Command Line Interface</em></a>.</p>
</div>
</div>
<div class="section" id="further-reading">
<h4>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-environment"></span><div class="section" id="the-environment">
<span id="environment"></span><h5>The environment<a class="headerlink" href="#the-environment" title="Permalink to this headline">¶</a></h5>
<p>The environment has two responsibilities: One, it acts as a registry for
bundles, meaning you only have to pass around a single object to access
all your bundles.</p>
<p>Also, it holds the configuration.</p>
<div class="section" id="registering-bundles">
<h6>Registering bundles<a class="headerlink" href="#registering-bundles" title="Permalink to this headline">¶</a></h6>
<p>Bundles can be registered with the environment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_bundle</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">environment</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;my_bundle&#39;</span><span class="p">,</span> <span class="n">my_bundle</span><span class="p">)</span>
</pre></div>
</div>
<p>A shortcut syntax is also available - you may simply call <tt class="docutils literal"><span class="pre">register()</span></tt>
with the arguments which you would pass to the <tt class="docutils literal"><span class="pre">Bundle</span></tt> constructor:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">environment</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;my_bundle&#39;</span><span class="p">,</span> <span class="s">&#39;file1.js&#39;</span><span class="p">,</span> <span class="s">&#39;file2.js&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;packed.js&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The environment allows dictionary-style access to the registered bundles:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>
<span class="go">1</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>
<span class="go">[&lt;Bundle ...&gt;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">environment</span><span class="p">[</span><span class="s">&#39;my_bundle&#39;</span><span class="p">]</span>
<span class="go">&lt;Bundle ...&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<span id="environment-configuration"></span><h6>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h6>
<p>The environment supports the following configuration options:</p>
<dl class="attribute">
<dt id="webassets.env.Environment.directory">
<tt class="descclassname">Environment.</tt><tt class="descname">directory</tt><a class="headerlink" href="#webassets.env.Environment.directory" title="Permalink to this definition">¶</a></dt>
<dd><p>The base directory to which all paths will be relative to,
unless <tt class="xref py py-attr docutils literal"><span class="pre">load_paths</span></tt> are given, in which case this will
only serve as the output directory.</p>
<p>In the url space, it is mapped to <tt class="xref py py-attr docutils literal"><span class="pre">urls</span></tt>.</p>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.url">
<tt class="descclassname">Environment.</tt><tt class="descname">url</tt><a class="headerlink" href="#webassets.env.Environment.url" title="Permalink to this definition">¶</a></dt>
<dd><p>The url prefix used to construct urls for files in
<a class="reference internal" href="index.html#webassets.env.Environment.directory" title="webassets.env.Environment.directory"><tt class="xref py py-attr docutils literal"><span class="pre">directory</span></tt></a>.</p>
<p>To define url spaces for other directories, see
<a class="reference internal" href="index.html#webassets.env.Environment.url_mapping" title="webassets.env.Environment.url_mapping"><tt class="xref py py-attr docutils literal"><span class="pre">url_mapping</span></tt></a>.</p>
</dd></dl>

<span class="target" id="environment-setting-debug"></span><dl class="attribute">
<dt id="webassets.env.Environment.debug">
<tt class="descclassname">Environment.</tt><tt class="descname">debug</tt><a class="headerlink" href="#webassets.env.Environment.debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable/disable debug mode. Possible values are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">False</span></tt></dt>
<dd>Production mode. Bundles will be merged and filters applied.</dd>
<dt><tt class="docutils literal"><span class="pre">True</span></tt></dt>
<dd>Enable debug mode. Bundles will output their individual source
files.</dd>
<dt><em>&#8220;merge&#8221;</em></dt>
<dd>Merge the source files, but do not apply filters.</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.auto_build">
<tt class="descclassname">Environment.</tt><tt class="descname">auto_build</tt><a class="headerlink" href="#webassets.env.Environment.auto_build" title="Permalink to this definition">¶</a></dt>
<dd><p>Controls whether bundles should be automatically built, and
rebuilt, when required (if set to <tt class="docutils literal"><span class="pre">True</span></tt>), or whether they
must be built manually be the user, for example via a management
command.</p>
<p>This is a good setting to have enabled during debugging, and can
be very convenient for low-traffic sites in production as well.
However, there is a cost in checking whether the source files
have changed, so if you care about performance, or if your build
process takes very long, then you may want to disable this.</p>
<p>By default automatic building is enabled.</p>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.url_expire">
<tt class="descclassname">Environment.</tt><tt class="descname">url_expire</tt><a class="headerlink" href="#webassets.env.Environment.url_expire" title="Permalink to this definition">¶</a></dt>
<dd><p>If you send your assets to the client using a
<em>far future expires</em> header (to minimize the 304 responses
your server has to send), you need to make sure that assets
will be reloaded by the browser when they change.</p>
<p>If this is set to <tt class="docutils literal"><span class="pre">True</span></tt>, then the Bundle URLs generated by
webassets will have their version (see <tt class="docutils literal"><span class="pre">Environment.versions</span></tt>)
appended as a querystring.</p>
<p>An alternative approach would be to use the <tt class="docutils literal"><span class="pre">%(version)s</span></tt>
placeholder in the bundle output file.</p>
<p>The default behavior (indicated by a <tt class="docutils literal"><span class="pre">None</span></tt> value) is to add
an expiry querystring if the bundle does not use a version
placeholder.</p>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.versions">
<tt class="descclassname">Environment.</tt><tt class="descname">versions</tt><a class="headerlink" href="#webassets.env.Environment.versions" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines what should be used as a Bundle <tt class="docutils literal"><span class="pre">version</span></tt>.</p>
<p>A bundle&#8217;s version is what is appended to URLs when the
<tt class="docutils literal"><span class="pre">url_expire</span></tt> option is enabled, and the version can be part
of a Bundle&#8217;s output filename by use of the <tt class="docutils literal"><span class="pre">%(version)s</span></tt>
placeholder.</p>
<p>Valid values are:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">timestamp</span></tt></dt>
<dd>The version is determined by looking at the mtime of a
bundle&#8217;s output file.</dd>
<dt><tt class="docutils literal"><span class="pre">hash</span></tt> (default)</dt>
<dd>The version is a hash over the output file&#8217;s content.</dd>
<dt><tt class="docutils literal"><span class="pre">False</span></tt>, <tt class="docutils literal"><span class="pre">None</span></tt></dt>
<dd>Functionality that requires a version is disabled. This
includes the <tt class="docutils literal"><span class="pre">url_expire</span></tt> option, the <tt class="docutils literal"><span class="pre">auto_build</span></tt>
option, and support for the %(version)s placeholder.</dd>
</dl>
<p>Any custom version implementation.</p>
</div></blockquote>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.manifest">
<tt class="descclassname">Environment.</tt><tt class="descname">manifest</tt><a class="headerlink" href="#webassets.env.Environment.manifest" title="Permalink to this definition">¶</a></dt>
<dd><p>A manifest persists information about the versions bundles
are at.</p>
<p>The Manifest plays a role only if you insert the bundle version
in your output filenames, or append the version as a querystring
to the url (via the <tt class="docutils literal"><span class="pre">url_expire</span></tt> option). It serves two
purposes:</p>
<blockquote>
<div><ul class="simple">
<li>Without a manifest, it may be impossible to determine the
version at runtime. In a deployed app, the media files may
be stored on a different server entirely, and be
inaccessible from the application code. The manifest,
if shipped with your application, is what still allows to
construct the proper URLs.</li>
<li>Even if it were possible to determine the version at
runtime without a manifest, it may be a costly process,
and using a manifest may give you better performance. If
you use a hash-based version for example, this hash would
need to be recalculated every time a new process is
started.</li>
</ul>
</div></blockquote>
<p>Valid values are:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">&quot;cache&quot;</span></tt> (default)</dt>
<dd>The cache is used to remember version information. This
is useful to avoid recalculating the version hash.</dd>
<dt><tt class="docutils literal"><span class="pre">&quot;file:{path}&quot;</span></tt></dt>
<dd>Stores version information in a file at {path}. If not
path is given, the manifest will be stored as
<tt class="docutils literal"><span class="pre">.webassets-manifest</span></tt> in <tt class="docutils literal"><span class="pre">Environment.directory</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">&quot;json:{path}&quot;</span></tt></dt>
<dd>Same as &#8220;file:{path}&#8221;, but uses JSON to store the information.</dd>
<dt><tt class="docutils literal"><span class="pre">False</span></tt>, <tt class="docutils literal"><span class="pre">None</span></tt></dt>
<dd>No manifest is used.</dd>
</dl>
<p>Any custom manifest implementation.</p>
</div></blockquote>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.cache">
<tt class="descclassname">Environment.</tt><tt class="descname">cache</tt><a class="headerlink" href="#webassets.env.Environment.cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Controls the behavior of the cache. The cache will speed up rebuilding
of your bundles, by caching individual filter results. This can be
particularly useful while developing, if your bundles would otherwise take
a long time to rebuild.</p>
<p>Possible values are:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">False</span></tt></dt>
<dd>Do not use the cache.</dd>
<dt><tt class="docutils literal"><span class="pre">True</span></tt> (default)</dt>
<dd>Cache using default location, a <tt class="docutils literal"><span class="pre">.webassets-cache</span></tt> folder inside
<a class="reference internal" href="index.html#webassets.env.Environment.directory" title="webassets.env.Environment.directory"><tt class="xref py py-attr docutils literal"><span class="pre">directory</span></tt></a>.</dd>
<dt><em>custom path</em></dt>
<dd>Use the given directory as the cache directory.</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.load_path">
<tt class="descclassname">Environment.</tt><tt class="descname">load_path</tt><a class="headerlink" href="#webassets.env.Environment.load_path" title="Permalink to this definition">¶</a></dt>
<dd><p>An list of directories that will be searched for source files.</p>
<p>If this is set, source files will only be looked for in these
directories, and <a class="reference internal" href="index.html#webassets.env.Environment.directory" title="webassets.env.Environment.directory"><tt class="xref py py-attr docutils literal"><span class="pre">directory</span></tt></a> is used as a location for
output files only.</p>
<p>To modify this list, you should use <tt class="xref py py-meth docutils literal"><span class="pre">append_path()</span></tt>, since
it makes it easy to add the corresponding url prefix to
<a class="reference internal" href="index.html#webassets.env.Environment.url_mapping" title="webassets.env.Environment.url_mapping"><tt class="xref py py-attr docutils literal"><span class="pre">url_mapping</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.url_mapping">
<tt class="descclassname">Environment.</tt><tt class="descname">url_mapping</tt><a class="headerlink" href="#webassets.env.Environment.url_mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary of directory -&gt; url prefix mappings that will
be considered when generating urls, in addition to the pair of
<a class="reference internal" href="index.html#webassets.env.Environment.directory" title="webassets.env.Environment.directory"><tt class="xref py py-attr docutils literal"><span class="pre">directory</span></tt></a> and <a class="reference internal" href="index.html#webassets.env.Environment.url" title="webassets.env.Environment.url"><tt class="xref py py-attr docutils literal"><span class="pre">url</span></tt></a>, which is always active.</p>
<p>You should use <tt class="xref py py-meth docutils literal"><span class="pre">append_path()</span></tt> to add directories to the
load path along with their respective url spaces, instead of
modifying this setting directly.</p>
</dd></dl>

</div>
<div class="section" id="filter-configuration">
<h6>Filter configuration<a class="headerlink" href="#filter-configuration" title="Permalink to this headline">¶</a></h6>
<p>In addition to the standard options listed above, you can set custom
configuration values using <tt class="docutils literal"><span class="pre">Environment.config</span></tt>. This is so that you can
configure filters through the environment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">environment</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;sass_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;/opt/sass/bin/sass&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This allows the <a class="reference internal" href="index.html#filters-sass"><em>Sass filter</em></a> to find the sass
binary.</p>
<p>Note: Filters usually allow you to define these values as system
environment variables as well. That is, you could also define a
<tt class="docutils literal"><span class="pre">SASS_BIN</span></tt> environment variable to setup the filter.</p>
</div>
</div>
<span id="document-bundles"></span><div class="section" id="bundles">
<span id="id1"></span><h5>Bundles<a class="headerlink" href="#bundles" title="Permalink to this headline">¶</a></h5>
<p>A bundle is simply a collection of files that you would like to group
together, with some properties attached to tell <tt class="docutils literal"><span class="pre">webassets</span></tt>
how to do its job. Such properties include the filters which should
be applied, or the location where the output file should be stored.</p>
<p>Note that all filenames and paths considered to be relative to the
<tt class="docutils literal"><span class="pre">directory</span></tt> setting of your <a class="reference internal" href="index.html#document-environment"><em>environment</em></a>, and
generated urls will be relative to the <tt class="docutils literal"><span class="pre">url</span></tt> setting.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;common/inheritance.js&#39;</span><span class="p">,</span> <span class="s">&#39;portal/js/common.js&#39;</span><span class="p">,</span>
       <span class="s">&#39;portal/js/plot.js&#39;</span><span class="p">,</span> <span class="s">&#39;portal/js/ticker.js&#39;</span><span class="p">,</span>
       <span class="n">filters</span><span class="o">=</span><span class="s">&#39;jsmin&#39;</span><span class="p">,</span>
       <span class="n">output</span><span class="o">=</span><span class="s">&#39;gen/packed.js&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A bundle takes any number of filenames, as well as the following keyword
arguments:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">filters</span></tt> -
One or multiple filters to apply. If no filters are specified, the
source files will merely be merged into the output file. Filters are
applied in the order in which they are given.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">output</span></tt> - Name/path of the output file. All source files will be merged
and the result stored at this location. A <tt class="docutils literal"><span class="pre">%(version)s</span></tt> placeholder is
supported here, which will be replaced with the version of the file. See
<a class="reference internal" href="index.html#document-expiring"><em>URL Expiry (cache busting)</em></a>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">depends</span></tt> - Additional files that will be watched to determine if the
bundle needs to be rebuilt. This is usually necessary if you are using
compilers that allow <tt class="docutils literal"><span class="pre">&#64;import</span></tt> instructions. Commonly, one would use a
glob instruction here for simplicity:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="n">depends</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;**/*.scss&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Currently, using <tt class="docutils literal"><span class="pre">depends</span></tt> disables caching for a bundle.</p>
</div>
</li>
</ul>
<div class="section" id="nested-bundles">
<h6>Nested bundles<a class="headerlink" href="#nested-bundles" title="Permalink to this headline">¶</a></h6>
<p>Bundles may also contain other bundles:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets</span> <span class="kn">import</span> <span class="n">Bundle</span>

<span class="n">all_js</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span>
    <span class="c"># jQuery</span>
    <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;common/libs/jquery/jquery.js&#39;</span><span class="p">,</span>
        <span class="s">&#39;common/libs/jquery/jquery.ajaxQueue.js&#39;</span><span class="p">,</span>
        <span class="s">&#39;common/libs/jquery/jquery.bgiframe.js&#39;</span><span class="p">,),</span>
    <span class="c"># jQuery Tools</span>
    <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;common/libs/jqtools/tools.tabs.js&#39;</span><span class="p">,</span>
        <span class="s">&#39;common/libs/jqtools/tools.tabs.history.js&#39;</span><span class="p">,</span>
        <span class="s">&#39;common/libs/jqtools/tools.tabs.slideshow.js&#39;</span><span class="p">),</span>
    <span class="c"># Our own stuff</span>
    <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;common/inheritance.js&#39;</span><span class="p">,</span> <span class="s">&#39;portal/js/common.js&#39;</span><span class="p">,</span>
        <span class="s">&#39;portal/js/plot.js&#39;</span><span class="p">,</span> <span class="s">&#39;portal/js/ticker.js&#39;</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">=</span><span class="s">&#39;jsmin&#39;</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="s">&#39;gen/packed.js&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, the use of nested <tt class="docutils literal"><span class="pre">Bundle</span></tt> objects to group the JavaScript files
together is purely aesthetical. You could just as well pass all files as
a flat list. However, there are some more serious application as well.
One of them is the use of <a class="reference internal" href="index.html#document-css_compilers"><em>CSS compilers</em></a>.
Another would be dealing with pre-compressed files:</p>
<p>If you are using a JavaScript library like <a class="reference external" href="http://jquery.com/">jQuery</a>,
you might find yourself with a file like <tt class="docutils literal"><span class="pre">jquery.min.js</span></tt> in your media
directory, i.e. it is already minified - no reason to do it again.</p>
<p>While I would recommend always using the raw source files, and letting
<tt class="docutils literal"><span class="pre">webassets</span></tt> do the compressing, if you do have minified files that you
need to merge together with uncompressed ones, you could do it like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">register</span><span class="p">(</span><span class="s">&#39;js-all&#39;</span><span class="p">,</span>
    <span class="s">&#39;jquery.min.js&#39;</span><span class="p">,</span>
    <span class="n">Bundle</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="s">&#39;jsmin&#39;</span><span class="p">,</span> <span class="s">&#39;uncompressed.js&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Generally speaking, nested bundles allow you to apply different sets of
filters to different groups of files, but still everything together
into a single output file.</p>
<p>Some things to consider when nesting bundles:</p>
<ul class="simple">
<li>Duplicate filters are only applied once (the leaf filter is applied).</li>
<li>If a bundle that is supposed to be processed to a file does not define
an output target, it simply serves as a container of its sub-bundles,
which in turn will be processed into their respective output files.
In this case it must not have any files of its own.</li>
</ul>
</div>
<div class="section" id="building-bundles">
<h6>Building bundles<a class="headerlink" href="#building-bundles" title="Permalink to this headline">¶</a></h6>
<p>Once a bundle is defined, the thing you want to do is build it, and then
include a link to the final merged and compressed output file in your
site.</p>
<p>There are different approaches.</p>
<div class="section" id="in-code">
<h7>In Code<a class="headerlink" href="#in-code" title="Permalink to this headline">¶</a></h7>
<p>For starters, you can simply call the bundle&#8217;s <tt class="docutils literal"><span class="pre">urls()</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="p">[</span><span class="s">&#39;all_js&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">urls</span><span class="p">()</span>
<span class="go">(&#39;/media/gen/packed.js&#39;,)</span>
</pre></div>
</div>
<p>Depending on the value of <tt class="docutils literal"><span class="pre">environment.debug</span></tt>. it will either return
a list of all the bundle&#8217;s source files, or the merged file pointed to
by the bundle&#8217;s <tt class="docutils literal"><span class="pre">output</span></tt> option - all relative to the
<tt class="docutils literal"><span class="pre">environment.url</span></tt> setting.</p>
<p><tt class="docutils literal"><span class="pre">urls()</span></tt> will always ensure that the files behind the urls it returns
actually exist. That is, it will merge and compress the source files in
production mode when first called, and update the compressed assets when
it detects changes. This behavior can be customized using various
<a class="reference internal" href="index.html#environment-configuration"><em>environment configuration values</em></a>.</p>
<p>Call <tt class="docutils literal"><span class="pre">urls()</span></tt> once per request, and pass the resulting list of urls to
your template, and you&#8217;re good to go.</p>
</div>
<div class="section" id="in-templates">
<h7>In templates<a class="headerlink" href="#in-templates" title="Permalink to this headline">¶</a></h7>
<p>For <a class="reference internal" href="index.html#document-integration/index"><em>some template languages</em></a>, webassets
includes extensions which allow you to access the bundles you defined.
Further, they usually allow you to define bundles on-the-fly, so you can
reference your assets directly from within your templates, rather than
predefining them in code.</p>
<p>For example, there is a template tag for <a class="reference internal" href="index.html#document-integration/jinja2"><em>Jinja2</em></a>,
which allows you do something like this:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">filters</span><span class="o">=</span><span class="s2">&quot;cssmin,datauri&quot;</span><span class="o">,</span> <span class="nv">output</span><span class="o">=</span><span class="s2">&quot;gen/packed.css&quot;</span><span class="o">,</span> <span class="s2">&quot;common/jquery.css&quot;</span><span class="o">,</span> <span class="s2">&quot;site/base.css&quot;</span><span class="o">,</span> <span class="s2">&quot;site/widgets.css&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">...</span>
</pre></div>
</div>
</div>
<div class="section" id="management-command">
<h7>Management command<a class="headerlink" href="#management-command" title="Permalink to this headline">¶</a></h7>
<p>In some cases you  might prefer to cause a manual build of your bundles
from the command line. See <a class="reference internal" href="index.html#document-script"><em>Command Line Interface</em></a> for more information.</p>
</div>
</div>
</div>
<span id="document-script"></span><div class="section" id="command-line-interface">
<h5>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h5>
<p>While it&#8217;s often convienient to have webassets automatically rebuild
your bundles on access, you sometimes may prefer to build manually,
for example for performance reasons in larger deployments.</p>
<p><em>webassets</em> provides a command line interface which is supposed to help
you manage your bundles manually. However, due to the generic nature of
the webassets core library, it usually needs some help setting up.</p>
<p>You may want to check the <a class="reference internal" href="index.html#document-integration/index"><em>integration page</em></a>
to see if webassets already provides helpers to expose the command line
within your framework. If that is not the case, read on.</p>
<div class="section" id="build-a-custom-command-line-client">
<h6>Build a custom command line client<a class="headerlink" href="#build-a-custom-command-line-client" title="Permalink to this headline">¶</a></h6>
<p>In most cases, you can simple wrap around the <tt class="docutils literal"><span class="pre">webassets.script.main</span></tt>
function. For example, the command provided by Flask-Assets looks like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ManageAssets</span><span class="p">(</span><span class="n">flaskext</span><span class="o">.</span><span class="n">script</span><span class="o">.</span><span class="n">Command</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets_env</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">assets_env</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">prog</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">remaining_args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">webassets</span> <span class="kn">import</span> <span class="n">script</span>
        <span class="n">script</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">remaining_args</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
</pre></div>
</div>
<p>In cases where this isn&#8217;t possible for some reason, or you need more
control, you can work directly with the
<tt class="docutils literal"><span class="pre">webassets.script.CommandLineEnvironment</span></tt> class, which implements all
the commands as simple methods.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">webassets.script</span> <span class="kn">import</span> <span class="n">CommandLineEnvironment</span>

<span class="c"># Setup a logger</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;webassets&#39;</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">())</span>
<span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="n">cmdenv</span> <span class="o">=</span> <span class="n">CommandLineEnvironment</span><span class="p">(</span><span class="n">assets_env</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
<span class="n">cmdenv</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="s">&#39;build&#39;</span><span class="p">)</span>

<span class="c"># This would also work</span>
<span class="n">cmdenv</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>You are reponsible for parsing the command line in any way you see fit
(using for example the <a class="reference external" href="http://docs.python.org/library/optparse.html#module-optparse" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">optparse</span></tt></a> or <a class="reference external" href="http://docs.python.org/library/argparse.html#module-argparse" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">argparse</span></tt></a> libraries,
or whatever your framework provides as a command line utility shell), and
then invoking the corresponding methods on your instance of
<tt class="docutils literal"><span class="pre">CommandLineEnvironment</span></tt>.</p>
</div>
<div class="section" id="included-commands">
<span id="script-commands"></span><h6>Included Commands<a class="headerlink" href="#included-commands" title="Permalink to this headline">¶</a></h6>
<p>The following describes the commands that will be available to you through
the <em>webassets</em> CLI interface.</p>
<div class="section" id="build">
<h7>build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h7>
<p>Builds all bundles, regardless of whether they are detected as having changed
or not.</p>
</div>
<div class="section" id="watch">
<h7>watch<a class="headerlink" href="#watch" title="Permalink to this headline">¶</a></h7>
<p>Start a daemon which monitors your bundle source files, and automatically
rebuilds bundles when a change is detected.</p>
<p>This can be useful during development, if building is not instantaneous, and
you are losing valuable time waiting for the build to finish while trying to
access your site.</p>
</div>
<div class="section" id="clean">
<h7>clean<a class="headerlink" href="#clean" title="Permalink to this headline">¶</a></h7>
<p>Will clear out the cache, which after a while can grow quite large.</p>
</div>
</div>
</div>
<span id="document-builtin_filters"></span><span class="target" id="module-webassets.filter"></span><div class="section" id="included-filters">
<span id="builtin-filters"></span><h5>Included Filters<a class="headerlink" href="#included-filters" title="Permalink to this headline">¶</a></h5>
<p>The following filters are included in <tt class="docutils literal"><span class="pre">webassets</span></tt>, though some may
require the installation of an external library, or the availability of
external tools.</p>
<p>You can also write <a class="reference internal" href="index.html#document-custom_filters"><em>custom filters</em></a>.</p>
<div class="section" id="javascript-compressors">
<h6>Javascript compressors<a class="headerlink" href="#javascript-compressors" title="Permalink to this headline">¶</a></h6>
<div class="section" id="rjsmin">
<h7><tt class="docutils literal"><span class="pre">rjsmin</span></tt><a class="headerlink" href="#rjsmin" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.rjsmin.RJSMin">
<em class="property">class </em><tt class="descclassname">webassets.filter.rjsmin.</tt><tt class="descname">RJSMin</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.rjsmin.RJSMin" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies Javascript by removing whitespace, comments, etc.</p>
<p>Uses the <a class="reference external" href="http://opensource.perlig.de/rjsmin/">rJSmin library</a>,
which is included with webassets. However, if you have the external
package installed, it will be used instead. You may want to do this
to get access to the faster C-extension.</p>
</dd></dl>

</div>
<div class="section" id="module-webassets.filter.yui">
<span id="yui-js"></span><h7><tt class="docutils literal"><span class="pre">yui_js</span></tt><a class="headerlink" href="#module-webassets.filter.yui" title="Permalink to this headline">¶</a></h7>
<p>Minify Javascript and CSS with
<a class="reference external" href="http://developer.yahoo.com/yui/compressor/">YUI Compressor</a>.</p>
<p>YUI Compressor is an external tool written in Java, which needs to be
available. One way to get it is to install the
<a class="reference external" href="http://pypi.python.org/pypi/yuicompressor">yuicompressor</a> package:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install yuicompressor
</pre></div>
</div>
<p>No configuration is necessary in this case.</p>
<p>You can also get YUI compressor a different way and define
a <tt class="docutils literal"><span class="pre">YUI_COMPRESSOR_PATH</span></tt> setting that points to the <tt class="docutils literal"><span class="pre">.jar</span></tt> file.
Otherwise, an environment variable by the same name is tried. The
filter will also look for a <tt class="docutils literal"><span class="pre">JAVA_HOME</span></tt> environment variable to
run the <tt class="docutils literal"><span class="pre">.jar</span></tt> file, or will otherwise assume that <tt class="docutils literal"><span class="pre">java</span></tt> is
on the system path.</p>
<dl class="class">
<dt id="webassets.filter.yui.YUIJS">
<em class="property">class </em><tt class="descclassname">webassets.filter.yui.</tt><tt class="descname">YUIJS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.yui.YUIJS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-webassets.filter.closure">
<span id="closure-js"></span><h7><tt class="docutils literal"><span class="pre">closure_js</span></tt><a class="headerlink" href="#module-webassets.filter.closure" title="Permalink to this headline">¶</a></h7>
<p>Minify Javascript with <a class="reference external" href="https://code.google.com/p/closure-compiler/">Google Closure Compiler</a>.</p>
<p>Google Closure Compiler is an external tool written in Java, which needs
to be available. One way to get it is to install the
<a class="reference external" href="http://pypi.python.org/pypi/closure">closure</a> package:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install closure
</pre></div>
</div>
<p>No configuration is necessary in this case.</p>
<p>You can also define a <tt class="docutils literal"><span class="pre">CLOSURE_COMPRESSOR_PATH</span></tt> setting that
points to the <tt class="docutils literal"><span class="pre">.jar</span></tt> file. Otherwise, an environment variable by
the same name is tried. The filter will also look for a <tt class="docutils literal"><span class="pre">JAVA_HOME</span></tt>
environment variable to run the <tt class="docutils literal"><span class="pre">.jar</span></tt> file, or will otherwise
assume that <tt class="docutils literal"><span class="pre">java</span></tt> is on the system path.</p>
<p>Supported configuration options:</p>
<dl class="docutils">
<dt>CLOSURE_COMPRESSOR_OPTIMIZATION</dt>
<dd>Corresponds to Google Closure&#8217;s <a class="reference external" href="https://code.google.com/closure/compiler/docs/compilation_levels.html">compilation level parameter</a>.</dd>
<dt>CLOSURE_EXTRA_ARGS</dt>
<dd><p class="first">A list of further options to be passed to the Closure compiler.
There are a lot of them.</p>
<p>For options which take values you want to use two items in the list:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;--output_wrapper&#39;</span><span class="p">,</span> <span class="s">&#39;foo: </span><span class="si">%o</span><span class="s">utput%&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="uglifyjs">
<h7><tt class="docutils literal"><span class="pre">uglifyjs</span></tt><a class="headerlink" href="#uglifyjs" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.uglifyjs.UglifyJS">
<em class="property">class </em><tt class="descclassname">webassets.filter.uglifyjs.</tt><tt class="descname">UglifyJS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.uglifyjs.UglifyJS" title="Permalink to this definition">¶</a></dt>
<dd><p>Minify Javascript using <a class="reference external" href="https://github.com/mishoo/UglifyJS/">UglifyJS</a>.</p>
<p>The filter requires version 2 of UglifyJS.</p>
<p>UglifyJS is an external tool written for NodeJS; this filter assumes that
the <tt class="docutils literal"><span class="pre">uglifyjs</span></tt> executable is in the path. Otherwise, you may define
a <tt class="docutils literal"><span class="pre">UGLIFYJS_BIN</span></tt> setting.</p>
<p>Additional options may be passed to <tt class="docutils literal"><span class="pre">uglifyjs</span></tt> using the setting
<tt class="docutils literal"><span class="pre">UGLIFYJS_EXTRA_ARGS</span></tt>, which expects a list of strings.</p>
</dd></dl>

</div>
<div class="section" id="jsmin">
<h7><tt class="docutils literal"><span class="pre">jsmin</span></tt><a class="headerlink" href="#jsmin" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.jsmin.JSMin">
<em class="property">class </em><tt class="descclassname">webassets.filter.jsmin.</tt><tt class="descname">JSMin</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.jsmin.JSMin" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies Javascript by removing whitespace, comments, etc.</p>
<p>This filter uses a Python port of Douglas Crockford&#8217;s <a class="reference external" href="http://www.crockford.com/javascript/jsmin.html">JSMin</a>, which needs
to be installed separately.</p>
<p>There are actually multiple implementations available, for
example one by Baruch Even. Easiest to install via PyPI is
the one by Dave St. Germain:</p>
<div class="highlight-python"><div class="highlight"><pre>$ pip install jsmin
</pre></div>
</div>
<p>The filter is tested with this <tt class="docutils literal"><span class="pre">jsmin</span></tt> package from PyPI,
but will work with any module that exposes a
<tt class="docutils literal"><span class="pre">JavascriptMinify</span></tt> object with a <tt class="docutils literal"><span class="pre">minify</span></tt> method.</p>
<p>If you want to avoid installing another dependency, use the
<a class="reference internal" href="index.html#webassets.filter.rjsmin.RJSMin" title="webassets.filter.rjsmin.RJSMin"><tt class="xref py py-class docutils literal"><span class="pre">webassets.filter.rjsmin.RJSMin</span></tt></a> filter instead.</p>
</dd></dl>

</div>
<div class="section" id="jspacker">
<h7><tt class="docutils literal"><span class="pre">jspacker</span></tt><a class="headerlink" href="#jspacker" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.jspacker.JSPacker">
<em class="property">class </em><tt class="descclassname">webassets.filter.jspacker.</tt><tt class="descname">JSPacker</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.jspacker.JSPacker" title="Permalink to this definition">¶</a></dt>
<dd><p>Reduces the size of Javascript using an inline compression
algorithm, i.e. the script will be unpacked on the client side
by the browser.</p>
<p>Based on Dean Edwards&#8217; <a class="reference external" href="http://dean.edwards.name/packer/">jspacker 2</a>,
as ported by Florian Schulze.</p>
</dd></dl>

</div>
<div class="section" id="slimit">
<h7><tt class="docutils literal"><span class="pre">slimit</span></tt><a class="headerlink" href="#slimit" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.slimit.Slimit">
<em class="property">class </em><tt class="descclassname">webassets.filter.slimit.</tt><tt class="descname">Slimit</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.slimit.Slimit" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies JS.</p>
<p>Requires the <tt class="docutils literal"><span class="pre">slimit</span></tt> package (<a class="reference external" href="https://github.com/rspivak/slimit">https://github.com/rspivak/slimit</a>),
which is a JavaScript minifier written in Python. It compiles JavaScript
into more compact code so that it downloads and runs faster.</p>
<p>Right now it does not use the mangle options to its minifier.</p>
</dd></dl>

</div>
</div>
<div class="section" id="css-compressors">
<h6>CSS compressors<a class="headerlink" href="#css-compressors" title="Permalink to this headline">¶</a></h6>
<div class="section" id="cssmin">
<h7><tt class="docutils literal"><span class="pre">cssmin</span></tt><a class="headerlink" href="#cssmin" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.cssmin.CSSMin">
<em class="property">class </em><tt class="descclassname">webassets.filter.cssmin.</tt><tt class="descname">CSSMin</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.cssmin.CSSMin" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies CSS.</p>
<p>Requires the <tt class="docutils literal"><span class="pre">cssmin</span></tt> package (<a class="reference external" href="http://github.com/zacharyvoase/cssmin">http://github.com/zacharyvoase/cssmin</a>),
which is a port of the YUI CSS compression algorithm.</p>
</dd></dl>

</div>
<div class="section" id="cssutils">
<h7><tt class="docutils literal"><span class="pre">cssutils</span></tt><a class="headerlink" href="#cssutils" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.cssutils.CSSUtils">
<em class="property">class </em><tt class="descclassname">webassets.filter.cssutils.</tt><tt class="descname">CSSUtils</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.cssutils.CSSUtils" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies CSS by removing whitespace, comments etc., using the Python
<a class="reference external" href="http://cthedot.de/cssutils/">cssutils</a> library.</p>
<p>Note that since this works as a parser on the syntax level, so invalid
CSS input could potentially result in data loss.</p>
</dd></dl>

</div>
<div class="section" id="yui-css">
<h7><tt class="docutils literal"><span class="pre">yui_css</span></tt><a class="headerlink" href="#yui-css" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.yui.YUICSS">
<em class="property">class </em><tt class="descclassname">webassets.filter.yui.</tt><tt class="descname">YUICSS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.yui.YUICSS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="cleancss">
<h7><tt class="docutils literal"><span class="pre">cleancss</span></tt><a class="headerlink" href="#cleancss" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.cleancss.CleanCSS">
<em class="property">class </em><tt class="descclassname">webassets.filter.cleancss.</tt><tt class="descname">CleanCSS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.cleancss.CleanCSS" title="Permalink to this definition">¶</a></dt>
<dd><p>Minify css using <a class="reference external" href="https://github.com/GoalSmashers/clean-css/">Clean-css</a>.</p>
<p>Clean-css is an external tool written for NodeJS; this filter assumes that
the <tt class="docutils literal"><span class="pre">cleancss</span></tt> executable is in the path. Otherwise, you may define
a <tt class="docutils literal"><span class="pre">CLEANCSS_BIN</span></tt> setting.</p>
<p>Additional options may be passed to <tt class="docutils literal"><span class="pre">cleancss</span></tt> binary using the setting
<tt class="docutils literal"><span class="pre">CLEANCSS_EXTRA_ARGS</span></tt>, which expects a list of strings.</p>
</dd></dl>

</div>
<div class="section" id="slimmer-css">
<h7><tt class="docutils literal"><span class="pre">slimmer_css</span></tt><a class="headerlink" href="#slimmer-css" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.slimmer.CSSSlimmer">
<em class="property">class </em><tt class="descclassname">webassets.filter.slimmer.</tt><tt class="descname">CSSSlimmer</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.slimmer.CSSSlimmer" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies CSS by removing whitespace, comments etc., using the Python
<a class="reference external" href="http://pypi.python.org/pypi/slimmer/">slimmer</a> library.</p>
</dd></dl>

</div>
</div>
<div class="section" id="js-css-compilers">
<span id="filters-css-compilers"></span><h6>JS/CSS compilers<a class="headerlink" href="#js-css-compilers" title="Permalink to this headline">¶</a></h6>
<div class="section" id="clevercss">
<h7><tt class="docutils literal"><span class="pre">clevercss</span></tt><a class="headerlink" href="#clevercss" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.clevercss.CleverCSS">
<em class="property">class </em><tt class="descclassname">webassets.filter.clevercss.</tt><tt class="descname">CleverCSS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.clevercss.CleverCSS" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://sandbox.pocoo.org/clevercss/">CleverCSS</a> markup
to real CSS.</p>
<p>If you want to combine it with other CSS filters, make sure this one
runs first.</p>
</dd></dl>

</div>
<div class="section" id="less">
<span id="filters-less"></span><h7><tt class="docutils literal"><span class="pre">less</span></tt><a class="headerlink" href="#less" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.less.Less">
<em class="property">class </em><tt class="descclassname">webassets.filter.less.</tt><tt class="descname">Less</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.less.Less" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://lesscss.org/">less</a> markup to real CSS.</p>
<p>This depends on the NodeJS implementation of less, installable via npm.
To use the old Ruby-based version (implemented in the 1.x Ruby gem), see
<a class="reference internal" href="index.html#webassets.filter.less_ruby.Less" title="webassets.filter.less_ruby.Less"><tt class="xref py py-class docutils literal"><span class="pre">Less</span></tt></a>.</p>
<p><em>Supported configuration options</em>:</p>
<dl class="docutils">
<dt>LESS_BIN (binary)</dt>
<dd>Path to the less executable used to compile source files. By default,
the filter will attempt to run <tt class="docutils literal"><span class="pre">lessc</span></tt> via the system path.</dd>
<dt>LESS_LINE_NUMBERS (line_numbers)</dt>
<dd>Outputs filename and line numbers. Can be either &#8216;comments&#8217;, which
will output the debug info within comments, &#8216;mediaquery&#8217; that will
output the information within a fake media query which is compatible
with the SASSPath to the less executable used to compile source files.</dd>
<dt>LESS_RUN_IN_DEBUG (run_in_debug)</dt>
<dd>By default, the filter will compile in debug mode. Since the less
compiler is written in Javascript and capable of running in the
browser, you can set this to <tt class="docutils literal"><span class="pre">False</span></tt> to have your original less
source files served (see below).</dd>
<dt>LESS_PATHS (paths)</dt>
<dd>Add include paths for less command line.
It should be a list of paths relatives to Environment.directory or absolute paths.
Order matters as less will pick the first file found in path order.</dd>
</dl>
<div class="admonition-compiling-less-in-the-browser admonition">
<p class="first admonition-title">Compiling less in the browser</p>
<p>less is an interesting case because it is written in Javascript and
capable of running in the browser. While for performance reason you
should prebuild your stylesheets in production, while developing you
may be interested in serving the original less files to the client,
and have less compile them in the browser.</p>
<p>To do so, you first need to make sure the less filter is not applied
when <tt class="xref py py-attr docutils literal"><span class="pre">Environment.debug</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt>. You can do so via an
option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;less_run_in_debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<p>Second, in order for the less to identify the  less source files as
needing to be compiled, they have to be referenced with a
<tt class="docutils literal"><span class="pre">rel=&quot;stylesheet/less&quot;</span></tt> attribute. One way to do this is to use the
<tt class="xref py py-attr docutils literal"><span class="pre">Bundle.extra</span></tt> dictionary, which works well with the template
tags that webassets provides for some template languages:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">less_bundle</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span>
    <span class="s">&#39;**/*.less&#39;</span><span class="p">,</span>
    <span class="n">filters</span><span class="o">=</span><span class="s">&#39;less&#39;</span><span class="p">,</span>
    <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;rel&#39;</span><span class="p">:</span> <span class="s">&#39;stylesheet/less&#39;</span> <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span> <span class="k">else</span> <span class="s">&#39;stylesheet&#39;</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then, for example in a Jinja2 template, you would write:</p>
<div class="highlight-python"><div class="highlight"><pre>{% assets less_bundle %}
    &lt;link rel=&quot;{{ EXTRA.rel }}&quot; type=&quot;text/css&quot; href=&quot;{{ ASSET_URL }}&quot;&gt;
{% endassets %}
</pre></div>
</div>
<p>With this, the <tt class="docutils literal"><span class="pre">&lt;link&gt;</span></tt> tag will sport the correct <tt class="docutils literal"><span class="pre">rel</span></tt> value both
in development and in production.</p>
<p>Finally, you need to include the less compiler:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
    <span class="n">js_bundle</span><span class="o">.</span><span class="n">contents</span> <span class="o">+=</span> <span class="s">&#39;http://lesscss.googlecode.com/files/less-1.3.0.min.js&#39;</span>
</pre></div>
</div>
</div>
</dd></dl>

</div>
<div class="section" id="less-ruby">
<h7><tt class="docutils literal"><span class="pre">less_ruby</span></tt><a class="headerlink" href="#less-ruby" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.less_ruby.Less">
<em class="property">class </em><tt class="descclassname">webassets.filter.less_ruby.</tt><tt class="descname">Less</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.less_ruby.Less" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://lesscss.org/">Less</a> markup to real CSS.</p>
<p>This uses the old Ruby implementation available in the 1.x versions of the
less gem. All 2.x versions of the gem are wrappers around the newer
NodeJS/Javascript implementation, which you are generally encouraged to
use, and which is available in webassets via the <a class="reference internal" href="index.html#webassets.filter.less.Less" title="webassets.filter.less.Less"><tt class="xref py py-class docutils literal"><span class="pre">Less</span></tt></a>
filter.</p>
<p>This filter for the Ruby version is being kept around for
backwards-compatibility.</p>
<p><em>Supported configuration options</em>:</p>
<dl class="docutils">
<dt>LESS_RUBY_PATH (binary)</dt>
<dd>Path to the less executable used to compile source files. By default,
the filter will attempt to run <tt class="docutils literal"><span class="pre">lessc</span></tt> via the system path.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="sass">
<span id="filters-sass"></span><h7><tt class="docutils literal"><span class="pre">sass</span></tt><a class="headerlink" href="#sass" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.sass.Sass">
<em class="property">class </em><tt class="descclassname">webassets.filter.sass.</tt><tt class="descname">Sass</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.sass.Sass" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://sass-lang.com/">Sass</a> markup to real CSS.</p>
<p>Requires the Sass executable to be available externally. To install
it, you might be able to do:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo gem install sass
</pre></div>
</div>
<p>By default, this works as an &#8220;input filter&#8221;, meaning <tt class="docutils literal"><span class="pre">sass</span></tt> is
called for each source file in the bundle. This is because the
path of the source file is required so that &#64;import directives
within the Sass file can be correctly resolved.</p>
<p>However, it is possible to use this filter as an &#8220;output filter&#8221;,
meaning the source files will first be concatenated, and then the
Sass filter is applied in one go. This can provide a speedup for
bigger projects.</p>
<p>To use Sass as an output filter:</p>
<div class="highlight-python"><div class="highlight"><pre>from webassets.filter import get_filter
sass = get_filter(&#39;sass&#39;, as_output=True)
Bundle(...., filters=(sass,))
</pre></div>
</div>
<p>However, if you want to use the output filter mode and still also
use the &#64;import directive in your Sass files, you will need to
pass along the <tt class="docutils literal"><span class="pre">load_paths</span></tt> argument, which specifies the path
to which the imports are relative to (this is implemented by
changing the working directory before calling the <tt class="docutils literal"><span class="pre">sass</span></tt>
executable):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sass</span> <span class="o">=</span> <span class="n">get_filter</span><span class="p">(</span><span class="s">&#39;sass&#39;</span><span class="p">,</span> <span class="n">as_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">load_paths</span><span class="o">=</span><span class="s">&#39;/tmp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With <tt class="docutils literal"><span class="pre">as_output=True</span></tt>, the resulting concatenation of the Sass
files is piped to Sass via stdin (<tt class="docutils literal"><span class="pre">cat</span> <span class="pre">...</span> <span class="pre">|</span> <span class="pre">sass</span> <span class="pre">--stdin</span> <span class="pre">...</span></tt>)
and may cause applications to not compile if import statements are
given as relative paths.</p>
<p>For example, if a file <tt class="docutils literal"><span class="pre">foo/bar/baz.scss</span></tt> imports file
<tt class="docutils literal"><span class="pre">foo/bar/bat.scss</span></tt> (same directory) and the import is defined as
<tt class="docutils literal"><span class="pre">&#64;import</span> <span class="pre">&quot;bat&quot;;</span></tt> then Sass will fail compiling because Sass
has naturally no information on where <tt class="docutils literal"><span class="pre">baz.scss</span></tt> is located on
disk (since the data was passed via stdin) in order for Sass to
resolve the location of <tt class="docutils literal"><span class="pre">bat.scss</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>Traceback (most recent call last):
...
webassets.exceptions.FilterError: sass: subprocess had error: stderr=(sass):1: File to import not found or unreadable: bat. (Sass::SyntaxError)
       Load paths:
         /path/to/project-foo
        on line 1 of standard input
  Use --trace for backtrace.
, stdout=, returncode=65
</pre></div>
</div>
<p>To overcome this issue, the full path must be provided in the
import statement, <tt class="docutils literal"><span class="pre">&#64;import</span> <span class="pre">&quot;foo/bar/bat&quot;</span></tt>, then webassets
will pass the <tt class="docutils literal"><span class="pre">load_paths</span></tt> argument (e.g.,
<tt class="docutils literal"><span class="pre">/path/to/project-foo</span></tt>) to Sass via its <tt class="docutils literal"><span class="pre">-I</span></tt> flags so Sass can
resolve the full path to the file to be imported:
<tt class="docutils literal"><span class="pre">/path/to/project-foo/foo/bar/bat</span></tt></p>
<p>Support configuration options:</p>
<dl class="docutils">
<dt>SASS_BIN</dt>
<dd>The path to the Sass binary. If not set, the filter will
try to run <tt class="docutils literal"><span class="pre">sass</span></tt> as if it&#8217;s in the system path.</dd>
<dt>SASS_STYLE</dt>
<dd>The style for the output CSS. Can be one of <tt class="docutils literal"><span class="pre">expanded</span></tt> (default),
<tt class="docutils literal"><span class="pre">nested</span></tt>, <tt class="docutils literal"><span class="pre">compact</span></tt> or <tt class="docutils literal"><span class="pre">compressed</span></tt>.</dd>
<dt>SASS_DEBUG_INFO</dt>
<dd><p class="first">If set to <tt class="docutils literal"><span class="pre">True</span></tt>, will cause Sass to output debug information
to be used by the FireSass Firebug plugin. Corresponds to the
<tt class="docutils literal"><span class="pre">--debug-info</span></tt> command line option of Sass.</p>
<p>Note that for this, Sass uses <tt class="docutils literal"><span class="pre">&#64;media</span></tt> rules, which are
not removed by a CSS compressor. You will thus want to make
sure that this option is disabled in production.</p>
<p class="last">By default, the value of this option will depend on the
environment <tt class="docutils literal"><span class="pre">DEBUG</span></tt> setting.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="scss">
<h7><tt class="docutils literal"><span class="pre">scss</span></tt><a class="headerlink" href="#scss" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.sass.SCSS">
<em class="property">class </em><tt class="descclassname">webassets.filter.sass.</tt><tt class="descname">SCSS</tt><big>(</big><em>*a</em>, <em>**kw</em><big>)</big><a class="headerlink" href="#webassets.filter.sass.SCSS" title="Permalink to this definition">¶</a></dt>
<dd><p>Version of the <tt class="docutils literal"><span class="pre">sass</span></tt> filter that uses the SCSS syntax.</p>
</dd></dl>

</div>
<div class="section" id="compass">
<h7><tt class="docutils literal"><span class="pre">compass</span></tt><a class="headerlink" href="#compass" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.compass.Compass">
<em class="property">class </em><tt class="descclassname">webassets.filter.compass.</tt><tt class="descname">Compass</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.compass.Compass" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://compass-style.org/">Compass</a> .sass files to
CSS.</p>
<p>Requires at least version 0.10.</p>
<p>To compile a standard Compass project, you only need to have
to compile your main <tt class="docutils literal"><span class="pre">screen.sass</span></tt>, <tt class="docutils literal"><span class="pre">print.sass</span></tt> and <tt class="docutils literal"><span class="pre">ie.sass</span></tt>
files. All the partials that you include will be handled by Compass.</p>
<p>If you want to combine the filter with other CSS filters, make
sure this one runs first.</p>
<p>Supported configuration options:</p>
<dl class="docutils">
<dt>COMPASS_BIN</dt>
<dd>The path to the Compass binary. If not set, the filter will
try to run <tt class="docutils literal"><span class="pre">compass</span></tt> as if it&#8217;s in the system path.</dd>
<dt>COMPASS_PLUGINS</dt>
<dd>Compass plugins to use. This is equivalent to the <tt class="docutils literal"><span class="pre">--require</span></tt>
command line option of the Compass. and expects a Python list
object of Ruby libraries to load.</dd>
<dt>COMPASS_CONFIG</dt>
<dd><p class="first">An optional dictionary of Compass <a class="reference external" href="http://compass-style.org/help/tutorials/configuration-reference/">configuration options</a>.
The values are emitted as strings, and paths are relative to the
Environment&#8217;s <tt class="docutils literal"><span class="pre">directory</span></tt> by default; include a <tt class="docutils literal"><span class="pre">project_path</span></tt>
entry to override this.</p>
<p class="last">The <tt class="docutils literal"><span class="pre">sourcemap</span></tt> option has a caveat. A file called _.css.map is
created by Compass in the tempdir (where _.scss is the original asset),
which is then moved into the output_path directory. Since the tempdir
is created one level down from the output path, the relative links in
the sourcemap should correctly map. This file, however, will not be
versioned, and thus this option should ideally only be used locally
for development and not in production with a caching service as the
_.css.map file will not be invalidated.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="pyscss">
<h7><tt class="docutils literal"><span class="pre">pyscss</span></tt><a class="headerlink" href="#pyscss" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.pyscss.PyScss">
<em class="property">class </em><tt class="descclassname">webassets.filter.pyscss.</tt><tt class="descname">PyScss</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.pyscss.PyScss" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://sass-lang.com/">Scss</a> markup to real CSS.</p>
<p>This uses <a class="reference external" href="https://github.com/Kronuz/pyScss">PyScss</a>, a native
Python implementation of the Scss language. The PyScss module needs
to be installed. It&#8217;s API has been changing; currently, version
1.1.5 is known to be supported.</p>
<p>This is an alternative to using the <tt class="docutils literal"><span class="pre">sass</span></tt> or <tt class="docutils literal"><span class="pre">scss</span></tt> filters,
which are based on the original, external tools.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Sass syntax is not supported by PyScss. You need to use
the <tt class="docutils literal"><span class="pre">sass</span></tt> filter based on the original Ruby implementation
instead.</p>
</div>
<p><em>Supported configuration options:</em></p>
<dl class="docutils">
<dt>PYSCSS_DEBUG_INFO (debug_info)</dt>
<dd><p class="first">Include debug information in the output for use with FireSass.</p>
<p class="last">If unset, the default value will depend on your
<tt class="xref py py-attr docutils literal"><span class="pre">Environment.debug</span></tt> setting.</p>
</dd>
<dt>PYSCSS_LOAD_PATHS (load_paths)</dt>
<dd><p class="first">Additional load paths that PyScss should use.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The filter currently does not automatically use
<tt class="xref py py-attr docutils literal"><span class="pre">Environment.load_path</span></tt> for this.</p>
</div>
</dd>
<dt>PYSCSS_STATIC_ROOT (static_root)</dt>
<dd>The directory PyScss should look in when searching for include
files that you have referenced. Will use
<tt class="xref py py-attr docutils literal"><span class="pre">Environment.directory</span></tt> by default.</dd>
<dt>PYSCSS_STATIC_URL (static_url)</dt>
<dd>The url PyScss should use when generating urls to files in
<tt class="docutils literal"><span class="pre">PYSCSS_STATIC_ROOT</span></tt>. Will use <tt class="xref py py-attr docutils literal"><span class="pre">Environment.url</span></tt> by
default.</dd>
<dt>PYSCSS_ASSETS_ROOT (assets_root)</dt>
<dd>The directory PyScss should look in when searching for things
like images that you have referenced. Will use
<tt class="docutils literal"><span class="pre">PYSCSS_STATIC_ROOT</span></tt> by default.</dd>
<dt>PYSCSS_ASSETS_URL (assets_url)</dt>
<dd>The url PyScss should use when generating urls to files in
<tt class="docutils literal"><span class="pre">PYSCSS_ASSETS_ROOT</span></tt>. Will use <tt class="docutils literal"><span class="pre">PYSCSS_STATIC_URL</span></tt> by
default.</dd>
<dt>PYSCSS_STYLE (style)</dt>
<dd>The style of the output CSS. Can be one of <tt class="docutils literal"><span class="pre">nested`</span> <span class="pre">(default),</span>
<span class="pre">``compact</span></tt>, <tt class="docutils literal"><span class="pre">compressed</span></tt>, or <tt class="docutils literal"><span class="pre">expanded</span></tt>.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="stylus">
<h7><tt class="docutils literal"><span class="pre">stylus</span></tt><a class="headerlink" href="#stylus" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.stylus.Stylus">
<em class="property">class </em><tt class="descclassname">webassets.filter.stylus.</tt><tt class="descname">Stylus</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.stylus.Stylus" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://learnboost.github.com/stylus/">Stylus</a> markup to CSS.</p>
<p>Requires the Stylus executable to be available externally. You can install
it using the <a class="reference external" href="http://npmjs.org/">Node Package Manager</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ npm install -g stylus
</pre></div>
</div>
<p>Supported configuration options:</p>
<dl class="docutils">
<dt>STYLUS_BIN</dt>
<dd>The path to the Stylus binary. If not set, assumes <tt class="docutils literal"><span class="pre">stylus</span></tt> is in the
system path.</dd>
<dt>STYLUS_PLUGINS</dt>
<dd>A Python list of Stylus plugins to use. Each plugin will be included
via Stylus&#8217;s command-line <tt class="docutils literal"><span class="pre">--use</span></tt> argument.</dd>
<dt>STYLUS_EXTRA_ARGS</dt>
<dd>A Python list of any additional command-line arguments.</dd>
<dt>STYLUS_EXTRA_PATHS</dt>
<dd>A Python list of any additional import paths.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="coffeescript">
<h7><tt class="docutils literal"><span class="pre">coffeescript</span></tt><a class="headerlink" href="#coffeescript" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.coffeescript.CoffeeScript">
<em class="property">class </em><tt class="descclassname">webassets.filter.coffeescript.</tt><tt class="descname">CoffeeScript</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.coffeescript.CoffeeScript" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://jashkenas.github.com/coffee-script/">CoffeeScript</a>
to real JavaScript.</p>
<p>If you want to combine it with other JavaScript filters, make sure this
one runs first.</p>
<p>Supported configuration options:</p>
<dl class="docutils">
<dt>COFFEE_NO_BARE</dt>
<dd>Set to <tt class="docutils literal"><span class="pre">True</span></tt> to compile with the top-level function
wrapper (suppresses the &#8211;bare option to <tt class="docutils literal"><span class="pre">coffee</span></tt>, which
is used by default).</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="requirejs">
<h7><tt class="docutils literal"><span class="pre">requirejs</span></tt><a class="headerlink" href="#requirejs" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.requirejs.RequireJSFilter">
<em class="property">class </em><tt class="descclassname">webassets.filter.requirejs.</tt><tt class="descname">RequireJSFilter</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.requirejs.RequireJSFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimizes AMD-style modularized JavaScript into a single asset
using <a class="reference external" href="http://requirejs.org/">RequireJS</a>.</p>
<p>This depends on the NodeJS executable <tt class="docutils literal"><span class="pre">r.js</span></tt>; install via npm:</p>
<div class="highlight-python"><div class="highlight"><pre>$ npm install -g requirejs
</pre></div>
</div>
<p>Details on configuring r.js can be found at
<a class="reference external" href="http://requirejs.org/docs/optimization.html#basics">http://requirejs.org/docs/optimization.html#basics</a>.</p>
<p><em>Supported configuration options</em>:</p>
<p>executable (env: REQUIREJS_BIN)</p>
<blockquote>
<div>Path to the RequireJS executable used to compile source
files. By default, the filter will attempt to run <tt class="docutils literal"><span class="pre">r.js</span></tt> via
the system path.</div></blockquote>
<p>config (env: REQUIREJS_CONFIG)</p>
<blockquote>
<div>The RequireJS options file. The path is taken to be relative
to the Enviroment.directory (by defualt is /static).</div></blockquote>
<p>baseUrl (env: REQUIREJS_BASEURL)</p>
<blockquote>
<div>The <tt class="docutils literal"><span class="pre">baseUrl</span></tt> parameter to r.js; this is the directory that
AMD modules will be loaded from. The path is taken relative
to the Enviroment.directory (by defualt is /static).
Typically, this is used in
conjunction with a <tt class="docutils literal"><span class="pre">baseUrl</span></tt> parameter set in the <cite>config</cite>
options file, where the baseUrl value in the config file is
used for client-side processing, and the value here is for
server-side processing.</div></blockquote>
<p>optimize (env: REQUIREJS_OPTIMIZE)</p>
<blockquote>
<div>The <tt class="docutils literal"><span class="pre">optimize</span></tt> parameter to r.js; controls whether or not
r.js minifies the output. By default, it is enabled, but can
be set to <tt class="docutils literal"><span class="pre">none</span></tt> to disable minification. The typical
scenario to disable minification is if you do some additional
processing of the JavaScript (such as removing
<tt class="docutils literal"><span class="pre">console.log()</span></tt> lines) before minification by the <tt class="docutils literal"><span class="pre">rjsmin</span></tt>
filter.</div></blockquote>
<p>extras (env: REQUIREJS_EXTRAS)</p>
<blockquote>
<div>Any other command-line parameters to be passed to r.js. The
string is expected to be in unix shell-style format, meaning
that quotes can be used to escape spaces, etc.</div></blockquote>
<p>run_in_debug (env: REQUIREJS_RUN_IN_DEBUG)</p>
<blockquote>
<div>Boolean which controls if the AMD requirejs is evaluated
client-side or server-side in debug mode. If set to a truthy
value (e.g. &#8216;yes&#8217;), then server-side compilation is done, even
in debug mode. The default is false.</div></blockquote>
<div class="admonition-client-side-amd-evaluation admonition">
<p class="first admonition-title">Client-side AMD evaluation</p>
<p>AMD modules can be loaded client-side without any processing
done on the server-side. The advantage to this is that
debugging is easier because the browser can tell you which
source file is responsible for a particular line of code. The
disadvantage is that it means that each loaded AMD module is a
separate HTTP request. When running client-side, the client
needs access to the <cite>config</cite> &#8211; for this reason, when running
in client-side mode, the webassets environment must be
adjusted to include a reference to this
configuration. Typically, this is done by adding something
similar to the following during webassets initialization:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;requirejs_run_in_debug&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span>
    <span class="n">env</span><span class="p">[</span><span class="s">&#39;requirejs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contents</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;requirejs-browser-config.js&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<p>And the file <tt class="docutils literal"><span class="pre">requirejs-browser-config.js</span></tt> will look
something like:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">require</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span><span class="nx">baseUrl</span><span class="o">:</span> <span class="s1">&#39;/static/script/&#39;</span><span class="p">});</span>
</pre></div>
</div>
<p class="last">Set the <cite>run_in_debug</cite> option to control client-side or
server-side compilation in debug.</p>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="javascript-templates">
<h6>JavaScript templates<a class="headerlink" href="#javascript-templates" title="Permalink to this headline">¶</a></h6>
<div class="section" id="jst">
<h7><tt class="docutils literal"><span class="pre">jst</span></tt><a class="headerlink" href="#jst" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.jst.JST">
<em class="property">class </em><tt class="descclassname">webassets.filter.jst.</tt><tt class="descname">JST</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.jst.JST" title="Permalink to this definition">¶</a></dt>
<dd><p>This filter processes generic JavaScript templates. It will generate
JavaScript code that runs all files through a template compiler, and makes
the templates available as an object.</p>
<p>It was inspired by <a class="reference external" href="http://documentcloud.github.com/underscore/#template">Jammit</a>.</p>
<p>For example, if you have a file named <tt class="docutils literal"><span class="pre">license.jst</span></tt>:</p>
<div class="highlight-html"><div class="highlight"><pre>&lt;div class=&quot;drivers-license&quot;&gt;
  &lt;h2&gt;Name: &lt;%= name %&gt;&lt;/h2&gt;
  &lt;em&gt;Hometown: &lt;%= birthplace %&gt;&lt;/em&gt;
&lt;/div&gt;
</pre></div>
</div>
<p>Then, after applying this filter, you could use the template in JavaScript:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">JST</span><span class="p">.</span><span class="nx">license</span><span class="p">({</span><span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;Moe&quot;</span><span class="p">,</span> <span class="nx">birthplace</span> <span class="o">:</span> <span class="s2">&quot;Brooklyn&quot;</span><span class="p">});</span>
</pre></div>
</div>
<p>The name of each template is derived from the filename. If your JST files
are spread over different directories, the path up to the common prefix
will be included. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;templates/app1/license.jst&#39;</span><span class="p">,</span> <span class="s">&#39;templates/app2/profile.jst&#39;</span><span class="p">,</span>
       <span class="n">filters</span><span class="o">=</span><span class="s">&#39;jst&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>will make the templates available as <tt class="docutils literal"><span class="pre">app1/license</span></tt> and <tt class="docutils literal"><span class="pre">app2/profile</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The filter is &#8220;generic&#8221; in the sense that it does not actually compile
the templates, but wraps them in a JavaScript function call, and can
thus be used with any template language. webassets also has filters
for specific JavaScript template languages like
<a class="reference internal" href="index.html#webassets.filter.dust.DustJS" title="webassets.filter.dust.DustJS"><tt class="xref py py-class docutils literal"><span class="pre">DustJS</span></tt></a> or
<a class="reference internal" href="index.html#webassets.filter.handlebars.Handlebars" title="webassets.filter.handlebars.Handlebars"><tt class="xref py py-class docutils literal"><span class="pre">Handlebars</span></tt></a>, and those filters precompile
the templates on the server, which means a performance boost on the
client-side.</p>
</div>
<p>Unless configured otherwise, the filter will use the same micro-templating
language that <a class="reference external" href="http://documentcloud.github.com/underscore/#template">Jammit</a> uses, which is turn is the same one that is
available in <a class="reference external" href="http://documentcloud.github.com/underscore/#template">underscore.js</a>. The JavaScript code necessary to compile
such templates will implicitly be included in the filter output.</p>
<p><em>Supported configuration options:</em></p>
<dl class="docutils">
<dt>JST_COMPILER (template_function)</dt>
<dd><p class="first">A string that is inserted into the generated JavaScript code in place
of the function to be called that should do the compiling. Unless you
specify a custom function here, the filter will include the JavaScript
code of it&#8217;s own micro-templating language, which is the one used by
<a class="reference external" href="http://documentcloud.github.com/underscore/#template">underscore.js</a> and <a class="reference external" href="http://documentcloud.github.com/underscore/#template">Jammit</a>.</p>
<p>If you assign a custom function, it is your responsibility to ensure
that it is available in your final JavaScript.</p>
<p class="last">If this option is set to <tt class="docutils literal"><span class="pre">False</span></tt>, then the template strings will be
output directly, which is to say, <tt class="docutils literal"><span class="pre">JST.foo</span></tt> will be a string holding
the raw source of the <tt class="docutils literal"><span class="pre">foo</span></tt> template.</p>
</dd>
<dt>JST_NAMESPACE (namespace)</dt>
<dd>How the templates should be made available in JavaScript. Defaults to
<tt class="docutils literal"><span class="pre">window.JST</span></tt>, which gives you a global <tt class="docutils literal"><span class="pre">JST</span></tt> object.</dd>
<dt>JST_BARE (bare)</dt>
<dd><p class="first">Whether everything generated by this filter should be wrapped inside
an anonymous function. Default to <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you enable this option, the namespace must be a property
of the <tt class="docutils literal"><span class="pre">window</span></tt> object, or you won&#8217;t be able to access the
templates.</p>
</div>
</dd>
<dt>JST_DIR_SEPARATOR (separator)</dt>
<dd>The separator character to use for templates within directories.
Defaults to &#8216;/&#8217;</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="handlebars">
<h7><tt class="docutils literal"><span class="pre">handlebars</span></tt><a class="headerlink" href="#handlebars" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.handlebars.Handlebars">
<em class="property">class </em><tt class="descclassname">webassets.filter.handlebars.</tt><tt class="descname">Handlebars</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.handlebars.Handlebars" title="Permalink to this definition">¶</a></dt>
<dd><p>Compile <a class="reference external" href="http://handlebarsjs.com/">Handlebars</a> templates.</p>
<p>This filter assumes that the <tt class="docutils literal"><span class="pre">handlebars</span></tt> executable is in the path.
Otherwise, you may define a <tt class="docutils literal"><span class="pre">HANDLEBARS_BIN</span></tt> setting.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use this filter if you want to precompile Handlebars templates.
If compiling them in the browser is acceptable, you may use the
JST filter, which needs no external dependency.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Currently, this filter is not compatible with input filters. Any
filters that would run during the input-stage will simply be
ignored. Input filters tend to be other compiler-style filters,
so this is unlikely to be an issue.</p>
</div>
</dd></dl>

</div>
<div class="section" id="dustjs">
<h7><tt class="docutils literal"><span class="pre">dustjs</span></tt><a class="headerlink" href="#dustjs" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.dust.DustJS">
<em class="property">class </em><tt class="descclassname">webassets.filter.dust.</tt><tt class="descname">DustJS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.dust.DustJS" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="http://akdubya.github.com/dustjs/">DustJS</a> templates compilation
filter.</p>
<p>Takes a directory full <tt class="docutils literal"><span class="pre">.dust</span></tt> files and creates a single Javascript
object that registers to the <tt class="docutils literal"><span class="pre">dust</span></tt> global when loaded in the browser:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;js/templates/&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s">&#39;dustjs&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that in the above example, a directory is given as the bundle
contents, which is unusual, but required by this filter.</p>
<p>This uses the <tt class="docutils literal"><span class="pre">dusty</span></tt> compiler, which is a separate project from the
DustJS implementation. To install <tt class="docutils literal"><span class="pre">dusty</span></tt> together with LinkedIn&#8217;s
version of <tt class="docutils literal"><span class="pre">dustjs</span></tt> (the original does not support NodeJS &gt; 0.4):</p>
<div class="highlight-python"><div class="highlight"><pre>npm install dusty
rm -rf node_modules/dusty/node_modules/dust
git clone https://github.com/linkedin/dustjs node_modules/dust
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To generate the DustJS client-side Javascript, you can then do:</p>
<div class="last highlight-python"><div class="highlight"><pre>cd node_modules/dust
make dust
cp dist/dist-core...js your/static/assets/path
</pre></div>
</div>
</div>
<p>For compilation, set the <tt class="docutils literal"><span class="pre">DUSTY_PATH=.../node_modules/dusty/bin/dusty</span></tt>.
Optionally, set <tt class="docutils literal"><span class="pre">NODE_PATH=.../node</span></tt>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="other">
<h6>Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h6>
<div class="section" id="cssrewrite">
<span id="filters-cssrewrite"></span><h7><tt class="docutils literal"><span class="pre">cssrewrite</span></tt><a class="headerlink" href="#cssrewrite" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.cssrewrite.CSSRewrite">
<em class="property">class </em><tt class="descclassname">webassets.filter.cssrewrite.</tt><tt class="descname">CSSRewrite</tt><big>(</big><em>replace=False</em><big>)</big><a class="headerlink" href="#webassets.filter.cssrewrite.CSSRewrite" title="Permalink to this definition">¶</a></dt>
<dd><p>Source filter that rewrites relative urls in CSS files.</p>
<p>CSS allows you to specify urls relative to the location of the CSS file.
However, you may want to store your compressed assets in a different place
than source files, or merge source files from different locations. This
would then break these relative CSS references, since the base URL changed.</p>
<p>This filter transparently rewrites CSS <tt class="docutils literal"><span class="pre">url()</span></tt> instructions in the source
files to make them relative to the location of the output path. It works as
a <em>source filter</em>, i.e. it is applied individually to each source file
before they are merged.</p>
<p>No configuration is necessary.</p>
<p>The filter also supports a manual mode:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">get_filter</span><span class="p">(</span><span class="s">&#39;cssrewrite&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;old_directory&#39;</span><span class="p">:</span><span class="s">&#39;/custom/path/&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>This will rewrite all urls that point to files within <tt class="docutils literal"><span class="pre">old_directory</span></tt> to
use <tt class="docutils literal"><span class="pre">/custom/path</span></tt> as a prefix instead.</p>
<p>You may plug in your own replace function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">get_filter</span><span class="p">(</span><span class="s">&#39;cssrewrite&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="k">lambda</span> <span class="n">url</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;^/?images/&#39;</span><span class="p">,</span> <span class="s">&#39;/images/&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
<span class="n">get_filter</span><span class="p">(</span><span class="s">&#39;cssrewrite&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="k">lambda</span> <span class="n">url</span><span class="p">:</span> <span class="s">&#39;/images/&#39;</span><span class="o">+</span><span class="n">url</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span> <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;images/&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="datauri">
<h7><tt class="docutils literal"><span class="pre">datauri</span></tt><a class="headerlink" href="#datauri" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.datauri.CSSDataUri">
<em class="property">class </em><tt class="descclassname">webassets.filter.datauri.</tt><tt class="descname">CSSDataUri</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.datauri.CSSDataUri" title="Permalink to this definition">¶</a></dt>
<dd><p>Will replace CSS url() references to external files with internal
<a class="reference external" href="http://en.wikipedia.org/wiki/Data_URI_scheme">data: URIs</a>.</p>
<p>The external file is now included inside your CSS, which minimizes HTTP
requests.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Data Uris have <a class="reference external" href="http://stackoverflow.com/questions/5258057/images-in-css-or-html-as-data-base64">clear disadvantages</a>,
so put some thought into if and how you would like to use them. Have
a look at some <a class="reference external" href="http://www.ravelrumba.com/blog/data-uris-for-css-images-more-tests-more-questions/">performance measurements</a>.</p>
</div>
<p>The filter respects a <tt class="docutils literal"><span class="pre">DATAURI_MAX_SIZE</span></tt> option, which is the maximum
size (in bytes) of external files to include. The default limit is what
I think should be a reasonably conservative number, 2048 bytes.</p>
</dd></dl>

</div>
<div class="section" id="cssprefixer">
<h7><tt class="docutils literal"><span class="pre">cssprefixer</span></tt><a class="headerlink" href="#cssprefixer" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.cssprefixer.CSSPrefixer">
<em class="property">class </em><tt class="descclassname">webassets.filter.cssprefixer.</tt><tt class="descname">CSSPrefixer</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.cssprefixer.CSSPrefixer" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses <a class="reference external" href="http://github.com/myfreeweb/cssprefixer/">CSSPrefixer</a>
to add vendor prefixes to CSS files.</p>
</dd></dl>

</div>
<div class="section" id="autoprefixer">
<h7><tt class="docutils literal"><span class="pre">autoprefixer</span></tt><a class="headerlink" href="#autoprefixer" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.autoprefixer.AutoprefixerFilter">
<em class="property">class </em><tt class="descclassname">webassets.filter.autoprefixer.</tt><tt class="descname">AutoprefixerFilter</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.autoprefixer.AutoprefixerFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Prefixes vendor-prefixes using <cite>autoprefixer
&lt;https://github.com/ai/autoprefixer&gt;</cite>, which uses the <cite>Can I Use?
&lt;http://www.caniuse.com&gt;</cite> database to know which prefixes need to be
inserted.</p>
<p>This depends on the <cite>autoprefixer &lt;https://github.com/ai/autoprefixer&gt;</cite>
command line tool being installed (use <tt class="docutils literal"><span class="pre">npm</span> <span class="pre">install</span> <span class="pre">autoprefixer</span></tt>).</p>
<p><em>Supported configuration options</em>:</p>
<dl class="docutils">
<dt>AUTOPREFIXER_BIN</dt>
<dd>Path to the autoprefixer executable used to compile source files. By
default, the filter will attempt to run <tt class="docutils literal"><span class="pre">autoprefixer</span></tt> via the
system path.</dd>
<dt>AUTOPREFIXER_BROWSERS</dt>
<dd><p class="first">The browser expressions to use.  This corresponds to the <tt class="docutils literal"><span class="pre">--browsers</span>
<span class="pre">&lt;value&gt;</span></tt> flag, see the <cite>&#8211;browsers documentation
&lt;https://github.com/ai/autoprefixer#browsers&gt;</cite>.  By default, this flag
won&#8217;t be passed, and autoprefixer&#8217;s default will be used.</p>
<p>Example:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">AUTOPREFIXER_BROWSERS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&gt; 1%&#39;</span><span class="p">,</span> <span class="s">&#39;last 2 versions&#39;</span><span class="p">,</span> <span class="s">&#39;firefox 24&#39;</span><span class="p">,</span> <span class="s">&#39;opera 12.1&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd>
<dt>AUTOPREFIXER_EXTRA_ARGS</dt>
<dd>Additional options may be passed to <tt class="docutils literal"><span class="pre">autoprefixer</span></tt> using this
setting, which expects a list of strings.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="jinja2">
<h7><tt class="docutils literal"><span class="pre">jinja2</span></tt><a class="headerlink" href="#jinja2" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.jinja2.Jinja2">
<em class="property">class </em><tt class="descclassname">webassets.filter.jinja2.</tt><tt class="descname">Jinja2</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.jinja2.Jinja2" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a file through the Jinja2 templating engine.</p>
<p>Requires the <tt class="docutils literal"><span class="pre">jinja2</span></tt> package (<a class="reference external" href="https://github.com/mitsuhiko/jinja2">https://github.com/mitsuhiko/jinja2</a>).</p>
<p>The Jinja2 context can be specified with the <cite>JINJA2_CONTEXT</cite> configuration
option or directly with <cite>context={...}</cite>. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;input.css&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">Jinja2</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="s">&#39;bar&#39;</span><span class="p">}))</span>
</pre></div>
</div>
<p>Additionally to enable template loading mechanics from your project you can provide
<cite>JINJA2_ENV</cite> or <cite>jinja2_env</cite> arg to make use of already created environment.</p>
</dd></dl>

</div>
<div class="section" id="spritemapper">
<h7><tt class="docutils literal"><span class="pre">spritemapper</span></tt><a class="headerlink" href="#spritemapper" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="webassets.filter.spritemapper.Spritemapper">
<em class="property">class </em><tt class="descclassname">webassets.filter.spritemapper.</tt><tt class="descname">Spritemapper</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.spritemapper.Spritemapper" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate CSS spritemaps using
<a class="reference external" href="http://yostudios.github.com/Spritemapper/">Spritemapper</a>, a Python
utility that merges multiple images into one and generates CSS positioning
for the corresponding slices. Installation is easy:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install spritemapper
</pre></div>
</div>
<p>Supported configuration options:</p>
<dl class="docutils">
<dt>SPRITEMAPPER_PADDING</dt>
<dd>A tuple of integers indicating the number of pixels of padding to
place between sprites</dd>
<dt>SPRITEMAPPER_ANNEAL_STEPS</dt>
<dd>Affects the number of combinations to be attempted by the box packer
algorithm</dd>
</dl>
<p><strong>Note:</strong> Since the <tt class="docutils literal"><span class="pre">spritemapper</span></tt> command-line utility expects source
and output files to be on the filesystem, this filter interfaces directly
with library internals instead. It has been tested to work with
Spritemapper version 1.0.</p>
</dd></dl>

</div>
</div>
</div>
<span id="document-custom_filters"></span><div class="section" id="creating-custom-filters">
<span id="custom-filters"></span><h5>Creating custom filters<a class="headerlink" href="#creating-custom-filters" title="Permalink to this headline">¶</a></h5>
<p>Creating custom filters can be easy, or very easy.</p>
<p>Before we get to that though, it is first necessary to understand that
there are two types of filters: <em>input filters</em> and <em>output filters</em>.
Output filters are applied after the complete content after all a bundle&#8217;s
contents have been merged together. Input filters, on the other hand, are
applied to each source file after it is read from the disk. In the case
of nested bundles, input filters will be passed down, with the input filters
of a parent bundle are applied before the output filter of a child bundle:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">child_bundle</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;file.css&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s">&#39;yui_css&#39;</span><span class="p">)</span>
<span class="n">Bundle</span><span class="p">(</span><span class="n">child_bundle</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s">&#39;cssrewrite&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, because cssrewrite acts as an input filter, what will
essentially happen is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">yui_css</span><span class="p">(</span><span class="n">cssrewrite</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">css</span><span class="p">))</span>
</pre></div>
</div>
<p>To be even more specific, since a single filter can act as both an input
and an output filter, the call chain will actually look something like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cssrewrite</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">yui_css</span><span class="o">.</span><span class="n">output</span><span class="p">((</span><span class="n">cssrewrite</span><span class="o">.</span><span class="n">input</span><span class="p">((</span><span class="n">yui_css</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">css</span><span class="p">)))))</span>
</pre></div>
</div>
<p>The usual reason to use an input filter is that the filter&#8217;s
transformation depends on the source file&#8217;s filename. For example,
the <a class="reference internal" href="index.html#filters-cssrewrite"><em>cssrewrite</em></a> filter needs to know the
location of the source file relative to the final output file, so it
can properly update relative references. Another example
are CSS converters like <a class="reference internal" href="index.html#filters-less"><em>less</em></a>, which support
include mechanisms that work relative to the input filename.</p>
<p>With that in mind...</p>
<div class="section" id="the-very-easy-way">
<h6>The very easy way<a class="headerlink" href="#the-very-easy-way" title="Permalink to this headline">¶</a></h6>
<p>In the simplest case, a filter is simply a function what takes two
arguments, an input stream and an output stream.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">noop</span><span class="p">(</span><span class="n">_in</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_in</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>That&#8217;s it! You can use this filter when defining your bundles:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">bundle</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;input.js&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">(</span><span class="n">noop</span><span class="p">,))</span>
</pre></div>
</div>
<p>If you are using Jinja2, you can also specify the callable inline,
provided that it is available in the context:</p>
<div class="highlight-django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">filters</span><span class="o">=(</span><span class="nv">noop</span><span class="o">,</span> <span class="s1">&#39;jsmin&#39;</span><span class="o">)</span> <span class="p">...</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>It even works when using Django templates, although here, you are
of course more limited in terms of syntax; if you want to use multiple
filters, you need to combine them:</p>
<div class="highlight-django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">filters</span><span class="o">=</span><span class="nv">my_filters</span> <span class="p">...</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>Just make sure that the context variable <tt class="docutils literal"><span class="pre">my_filters</span></tt> is set to
your function.</p>
<p>Note that you currently cannot write input filters in this way. Callables
always act as output filters.</p>
</div>
<div class="section" id="the-easy-way">
<h6>The easy way<a class="headerlink" href="#the-easy-way" title="Permalink to this headline">¶</a></h6>
<p>This works by subclassing <tt class="docutils literal"><span class="pre">webassets.filter.Filter</span></tt>. In doing so, you
need to write a bit more code, but you&#8217;ll be able to enjoy a few perks.</p>
<p>The <tt class="docutils literal"><span class="pre">noop</span></tt> filter from the previous example, written as a class, would
look something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets.filter</span> <span class="kn">import</span> <span class="n">Filter</span>

<span class="k">class</span> <span class="nc">NoopFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;noop&#39;</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_in</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_in</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_in</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_in</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">output</span></tt> and <tt class="docutils literal"><span class="pre">input</span></tt> methods should look familiar. They&#8217;re basically
like the callable you are already familiar with, simply pulled inside a class.</p>
<p>Class-based filters have a <tt class="docutils literal"><span class="pre">name</span></tt> attribute, which you need to set if you
want to register your filter globally.</p>
<p>The <tt class="docutils literal"><span class="pre">input</span></tt> method will be called for every source file, the <tt class="docutils literal"><span class="pre">output</span></tt>
method will be applied once after a bundle&#8217;s contents have been concated.</p>
<p>Among the <tt class="docutils literal"><span class="pre">kwargs</span></tt> you currently receive are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">source_path</span></tt> (only for <tt class="docutils literal"><span class="pre">input()</span></tt>): The filename behind the <tt class="docutils literal"><span class="pre">in</span></tt>
stream, though note that other input filters may already have transformed
it.</li>
<li><tt class="docutils literal"><span class="pre">output_path</span></tt>: The final output path that your filters work will
ultimatily end up in.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Always make your filters accept arbitrary <tt class="docutils literal"><span class="pre">**kwargs</span></tt>. The API does allow
for additional values to be passed along in the future.</p>
</div>
<div class="section" id="registering">
<h7>Registering<a class="headerlink" href="#registering" title="Permalink to this headline">¶</a></h7>
<p>The <tt class="docutils literal"><span class="pre">name</span></tt> wouldn&#8217;t make much sense, if it couldn&#8217;t be used to reference
the filter. First, you need to register the class with the system though:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets.filter</span> <span class="kn">import</span> <span class="n">register_filter</span>
<span class="n">register_filter</span><span class="p">(</span><span class="n">NoopFilter</span><span class="p">)</span>
</pre></div>
</div>
<p>After that, you can use the filter like you would any of the built-in ones:</p>
<div class="highlight-django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">filters</span><span class="o">=</span><span class="s1">&#39;jsmin,noop&#39;</span> <span class="p">...</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="options">
<h7>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h7>
<p>Class-based filters are used as instances, and as such, you can easily
define a <tt class="docutils literal"><span class="pre">__init__</span></tt> method that takes arguments. However, you should
make all parameters optional, if possible, or your filter will not be
usable through a name reference.</p>
<p>There might be another thing to consider. If a filter is specified
multiple times, which sometimes can happen unsuspectingly when bundles
are nested within each other, it will only be applied a single time.
By default, all filters of the same class are considered <em>the same</em>. In
almost all cases, this will be just fine.</p>
<p>However, in case you want your filter to be applicable multiple times
with different options, you can implement the <tt class="docutils literal"><span class="pre">unique</span></tt> method and
return a hashable object that represents data unique to this instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>
    <span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>
</pre></div>
</div>
<p>This will cause two instances of this filter to be both applied, as long
as the arguments given differ. Two instances with the exact same arguments
will still be considered equal.</p>
<p>If you want each of your filter&#8217;s instances to be unique, you can simply do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="useful-helpers">
<h7>Useful helpers<a class="headerlink" href="#useful-helpers" title="Permalink to this headline">¶</a></h7>
<p>The <tt class="docutils literal"><span class="pre">Filter</span></tt> base class provides some useful features.</p>
<div class="section" id="setup">
<h8>setup()<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h8>
<p>It&#8217;s quite common that filters have dependencies - on other Python
libraries, external tools, etc. If you want to provide your filter
regardless of whether such dependencies are matched, and fail only
if the filter is actually used, implement a <tt class="docutils literal"><span class="pre">setup()</span></tt> method on
your filter class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">foolib</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foolib</span> <span class="o">=</span> <span class="n">foolib</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_in</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foolib</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h8>options<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h8>
<p>Some filters will need to be configured. This can of course be done by
passing arguments into <tt class="docutils literal"><span class="pre">__init__</span></tt> as explained above, but it restricts
you to configuring your filters in code, and can be tedious if necessary
every single time the filter is used.</p>
<p>In some cases, it makes more sense to have an option configured globally,
like the path to an external binary. A number of the built-in filters do
this, allowing you to both specify a config variable in the webassets
<tt class="docutils literal"><span class="pre">Environment</span></tt> instance, or as an OS environment variable.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;binary&#39;</span><span class="p">:</span> <span class="s">&#39;FOO_BIN&#39;</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>If you define a an <tt class="docutils literal"><span class="pre">options</span></tt> attribute on your filter class, these
options will automatically be supported both by your filter&#8217;s __init__,
as well as via a configuration or environment variable. In the example
above, you may pass <tt class="docutils literal"><span class="pre">binary</span></tt> when creating a filter instance manually,
or define <tt class="docutils literal"><span class="pre">FOO_BIN</span></tt> in <tt class="docutils literal"><span class="pre">Environment.config</span></tt>, or as an OS environment
variable.</p>
</div>
<div class="section" id="get-config">
<h8>get_config()<a class="headerlink" href="#get-config" title="Permalink to this headline">¶</a></h8>
<p>In cases where the declarative approach of the <tt class="docutils literal"><span class="pre">options</span></tt> attribute is
not enough, you can implement custom options yourself using the
<tt class="docutils literal"><span class="pre">Filter.get_config()</span></tt> helper:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s">&#39;BINARY_PATH&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will check first the configuration, then the environment for
<tt class="docutils literal"><span class="pre">BINARY_PATH</span></tt>, and raise an exception if nothing is found.</p>
<p><tt class="docutils literal"><span class="pre">get_config()</span></tt> allows you to specify different names for the setting
and the environment variable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="n">setting</span><span class="o">=</span><span class="s">&#39;ASSETS_BINARY_PATH&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="s">&#39;BINARY_PATH&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It also supports disabling either of the two, causing only the other to
be checked for the given name:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="n">setting</span><span class="o">=</span><span class="s">&#39;ASSETS_BINARY_PATH&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you can easily make a value optional using the <tt class="docutils literal"><span class="pre">require</span></tt>
parameter. Instead of raising an exception, <tt class="docutils literal"><span class="pre">get_config()</span></tt> then returns
<tt class="docutils literal"><span class="pre">None</span></tt>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">java</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s">&#39;JAVA_BIN&#39;</span><span class="p">,</span> <span class="n">require</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;java&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="abstract-base-classes">
<h7>Abstract base classes<a class="headerlink" href="#abstract-base-classes" title="Permalink to this headline">¶</a></h7>
<p>In some cases, you might want to have a common base class for multiple
filters. You can make the base class abstract by setting <tt class="docutils literal"><span class="pre">name</span></tt> to
<tt class="docutils literal"><span class="pre">None</span></tt> explicitly. However, this is currently only relevant for the
built-in filters, since your own filters will not be registered
automatically in any case.</p>
</div>
</div>
<div class="section" id="more">
<h6>More?<a class="headerlink" href="#more" title="Permalink to this headline">¶</a></h6>
<p>You can have a look inside the <tt class="docutils literal"><span class="pre">webassets.filter</span></tt> module source
code to see a large number of example filters.</p>
</div>
</div>
<span id="document-css_compilers"></span><div class="section" id="css-compilers">
<span id="id1"></span><h5>CSS compilers<a class="headerlink" href="#css-compilers" title="Permalink to this headline">¶</a></h5>
<p>CSS compilers intend to improve upon the default CSS syntax, allow you
to write your stylesheets in a syntax more powerful, or more easily
readable. Since browsers do not understand this new syntax, the CSS compiler
needs to translate its own syntax to original CSS.</p>
<p><tt class="docutils literal"><span class="pre">webassets</span></tt> includes <a class="reference internal" href="index.html#filters-css-compilers"><em>builtin filters for a number of popular
CSS compilers</em></a>, which you can use like any other
filter. There is one problem though: While developing, you will probably
want to disable asset packaging, and instead work with the uncompressed
assets (i.e., you would disable the
<a class="reference internal" href="index.html#environment-setting-debug"><em>environment.debug</em></a> option). However,
you still need to apply the filter for your CSS compiler, since otherwise,
the Browser wouldn&#8217;t understand your stylesheets.</p>
<p>For this reason, such compiler filters run even when in debug mode:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">less</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;css/base.less&#39;</span><span class="p">,</span> <span class="s">&#39;css/forms.less&#39;</span><span class="p">,</span>
              <span class="n">filters</span><span class="o">=</span><span class="s">&#39;less,cssmin&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;screen.css&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code block behaves exactly like you would want it to: When
debugging, the less files are compiled to CSS, but the code is not minified.
In production, both filters are applied.</p>
<p>Sometimes, you need to merge together good old CSS code, and you have a
compiler that, unlike <tt class="docutils literal"><span class="pre">less</span></tt>, cannot process those. Then you can use a
child bundle:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sass</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;*.sass&#39;</span> <span class="n">filters</span><span class="o">=</span><span class="s">&#39;sass&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;gen/sass.css&#39;</span><span class="p">)</span>
<span class="n">all_css</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;css/jquery.calendar.css&#39;</span><span class="p">,</span> <span class="n">sass</span><span class="p">,</span>
                 <span class="n">filters</span><span class="o">=</span><span class="s">&#39;cssmin&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&quot;gen/all.css&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above case, the <tt class="docutils literal"><span class="pre">sass</span></tt> filter is only applied to the Sass source
files, within a nested bundle (which needs it&#8217;s own output target!). The
minification is applied to all CSS content in the outer bundle.</p>
</div>
<span id="document-loaders"></span><div class="section" id="loaders">
<span id="id1"></span><h5>Loaders<a class="headerlink" href="#loaders" title="Permalink to this headline">¶</a></h5>
<p>Using these helper classes, you can define your bundles or even
your complete environment in some external data source, rather than
constructing them in code.</p>
<dl class="class">
<dt id="webassets.loaders.YAMLLoader">
<em class="property">class </em><tt class="descclassname">webassets.loaders.</tt><tt class="descname">YAMLLoader</tt><big>(</big><em>file_or_filename</em><big>)</big><a class="headerlink" href="#webassets.loaders.YAMLLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Will load an environment or a set of bundles from
<a class="reference external" href="http://en.wikipedia.org/wiki/YAML">YAML</a> files.</p>
<dl class="method">
<dt id="webassets.loaders.YAMLLoader.load_bundles">
<tt class="descname">load_bundles</tt><big>(</big><em>environment=None</em><big>)</big><a class="headerlink" href="#webassets.loaders.YAMLLoader.load_bundles" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a list of <tt class="xref py py-class docutils literal"><span class="pre">Bundle</span></tt> instances defined in the YAML file.</p>
<p>Expects the following format:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">bundle-name</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">filters</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sass,cssutils</span>
    <span class="l-Scalar-Plain">output</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">cache/default.css</span>
    <span class="l-Scalar-Plain">contents</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">css/jquery.ui.calendar.css</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">css/jquery.ui.slider.css</span>
<span class="l-Scalar-Plain">another-bundle</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>Bundles may reference each other:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">js-all</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">contents</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">jquery.js</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">jquery-ui</span>    <span class="c1"># This is a bundle reference</span>
<span class="l-Scalar-Plain">jquery-ui</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">contents</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jqueryui/*.js</span>
</pre></div>
</div>
<p>If an <tt class="docutils literal"><span class="pre">environment</span></tt> argument is given, it&#8217;s bundles
may be referenced as well. Note that you may pass any
compatibly dict-like object.</p>
<p>Finally, you may also use nesting:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">js-all</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">contents</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">jquery.js</span>
        <span class="c1"># This is a nested bundle</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">contents</span><span class="p-Indicator">:</span> <span class="s">&quot;*.coffee&quot;</span>
          <span class="l-Scalar-Plain">filters</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">coffeescript</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="webassets.loaders.YAMLLoader.load_environment">
<tt class="descname">load_environment</tt><big>(</big><big>)</big><a class="headerlink" href="#webassets.loaders.YAMLLoader.load_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Load an <tt class="xref py py-class docutils literal"><span class="pre">Environment</span></tt> instance defined in the YAML file.</p>
<p>Expects the following format:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">directory</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../static</span>
<span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/media</span>
<span class="l-Scalar-Plain">debug</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
<span class="l-Scalar-Plain">updater</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">timestamp</span>
<span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">compass_bin</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/opt/compass</span>
    <span class="l-Scalar-Plain">another_custom_config_value</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">foo</span>

<span class="l-Scalar-Plain">bundles</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>All values, including <tt class="docutils literal"><span class="pre">directory</span></tt> and <tt class="docutils literal"><span class="pre">url</span></tt> are optional. The
syntax for defining bundles is the same as for
<a class="reference internal" href="index.html#webassets.loaders.YAMLLoader.load_bundles" title="webassets.loaders.YAMLLoader.load_bundles"><tt class="xref py py-meth docutils literal"><span class="pre">load_bundles()</span></tt></a>.</p>
<p>Sample usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets.loaders</span> <span class="kn">import</span> <span class="n">YAMLLoader</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">YAMLLoader</span><span class="p">(</span><span class="s">&#39;asset.yml&#39;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_environment</span><span class="p">()</span>

<span class="n">env</span><span class="p">[</span><span class="s">&#39;some-bundle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">urls</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="webassets.loaders.PythonLoader">
<em class="property">class </em><tt class="descclassname">webassets.loaders.</tt><tt class="descname">PythonLoader</tt><big>(</big><em>module_name</em><big>)</big><a class="headerlink" href="#webassets.loaders.PythonLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Basically just a simple helper to import a Python file and
retrieve the bundles defined there.</p>
<dl class="method">
<dt id="webassets.loaders.PythonLoader.load_bundles">
<tt class="descname">load_bundles</tt><big>(</big><big>)</big><a class="headerlink" href="#webassets.loaders.PythonLoader.load_bundles" title="Permalink to this definition">¶</a></dt>
<dd><p>Load <tt class="docutils literal"><span class="pre">Bundle</span></tt> objects defined in the Python module.</p>
<p>Collects all bundles in the global namespace.</p>
</dd></dl>

<dl class="method">
<dt id="webassets.loaders.PythonLoader.load_environment">
<tt class="descname">load_environment</tt><big>(</big><big>)</big><a class="headerlink" href="#webassets.loaders.PythonLoader.load_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Load an <tt class="docutils literal"><span class="pre">Environment</span></tt> defined in the Python module.</p>
<p>Expects as default a global name <tt class="docutils literal"><span class="pre">environment</span></tt> to be defined,
or overriden by passing a string <tt class="docutils literal"><span class="pre">module:environent</span></tt> to the
constructor.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-integration/index"></span><div class="section" id="integration-with-other-libraries">
<h5>Integration with other libraries<a class="headerlink" href="#integration-with-other-libraries" title="Permalink to this headline">¶</a></h5>
<p>While the <em>webassets</em> core is designed to work with any WSGI application,
also included are some additional utilities for some popular frameworks
and libraries.</p>
<div class="toctree-wrapper compound">
<span id="document-integration/jinja2"></span><div class="section" id="jinja2">
<h6>Jinja2<a class="headerlink" href="#jinja2" title="Permalink to this headline">¶</a></h6>
<p>A Jinja2 extension is available as <tt class="docutils literal"><span class="pre">webassets.ext.jinja2.AssetsExtension</span></tt>.
It will provide a <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">assets</span> <span class="pre">%}</span></tt> tag which allows you to reference your
bundles from within a template to render its urls.</p>
<p>It also allows you to create bundles on-the-fly, thus making it possible
to define your assets entirly within your templates.</p>
<p>If you are using Jinja2 inside of Django, see
<a class="reference external" href="http://elsdoerfer.name/docs/django-assets/jinja2.html">this page</a>.</p>
<div class="section" id="setting-up-the-extension">
<h7>Setting up the extension<a class="headerlink" href="#setting-up-the-extension" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span> <span class="k">as</span> <span class="n">Jinja2Environment</span>
<span class="kn">from</span> <span class="nn">webassets</span> <span class="kn">import</span> <span class="n">Environment</span> <span class="k">as</span> <span class="n">AssetsEnvironment</span>
<span class="kn">from</span> <span class="nn">webassets.ext.jinja2</span> <span class="kn">import</span> <span class="n">AssetsExtension</span>

<span class="n">assets_env</span> <span class="o">=</span> <span class="n">AssetsEnvironment</span><span class="p">(</span><span class="s">&#39;./static/media&#39;</span><span class="p">,</span> <span class="s">&#39;/media&#39;</span><span class="p">)</span>
<span class="n">jinja2_env</span> <span class="o">=</span> <span class="n">Jinja2Environment</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="n">AssetsExtension</span><span class="p">])</span>
<span class="n">jinja2_env</span><span class="o">.</span><span class="n">assets_environment</span> <span class="o">=</span> <span class="n">assets_env</span>
</pre></div>
</div>
<p>After adding the extension to your Jinja 2 environment, you need to
make sure that it knows about your <tt class="docutils literal"><span class="pre">webassets.Environment</span></tt> instance.
This is done by setting the <tt class="docutils literal"><span class="pre">assets_environment</span></tt> attribute.</p>
</div>
<div class="section" id="using-the-tag">
<h7>Using the tag<a class="headerlink" href="#using-the-tag" title="Permalink to this headline">¶</a></h7>
<p>To output a bundle that has been registered with the environment, simply
pass its name to the tag:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="s2">&quot;all_js&quot;</span><span class="o">,</span> <span class="s2">&quot;ie_js&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;script type=&quot;text/javascript&quot; src=&quot;</span><span class="cp">{{</span> <span class="nv">ASSET_URL</span> <span class="cp">}}</span><span class="x">&quot;&gt;&lt;/script&gt;</span>
<span class="cp">{%</span> <span class="k">endassets</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>The tag will repeatedly output its content for each <tt class="docutils literal"><span class="pre">ASSET_URL</span></tt> of each
bundle. In the above case, that might be the output urls of the <em>all_js</em>
and <em>ie_js</em> bundles, or, in debug mode, urls referencing the source files
of both bundles.</p>
<p>If you pass something to the tag that isn&#8217;t a known bundle name, it will
be considered a filename. This allows you to define a bundle entirely
within your templates:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">filters</span><span class="o">=</span><span class="s2">&quot;cssmin,datauri&quot;</span><span class="o">,</span> <span class="nv">output</span><span class="o">=</span><span class="s2">&quot;gen/packed.css&quot;</span><span class="o">,</span> <span class="s2">&quot;common/jquery.css&quot;</span><span class="o">,</span> <span class="s2">&quot;site/base.css&quot;</span><span class="o">,</span> <span class="s2">&quot;site/widgets.css&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">...</span>
</pre></div>
</div>
<p>Of course, this means you can combine the two approaches as well. The
following code snippet will merge together the given bundle and the contents
of the <tt class="docutils literal"><span class="pre">jquery.js</span></tt> file that was explicitly passed:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">output</span><span class="o">=</span><span class="s2">&quot;gen/packed.js&quot;</span><span class="o">,</span> <span class="s2">&quot;common/jquery.js&quot;</span><span class="o">,</span> <span class="s2">&quot;my-bundle&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">...</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-generic/custom_resolver"></span><div class="section" id="custom-resolvers">
<h5>Custom resolvers<a class="headerlink" href="#custom-resolvers" title="Permalink to this headline">¶</a></h5>
<p>The resolver is a pluggable object that webassets uses to find the
contents of a <tt class="xref py py-class docutils literal"><span class="pre">Bundle</span></tt> on the filesystem, as well as to
generate the correct urls to these files.</p>
<p>For example, the default resolver searches the
<a class="reference internal" href="index.html#webassets.env.Environment.load_path" title="webassets.env.Environment.load_path"><tt class="xref py py-attr docutils literal"><span class="pre">Environment.load_path</span></tt></a>, or looks within
<a class="reference internal" href="index.html#webassets.env.Environment.directory" title="webassets.env.Environment.directory"><tt class="xref py py-attr docutils literal"><span class="pre">Environment.directory</span></tt></a>. The <a class="reference external" href="https://github.com/miracle2k/django-assets">webassets Django integration</a>
will use Django&#8217;s <em>staticfile finders</em> to look for files.</p>
<p>For normal usage, you will not need to write your own resolver, or
indeed need to know how they work. However, if you want to integrate
<tt class="docutils literal"><span class="pre">webassets</span></tt> with another framework, or if your application is
complex enough that it requires custom file referencing, read on.</p>
<div class="section" id="the-api-as-webassets-sees-it">
<h6>The API as webassets sees it<a class="headerlink" href="#the-api-as-webassets-sees-it" title="Permalink to this headline">¶</a></h6>
<p><tt class="docutils literal"><span class="pre">webassets</span></tt> expects to find the resolver via the
<tt class="xref py py-attr docutils literal"><span class="pre">Environment.resolver</span></tt> property, and expects this object to
provide the following methods:</p>
<dl class="method">
<dt id="webassets.env.Resolver.resolve_source">
<tt class="descclassname">Resolver.</tt><tt class="descname">resolve_source</tt><big>(</big><em>ctx</em>, <em>item</em><big>)</big><a class="headerlink" href="#webassets.env.Resolver.resolve_source" title="Permalink to this definition">¶</a></dt>
<dd><p>Given <tt class="docutils literal"><span class="pre">item</span></tt> from a Bundle&#8217;s contents, this has to
return the final value to use, usually an absolute
filesystem path.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is also allowed to return urls and bundle instances
(or generally anything else the calling <tt class="xref py py-class docutils literal"><span class="pre">Bundle</span></tt>
instance may be able to handle). Indeed this is the
reason why the name of this method does not imply a
return type.</p>
</div>
<p>The incoming item is usually a relative path, but may also be
an absolute path, or a url. These you will commonly want to
return unmodified.</p>
<p>This method is also allowed to resolve <tt class="docutils literal"><span class="pre">item</span></tt> to multiple
values, in which case a list should be returned. This is
commonly used if <tt class="docutils literal"><span class="pre">item</span></tt> includes glob instructions
(wildcards).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Instead of this, subclasses should consider implementing
<a class="reference internal" href="index.html#webassets.env.Resolver.search_for_source" title="webassets.env.Resolver.search_for_source"><tt class="xref py py-meth docutils literal"><span class="pre">search_for_source()</span></tt></a> instead.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="webassets.env.Resolver.resolve_output_to_path">
<tt class="descclassname">Resolver.</tt><tt class="descname">resolve_output_to_path</tt><big>(</big><em>ctx</em>, <em>target</em>, <em>bundle</em><big>)</big><a class="headerlink" href="#webassets.env.Resolver.resolve_output_to_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Given <tt class="docutils literal"><span class="pre">target</span></tt>, this has to return the absolute
filesystem path to which the output file of <tt class="docutils literal"><span class="pre">bundle</span></tt>
should be written.</p>
<p><tt class="docutils literal"><span class="pre">target</span></tt> may be a relative or absolute path, and is
usually taking from the <tt class="xref py py-attr docutils literal"><span class="pre">Bundle.output</span></tt> property.</p>
<p>If a version-placeholder is used (<tt class="docutils literal"><span class="pre">%(version)s</span></tt>, it is
still unresolved at this point.</p>
</dd></dl>

<dl class="method">
<dt id="webassets.env.Resolver.resolve_source_to_url">
<tt class="descclassname">Resolver.</tt><tt class="descname">resolve_source_to_url</tt><big>(</big><em>ctx</em>, <em>filepath</em>, <em>item</em><big>)</big><a class="headerlink" href="#webassets.env.Resolver.resolve_source_to_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Given the absolute filesystem path in <tt class="docutils literal"><span class="pre">filepath</span></tt>, as
well as the original value from <tt class="xref py py-attr docutils literal"><span class="pre">Bundle.contents</span></tt> which
resolved to this path, this must return the absolute url
through which the file is to be referenced.</p>
<p>Depending on the use case, either the <tt class="docutils literal"><span class="pre">filepath</span></tt> or the
<tt class="docutils literal"><span class="pre">item</span></tt> argument will be more helpful in generating the url.</p>
<p>This method should raise a <tt class="docutils literal"><span class="pre">ValueError</span></tt> if the url cannot
be determined.</p>
</dd></dl>

<dl class="method">
<dt id="webassets.env.Resolver.resolve_output_to_url">
<tt class="descclassname">Resolver.</tt><tt class="descname">resolve_output_to_url</tt><big>(</big><em>ctx</em>, <em>target</em><big>)</big><a class="headerlink" href="#webassets.env.Resolver.resolve_output_to_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Given <tt class="docutils literal"><span class="pre">target</span></tt>, this has to return the url through
which the output file can be referenced.</p>
<p><tt class="docutils literal"><span class="pre">target</span></tt> may be a relative or absolute path, and is
usually taking from the <tt class="xref py py-attr docutils literal"><span class="pre">Bundle.output</span></tt> property.</p>
<p>This is different from <a class="reference internal" href="index.html#webassets.env.Resolver.resolve_source_to_url" title="webassets.env.Resolver.resolve_source_to_url"><tt class="xref py py-meth docutils literal"><span class="pre">resolve_source_to_url()</span></tt></a> in
that you do not passed along the result of
<a class="reference internal" href="index.html#webassets.env.Resolver.resolve_output_to_path" title="webassets.env.Resolver.resolve_output_to_path"><tt class="xref py py-meth docutils literal"><span class="pre">resolve_output_to_path()</span></tt></a>. This is because in many
use cases, the filesystem is not available at the point
where the output url is needed (the media server may on
a different machine).</p>
</dd></dl>

</div>
<div class="section" id="methods-to-overwrite">
<h6>Methods to overwrite<a class="headerlink" href="#methods-to-overwrite" title="Permalink to this headline">¶</a></h6>
<p>However, in practice, you will usually want to override the builtin
<tt class="xref py py-class docutils literal"><span class="pre">Resolver</span></tt>, and customize it&#8217;s behaviour where necessary. The
default resolver already splits what is is doing into multiple
methods; so that you can either override them, or
refer to them in your own implementation, as makes sense.</p>
<p>Instead of the official entrypoints above, you may instead prefer
to override the following methods of the default resolver class:</p>
<dl class="method">
<dt id="webassets.env.Resolver.search_for_source">
<tt class="descclassname">Resolver.</tt><tt class="descname">search_for_source</tt><big>(</big><em>ctx</em>, <em>item</em><big>)</big><a class="headerlink" href="#webassets.env.Resolver.search_for_source" title="Permalink to this definition">¶</a></dt>
<dd><p>Called by <a class="reference internal" href="index.html#webassets.env.Resolver.resolve_source" title="webassets.env.Resolver.resolve_source"><tt class="xref py py-meth docutils literal"><span class="pre">resolve_source()</span></tt></a> after determining that
<tt class="docutils literal"><span class="pre">item</span></tt> is a relative filesystem path.</p>
<p>You should always overwrite this method, and let
<a class="reference internal" href="index.html#webassets.env.Resolver.resolve_source" title="webassets.env.Resolver.resolve_source"><tt class="xref py py-meth docutils literal"><span class="pre">resolve_source()</span></tt></a> deal with absolute paths, urls and
other types of items that a bundle may contain.</p>
</dd></dl>

<dl class="method">
<dt id="webassets.env.Resolver.search_load_path">
<tt class="descclassname">Resolver.</tt><tt class="descname">search_load_path</tt><big>(</big><em>ctx</em>, <em>item</em><big>)</big><a class="headerlink" href="#webassets.env.Resolver.search_load_path" title="Permalink to this definition">¶</a></dt>
<dd><p>This is called by <a class="reference internal" href="index.html#webassets.env.Resolver.search_for_source" title="webassets.env.Resolver.search_for_source"><tt class="xref py py-meth docutils literal"><span class="pre">search_for_source()</span></tt></a> when a
<a class="reference internal" href="index.html#webassets.env.Environment.load_path" title="webassets.env.Environment.load_path"><tt class="xref py py-attr docutils literal"><span class="pre">Environment.load_path</span></tt></a> is set.</p>
<p>If you want to change how the load path is processed,
overwrite this method.</p>
</dd></dl>

</div>
<div class="section" id="helpers-to-use">
<h6>Helpers to use<a class="headerlink" href="#helpers-to-use" title="Permalink to this headline">¶</a></h6>
<p>The following methods of the default resolver class you may find
useful as helpers while implementing your subclass:</p>
<dl class="method">
<dt id="webassets.env.Resolver.consider_single_directory">
<tt class="descclassname">Resolver.</tt><tt class="descname">consider_single_directory</tt><big>(</big><em>directory</em>, <em>item</em><big>)</big><a class="headerlink" href="#webassets.env.Resolver.consider_single_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>Searches for <tt class="docutils literal"><span class="pre">item</span></tt> within <tt class="docutils literal"><span class="pre">directory</span></tt>. Is able to
resolve glob instructions.</p>
<p>Subclasses can call this when they have narrowed done the
location of a bundle item to a single directory.</p>
</dd></dl>

<dl class="method">
<dt id="webassets.env.Resolver.glob">
<tt class="descclassname">Resolver.</tt><tt class="descname">glob</tt><big>(</big><em>basedir</em>, <em>expr</em><big>)</big><a class="headerlink" href="#webassets.env.Resolver.glob" title="Permalink to this definition">¶</a></dt>
<dd><p>Generator that runs when a glob expression needs to be
resolved. Yields a list of absolute filenames.</p>
</dd></dl>

<dl class="method">
<dt id="webassets.env.Resolver.query_url_mapping">
<tt class="descclassname">Resolver.</tt><tt class="descname">query_url_mapping</tt><big>(</big><em>ctx</em>, <em>filepath</em><big>)</big><a class="headerlink" href="#webassets.env.Resolver.query_url_mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>Searches the environment-wide url mapping (based on the
urls assigned to each directory in the load path). Returns
the correct url for <tt class="docutils literal"><span class="pre">filepath</span></tt>.</p>
<p>Subclasses should be sure that they really want to call this
method, instead of simply falling back to <tt class="docutils literal"><span class="pre">super()</span></tt>.</p>
</dd></dl>

<div class="section" id="example-a-prefix-resolver">
<h7>Example: A prefix resolver<a class="headerlink" href="#example-a-prefix-resolver" title="Permalink to this headline">¶</a></h7>
<p>The following is a simple resolver implementation that searches
for files in a different directory depending on the first
directory part.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets.env</span> <span class="kn">import</span> <span class="n">Resolver</span>

<span class="k">class</span> <span class="nc">PrefixResolver</span><span class="p">(</span><span class="n">Resolver</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefixmap</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">prefixmap</span>

    <span class="k">def</span> <span class="nf">search_for_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot; not valid; a static path requires a prefix.&#39;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span>

        <span class="n">prefix</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s">&#39;Prefix &quot;</span><span class="si">%s</span><span class="s">&quot; of static path &quot;</span><span class="si">%s</span><span class="s">&quot; is not &#39;</span>
                              <span class="s">&#39;registered&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>

        <span class="c"># For the rest, defer to base class method, which provides</span>
        <span class="c"># support for things like globbing.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">consider_single_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">prefix</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>Using it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">env</span> <span class="o">=</span> <span class="n">webassets</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">resolver</span> <span class="o">=</span> <span class="n">PrefixResolver</span><span class="p">({</span>
    <span class="s">&#39;app1&#39;</span><span class="p">:</span> <span class="s">&#39;/var/www/app1/static&#39;</span><span class="p">,</span>
    <span class="s">&#39;app2&#39;</span><span class="p">:</span> <span class="s">&#39;/srv/deploy/media/app2&#39;</span><span class="p">,</span>
<span class="p">})</span>
<span class="n">bundle</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span>
   <span class="s">&#39;app2/scripts/jquery.js&#39;</span><span class="p">,</span>
   <span class="s">&#39;app1/*.js&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="other-implementations">
<h7>Other implementations<a class="headerlink" href="#other-implementations" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li><a class="reference external" href="https://github.com/miracle2k/django-assets/blob/master/django_assets/env.py">django-assets Resolver</a>
(search for <tt class="docutils literal"><span class="pre">class</span> <span class="pre">DjangoResolver</span></tt>).</li>
<li><a class="reference external" href="https://github.com/miracle2k/flask-assets/blob/master/src/flask_assets.py">Flask-Assets Resolver</a>
(search for <tt class="docutils literal"><span class="pre">class</span> <span class="pre">FlaskResolver</span></tt>).</li>
<li><a class="reference external" href="https://github.com/sontek/pyramid_webassets/blob/master/pyramid_webassets/__init__.py">pyramid_webassets Resolver</a>
(search for <tt class="docutils literal"><span class="pre">class</span> <span class="pre">PyramidResolver</span></tt>).</li>
</ul>
</div>
</div>
</div>
<span id="document-faq"></span><div class="section" id="faq">
<span id="id1"></span><h5>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h5>
<div class="section" id="is-there-a-cache-busting-feature">
<h6>Is there a cache-busting feature?<a class="headerlink" href="#is-there-a-cache-busting-feature" title="Permalink to this headline">¶</a></h6>
<p>Yes! See <a class="reference internal" href="index.html#document-expiring"><em>URL Expiry (cache busting)</em></a>.</p>
</div>
<div class="section" id="relative-urls-in-my-css-code-break-if-the-merged-asset-is-written-to-a-different-location-than-the-source-files-how-do-i-fix-this">
<h6>Relative URLs in my CSS code break if the merged asset is written to a different location than the source files. How do I fix this?<a class="headerlink" href="#relative-urls-in-my-css-code-break-if-the-merged-asset-is-written-to-a-different-location-than-the-source-files-how-do-i-fix-this" title="Permalink to this headline">¶</a></h6>
<p>Use the builtin <a class="reference internal" href="index.html#filters-cssrewrite"><em>cssrewrite</em></a> filter which
will transparently fix <tt class="docutils literal"><span class="pre">url()</span></tt> instructions in CSS files on the fly.</p>
</div>
<div class="section" id="i-am-using-a-css-compiler-and-i-need-its-filter-to-apply-even-in-debug-mode">
<h6>I am using a CSS compiler and I need its filter to apply even in debug mode!<a class="headerlink" href="#i-am-using-a-css-compiler-and-i-need-its-filter-to-apply-even-in-debug-mode" title="Permalink to this headline">¶</a></h6>
<p>See <a class="reference internal" href="index.html#document-css_compilers"><em>CSS compilers</em></a> for how this is best done.</p>
</div>
<div class="section" id="is-google-app-engine-supported">
<h6>Is Google App Engine supported?<a class="headerlink" href="#is-google-app-engine-supported" title="Permalink to this headline">¶</a></h6>
<p>Yes. Due to the way Google App Engine works (static files are stored on
separate servers), you need to build your assets locally, possibly using one
of the management commands provided for your preferred framework, and then
deploy them.</p>
<p>In production mode, you need to disable the <tt class="docutils literal"><span class="pre">Environment.auto_build</span></tt> setting.</p>
<p>For URL expiry functionality, you need to use a manifest that holds version
information. See <a class="reference internal" href="index.html#document-expiring"><em>URL Expiry (cache busting)</em></a>.</p>
<p>There is a barebone Google App Engine example in the
<a class="reference external" href="https://github.com/miracle2k/webassets/blob/master/tests/">examples/appengine/</a>
folder.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="detailed-documentation">
<h2>Detailed documentation<a class="headerlink" href="#detailed-documentation" title="Permalink to this headline">¶</a></h2>
<p>This documentation also includes some pages which are applicable regardless
of the framework used:</p>
<div class="toctree-wrapper compound">
<span id="document-environment"></span><div class="section" id="the-environment">
<span id="environment"></span><h3>The environment<a class="headerlink" href="#the-environment" title="Permalink to this headline">¶</a></h3>
<p>The environment has two responsibilities: One, it acts as a registry for
bundles, meaning you only have to pass around a single object to access
all your bundles.</p>
<p>Also, it holds the configuration.</p>
<div class="section" id="registering-bundles">
<h4>Registering bundles<a class="headerlink" href="#registering-bundles" title="Permalink to this headline">¶</a></h4>
<p>Bundles can be registered with the environment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_bundle</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">environment</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;my_bundle&#39;</span><span class="p">,</span> <span class="n">my_bundle</span><span class="p">)</span>
</pre></div>
</div>
<p>A shortcut syntax is also available - you may simply call <tt class="docutils literal"><span class="pre">register()</span></tt>
with the arguments which you would pass to the <tt class="docutils literal"><span class="pre">Bundle</span></tt> constructor:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">environment</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;my_bundle&#39;</span><span class="p">,</span> <span class="s">&#39;file1.js&#39;</span><span class="p">,</span> <span class="s">&#39;file2.js&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;packed.js&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The environment allows dictionary-style access to the registered bundles:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>
<span class="go">1</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>
<span class="go">[&lt;Bundle ...&gt;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">environment</span><span class="p">[</span><span class="s">&#39;my_bundle&#39;</span><span class="p">]</span>
<span class="go">&lt;Bundle ...&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<span id="environment-configuration"></span><h4>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h4>
<p>The environment supports the following configuration options:</p>
<dl class="attribute">
<dt id="webassets.env.Environment.directory">
<tt class="descclassname">Environment.</tt><tt class="descname">directory</tt><a class="headerlink" href="#webassets.env.Environment.directory" title="Permalink to this definition">¶</a></dt>
<dd><p>The base directory to which all paths will be relative to,
unless <tt class="xref py py-attr docutils literal"><span class="pre">load_paths</span></tt> are given, in which case this will
only serve as the output directory.</p>
<p>In the url space, it is mapped to <tt class="xref py py-attr docutils literal"><span class="pre">urls</span></tt>.</p>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.url">
<tt class="descclassname">Environment.</tt><tt class="descname">url</tt><a class="headerlink" href="#webassets.env.Environment.url" title="Permalink to this definition">¶</a></dt>
<dd><p>The url prefix used to construct urls for files in
<a class="reference internal" href="index.html#webassets.env.Environment.directory" title="webassets.env.Environment.directory"><tt class="xref py py-attr docutils literal"><span class="pre">directory</span></tt></a>.</p>
<p>To define url spaces for other directories, see
<a class="reference internal" href="index.html#webassets.env.Environment.url_mapping" title="webassets.env.Environment.url_mapping"><tt class="xref py py-attr docutils literal"><span class="pre">url_mapping</span></tt></a>.</p>
</dd></dl>

<span class="target" id="environment-setting-debug"></span><dl class="attribute">
<dt id="webassets.env.Environment.debug">
<tt class="descclassname">Environment.</tt><tt class="descname">debug</tt><a class="headerlink" href="#webassets.env.Environment.debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable/disable debug mode. Possible values are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">False</span></tt></dt>
<dd>Production mode. Bundles will be merged and filters applied.</dd>
<dt><tt class="docutils literal"><span class="pre">True</span></tt></dt>
<dd>Enable debug mode. Bundles will output their individual source
files.</dd>
<dt><em>&#8220;merge&#8221;</em></dt>
<dd>Merge the source files, but do not apply filters.</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.auto_build">
<tt class="descclassname">Environment.</tt><tt class="descname">auto_build</tt><a class="headerlink" href="#webassets.env.Environment.auto_build" title="Permalink to this definition">¶</a></dt>
<dd><p>Controls whether bundles should be automatically built, and
rebuilt, when required (if set to <tt class="docutils literal"><span class="pre">True</span></tt>), or whether they
must be built manually be the user, for example via a management
command.</p>
<p>This is a good setting to have enabled during debugging, and can
be very convenient for low-traffic sites in production as well.
However, there is a cost in checking whether the source files
have changed, so if you care about performance, or if your build
process takes very long, then you may want to disable this.</p>
<p>By default automatic building is enabled.</p>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.url_expire">
<tt class="descclassname">Environment.</tt><tt class="descname">url_expire</tt><a class="headerlink" href="#webassets.env.Environment.url_expire" title="Permalink to this definition">¶</a></dt>
<dd><p>If you send your assets to the client using a
<em>far future expires</em> header (to minimize the 304 responses
your server has to send), you need to make sure that assets
will be reloaded by the browser when they change.</p>
<p>If this is set to <tt class="docutils literal"><span class="pre">True</span></tt>, then the Bundle URLs generated by
webassets will have their version (see <tt class="docutils literal"><span class="pre">Environment.versions</span></tt>)
appended as a querystring.</p>
<p>An alternative approach would be to use the <tt class="docutils literal"><span class="pre">%(version)s</span></tt>
placeholder in the bundle output file.</p>
<p>The default behavior (indicated by a <tt class="docutils literal"><span class="pre">None</span></tt> value) is to add
an expiry querystring if the bundle does not use a version
placeholder.</p>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.versions">
<tt class="descclassname">Environment.</tt><tt class="descname">versions</tt><a class="headerlink" href="#webassets.env.Environment.versions" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines what should be used as a Bundle <tt class="docutils literal"><span class="pre">version</span></tt>.</p>
<p>A bundle&#8217;s version is what is appended to URLs when the
<tt class="docutils literal"><span class="pre">url_expire</span></tt> option is enabled, and the version can be part
of a Bundle&#8217;s output filename by use of the <tt class="docutils literal"><span class="pre">%(version)s</span></tt>
placeholder.</p>
<p>Valid values are:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">timestamp</span></tt></dt>
<dd>The version is determined by looking at the mtime of a
bundle&#8217;s output file.</dd>
<dt><tt class="docutils literal"><span class="pre">hash</span></tt> (default)</dt>
<dd>The version is a hash over the output file&#8217;s content.</dd>
<dt><tt class="docutils literal"><span class="pre">False</span></tt>, <tt class="docutils literal"><span class="pre">None</span></tt></dt>
<dd>Functionality that requires a version is disabled. This
includes the <tt class="docutils literal"><span class="pre">url_expire</span></tt> option, the <tt class="docutils literal"><span class="pre">auto_build</span></tt>
option, and support for the %(version)s placeholder.</dd>
</dl>
<p>Any custom version implementation.</p>
</div></blockquote>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.manifest">
<tt class="descclassname">Environment.</tt><tt class="descname">manifest</tt><a class="headerlink" href="#webassets.env.Environment.manifest" title="Permalink to this definition">¶</a></dt>
<dd><p>A manifest persists information about the versions bundles
are at.</p>
<p>The Manifest plays a role only if you insert the bundle version
in your output filenames, or append the version as a querystring
to the url (via the <tt class="docutils literal"><span class="pre">url_expire</span></tt> option). It serves two
purposes:</p>
<blockquote>
<div><ul class="simple">
<li>Without a manifest, it may be impossible to determine the
version at runtime. In a deployed app, the media files may
be stored on a different server entirely, and be
inaccessible from the application code. The manifest,
if shipped with your application, is what still allows to
construct the proper URLs.</li>
<li>Even if it were possible to determine the version at
runtime without a manifest, it may be a costly process,
and using a manifest may give you better performance. If
you use a hash-based version for example, this hash would
need to be recalculated every time a new process is
started.</li>
</ul>
</div></blockquote>
<p>Valid values are:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">&quot;cache&quot;</span></tt> (default)</dt>
<dd>The cache is used to remember version information. This
is useful to avoid recalculating the version hash.</dd>
<dt><tt class="docutils literal"><span class="pre">&quot;file:{path}&quot;</span></tt></dt>
<dd>Stores version information in a file at {path}. If not
path is given, the manifest will be stored as
<tt class="docutils literal"><span class="pre">.webassets-manifest</span></tt> in <tt class="docutils literal"><span class="pre">Environment.directory</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">&quot;json:{path}&quot;</span></tt></dt>
<dd>Same as &#8220;file:{path}&#8221;, but uses JSON to store the information.</dd>
<dt><tt class="docutils literal"><span class="pre">False</span></tt>, <tt class="docutils literal"><span class="pre">None</span></tt></dt>
<dd>No manifest is used.</dd>
</dl>
<p>Any custom manifest implementation.</p>
</div></blockquote>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.cache">
<tt class="descclassname">Environment.</tt><tt class="descname">cache</tt><a class="headerlink" href="#webassets.env.Environment.cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Controls the behavior of the cache. The cache will speed up rebuilding
of your bundles, by caching individual filter results. This can be
particularly useful while developing, if your bundles would otherwise take
a long time to rebuild.</p>
<p>Possible values are:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">False</span></tt></dt>
<dd>Do not use the cache.</dd>
<dt><tt class="docutils literal"><span class="pre">True</span></tt> (default)</dt>
<dd>Cache using default location, a <tt class="docutils literal"><span class="pre">.webassets-cache</span></tt> folder inside
<a class="reference internal" href="index.html#webassets.env.Environment.directory" title="webassets.env.Environment.directory"><tt class="xref py py-attr docutils literal"><span class="pre">directory</span></tt></a>.</dd>
<dt><em>custom path</em></dt>
<dd>Use the given directory as the cache directory.</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.load_path">
<tt class="descclassname">Environment.</tt><tt class="descname">load_path</tt><a class="headerlink" href="#webassets.env.Environment.load_path" title="Permalink to this definition">¶</a></dt>
<dd><p>An list of directories that will be searched for source files.</p>
<p>If this is set, source files will only be looked for in these
directories, and <a class="reference internal" href="index.html#webassets.env.Environment.directory" title="webassets.env.Environment.directory"><tt class="xref py py-attr docutils literal"><span class="pre">directory</span></tt></a> is used as a location for
output files only.</p>
<p>To modify this list, you should use <tt class="xref py py-meth docutils literal"><span class="pre">append_path()</span></tt>, since
it makes it easy to add the corresponding url prefix to
<a class="reference internal" href="index.html#webassets.env.Environment.url_mapping" title="webassets.env.Environment.url_mapping"><tt class="xref py py-attr docutils literal"><span class="pre">url_mapping</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="webassets.env.Environment.url_mapping">
<tt class="descclassname">Environment.</tt><tt class="descname">url_mapping</tt><a class="headerlink" href="#webassets.env.Environment.url_mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary of directory -&gt; url prefix mappings that will
be considered when generating urls, in addition to the pair of
<a class="reference internal" href="index.html#webassets.env.Environment.directory" title="webassets.env.Environment.directory"><tt class="xref py py-attr docutils literal"><span class="pre">directory</span></tt></a> and <a class="reference internal" href="index.html#webassets.env.Environment.url" title="webassets.env.Environment.url"><tt class="xref py py-attr docutils literal"><span class="pre">url</span></tt></a>, which is always active.</p>
<p>You should use <tt class="xref py py-meth docutils literal"><span class="pre">append_path()</span></tt> to add directories to the
load path along with their respective url spaces, instead of
modifying this setting directly.</p>
</dd></dl>

</div>
<div class="section" id="filter-configuration">
<h4>Filter configuration<a class="headerlink" href="#filter-configuration" title="Permalink to this headline">¶</a></h4>
<p>In addition to the standard options listed above, you can set custom
configuration values using <tt class="docutils literal"><span class="pre">Environment.config</span></tt>. This is so that you can
configure filters through the environment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">environment</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;sass_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;/opt/sass/bin/sass&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This allows the <a class="reference internal" href="index.html#filters-sass"><em>Sass filter</em></a> to find the sass
binary.</p>
<p>Note: Filters usually allow you to define these values as system
environment variables as well. That is, you could also define a
<tt class="docutils literal"><span class="pre">SASS_BIN</span></tt> environment variable to setup the filter.</p>
</div>
</div>
<span id="document-bundles"></span><div class="section" id="bundles">
<span id="id1"></span><h3>Bundles<a class="headerlink" href="#bundles" title="Permalink to this headline">¶</a></h3>
<p>A bundle is simply a collection of files that you would like to group
together, with some properties attached to tell <tt class="docutils literal"><span class="pre">webassets</span></tt>
how to do its job. Such properties include the filters which should
be applied, or the location where the output file should be stored.</p>
<p>Note that all filenames and paths considered to be relative to the
<tt class="docutils literal"><span class="pre">directory</span></tt> setting of your <a class="reference internal" href="index.html#document-environment"><em>environment</em></a>, and
generated urls will be relative to the <tt class="docutils literal"><span class="pre">url</span></tt> setting.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;common/inheritance.js&#39;</span><span class="p">,</span> <span class="s">&#39;portal/js/common.js&#39;</span><span class="p">,</span>
       <span class="s">&#39;portal/js/plot.js&#39;</span><span class="p">,</span> <span class="s">&#39;portal/js/ticker.js&#39;</span><span class="p">,</span>
       <span class="n">filters</span><span class="o">=</span><span class="s">&#39;jsmin&#39;</span><span class="p">,</span>
       <span class="n">output</span><span class="o">=</span><span class="s">&#39;gen/packed.js&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A bundle takes any number of filenames, as well as the following keyword
arguments:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">filters</span></tt> -
One or multiple filters to apply. If no filters are specified, the
source files will merely be merged into the output file. Filters are
applied in the order in which they are given.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">output</span></tt> - Name/path of the output file. All source files will be merged
and the result stored at this location. A <tt class="docutils literal"><span class="pre">%(version)s</span></tt> placeholder is
supported here, which will be replaced with the version of the file. See
<a class="reference internal" href="index.html#document-expiring"><em>URL Expiry (cache busting)</em></a>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">depends</span></tt> - Additional files that will be watched to determine if the
bundle needs to be rebuilt. This is usually necessary if you are using
compilers that allow <tt class="docutils literal"><span class="pre">&#64;import</span></tt> instructions. Commonly, one would use a
glob instruction here for simplicity:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="n">depends</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;**/*.scss&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Currently, using <tt class="docutils literal"><span class="pre">depends</span></tt> disables caching for a bundle.</p>
</div>
</li>
</ul>
<div class="section" id="nested-bundles">
<h4>Nested bundles<a class="headerlink" href="#nested-bundles" title="Permalink to this headline">¶</a></h4>
<p>Bundles may also contain other bundles:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets</span> <span class="kn">import</span> <span class="n">Bundle</span>

<span class="n">all_js</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span>
    <span class="c"># jQuery</span>
    <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;common/libs/jquery/jquery.js&#39;</span><span class="p">,</span>
        <span class="s">&#39;common/libs/jquery/jquery.ajaxQueue.js&#39;</span><span class="p">,</span>
        <span class="s">&#39;common/libs/jquery/jquery.bgiframe.js&#39;</span><span class="p">,),</span>
    <span class="c"># jQuery Tools</span>
    <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;common/libs/jqtools/tools.tabs.js&#39;</span><span class="p">,</span>
        <span class="s">&#39;common/libs/jqtools/tools.tabs.history.js&#39;</span><span class="p">,</span>
        <span class="s">&#39;common/libs/jqtools/tools.tabs.slideshow.js&#39;</span><span class="p">),</span>
    <span class="c"># Our own stuff</span>
    <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;common/inheritance.js&#39;</span><span class="p">,</span> <span class="s">&#39;portal/js/common.js&#39;</span><span class="p">,</span>
        <span class="s">&#39;portal/js/plot.js&#39;</span><span class="p">,</span> <span class="s">&#39;portal/js/ticker.js&#39;</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">=</span><span class="s">&#39;jsmin&#39;</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="s">&#39;gen/packed.js&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, the use of nested <tt class="docutils literal"><span class="pre">Bundle</span></tt> objects to group the JavaScript files
together is purely aesthetical. You could just as well pass all files as
a flat list. However, there are some more serious application as well.
One of them is the use of <a class="reference internal" href="index.html#document-css_compilers"><em>CSS compilers</em></a>.
Another would be dealing with pre-compressed files:</p>
<p>If you are using a JavaScript library like <a class="reference external" href="http://jquery.com/">jQuery</a>,
you might find yourself with a file like <tt class="docutils literal"><span class="pre">jquery.min.js</span></tt> in your media
directory, i.e. it is already minified - no reason to do it again.</p>
<p>While I would recommend always using the raw source files, and letting
<tt class="docutils literal"><span class="pre">webassets</span></tt> do the compressing, if you do have minified files that you
need to merge together with uncompressed ones, you could do it like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">register</span><span class="p">(</span><span class="s">&#39;js-all&#39;</span><span class="p">,</span>
    <span class="s">&#39;jquery.min.js&#39;</span><span class="p">,</span>
    <span class="n">Bundle</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="s">&#39;jsmin&#39;</span><span class="p">,</span> <span class="s">&#39;uncompressed.js&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Generally speaking, nested bundles allow you to apply different sets of
filters to different groups of files, but still everything together
into a single output file.</p>
<p>Some things to consider when nesting bundles:</p>
<ul class="simple">
<li>Duplicate filters are only applied once (the leaf filter is applied).</li>
<li>If a bundle that is supposed to be processed to a file does not define
an output target, it simply serves as a container of its sub-bundles,
which in turn will be processed into their respective output files.
In this case it must not have any files of its own.</li>
</ul>
</div>
<div class="section" id="building-bundles">
<h4>Building bundles<a class="headerlink" href="#building-bundles" title="Permalink to this headline">¶</a></h4>
<p>Once a bundle is defined, the thing you want to do is build it, and then
include a link to the final merged and compressed output file in your
site.</p>
<p>There are different approaches.</p>
<div class="section" id="in-code">
<h5>In Code<a class="headerlink" href="#in-code" title="Permalink to this headline">¶</a></h5>
<p>For starters, you can simply call the bundle&#8217;s <tt class="docutils literal"><span class="pre">urls()</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="p">[</span><span class="s">&#39;all_js&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">urls</span><span class="p">()</span>
<span class="go">(&#39;/media/gen/packed.js&#39;,)</span>
</pre></div>
</div>
<p>Depending on the value of <tt class="docutils literal"><span class="pre">environment.debug</span></tt>. it will either return
a list of all the bundle&#8217;s source files, or the merged file pointed to
by the bundle&#8217;s <tt class="docutils literal"><span class="pre">output</span></tt> option - all relative to the
<tt class="docutils literal"><span class="pre">environment.url</span></tt> setting.</p>
<p><tt class="docutils literal"><span class="pre">urls()</span></tt> will always ensure that the files behind the urls it returns
actually exist. That is, it will merge and compress the source files in
production mode when first called, and update the compressed assets when
it detects changes. This behavior can be customized using various
<a class="reference internal" href="index.html#environment-configuration"><em>environment configuration values</em></a>.</p>
<p>Call <tt class="docutils literal"><span class="pre">urls()</span></tt> once per request, and pass the resulting list of urls to
your template, and you&#8217;re good to go.</p>
</div>
<div class="section" id="in-templates">
<h5>In templates<a class="headerlink" href="#in-templates" title="Permalink to this headline">¶</a></h5>
<p>For <a class="reference internal" href="index.html#document-integration/index"><em>some template languages</em></a>, webassets
includes extensions which allow you to access the bundles you defined.
Further, they usually allow you to define bundles on-the-fly, so you can
reference your assets directly from within your templates, rather than
predefining them in code.</p>
<p>For example, there is a template tag for <a class="reference internal" href="index.html#document-integration/jinja2"><em>Jinja2</em></a>,
which allows you do something like this:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">filters</span><span class="o">=</span><span class="s2">&quot;cssmin,datauri&quot;</span><span class="o">,</span> <span class="nv">output</span><span class="o">=</span><span class="s2">&quot;gen/packed.css&quot;</span><span class="o">,</span> <span class="s2">&quot;common/jquery.css&quot;</span><span class="o">,</span> <span class="s2">&quot;site/base.css&quot;</span><span class="o">,</span> <span class="s2">&quot;site/widgets.css&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">...</span>
</pre></div>
</div>
</div>
<div class="section" id="management-command">
<h5>Management command<a class="headerlink" href="#management-command" title="Permalink to this headline">¶</a></h5>
<p>In some cases you  might prefer to cause a manual build of your bundles
from the command line. See <a class="reference internal" href="index.html#document-script"><em>Command Line Interface</em></a> for more information.</p>
</div>
</div>
</div>
<span id="document-script"></span><div class="section" id="command-line-interface">
<h3>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h3>
<p>While it&#8217;s often convienient to have webassets automatically rebuild
your bundles on access, you sometimes may prefer to build manually,
for example for performance reasons in larger deployments.</p>
<p><em>webassets</em> provides a command line interface which is supposed to help
you manage your bundles manually. However, due to the generic nature of
the webassets core library, it usually needs some help setting up.</p>
<p>You may want to check the <a class="reference internal" href="index.html#document-integration/index"><em>integration page</em></a>
to see if webassets already provides helpers to expose the command line
within your framework. If that is not the case, read on.</p>
<div class="section" id="build-a-custom-command-line-client">
<h4>Build a custom command line client<a class="headerlink" href="#build-a-custom-command-line-client" title="Permalink to this headline">¶</a></h4>
<p>In most cases, you can simple wrap around the <tt class="docutils literal"><span class="pre">webassets.script.main</span></tt>
function. For example, the command provided by Flask-Assets looks like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ManageAssets</span><span class="p">(</span><span class="n">flaskext</span><span class="o">.</span><span class="n">script</span><span class="o">.</span><span class="n">Command</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets_env</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">assets_env</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">prog</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">remaining_args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">webassets</span> <span class="kn">import</span> <span class="n">script</span>
        <span class="n">script</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">remaining_args</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
</pre></div>
</div>
<p>In cases where this isn&#8217;t possible for some reason, or you need more
control, you can work directly with the
<tt class="docutils literal"><span class="pre">webassets.script.CommandLineEnvironment</span></tt> class, which implements all
the commands as simple methods.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">webassets.script</span> <span class="kn">import</span> <span class="n">CommandLineEnvironment</span>

<span class="c"># Setup a logger</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;webassets&#39;</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">())</span>
<span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="n">cmdenv</span> <span class="o">=</span> <span class="n">CommandLineEnvironment</span><span class="p">(</span><span class="n">assets_env</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
<span class="n">cmdenv</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="s">&#39;build&#39;</span><span class="p">)</span>

<span class="c"># This would also work</span>
<span class="n">cmdenv</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>You are reponsible for parsing the command line in any way you see fit
(using for example the <a class="reference external" href="http://docs.python.org/library/optparse.html#module-optparse" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">optparse</span></tt></a> or <a class="reference external" href="http://docs.python.org/library/argparse.html#module-argparse" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">argparse</span></tt></a> libraries,
or whatever your framework provides as a command line utility shell), and
then invoking the corresponding methods on your instance of
<tt class="docutils literal"><span class="pre">CommandLineEnvironment</span></tt>.</p>
</div>
<div class="section" id="included-commands">
<span id="script-commands"></span><h4>Included Commands<a class="headerlink" href="#included-commands" title="Permalink to this headline">¶</a></h4>
<p>The following describes the commands that will be available to you through
the <em>webassets</em> CLI interface.</p>
<div class="section" id="build">
<h5>build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h5>
<p>Builds all bundles, regardless of whether they are detected as having changed
or not.</p>
</div>
<div class="section" id="watch">
<h5>watch<a class="headerlink" href="#watch" title="Permalink to this headline">¶</a></h5>
<p>Start a daemon which monitors your bundle source files, and automatically
rebuilds bundles when a change is detected.</p>
<p>This can be useful during development, if building is not instantaneous, and
you are losing valuable time waiting for the build to finish while trying to
access your site.</p>
</div>
<div class="section" id="clean">
<h5>clean<a class="headerlink" href="#clean" title="Permalink to this headline">¶</a></h5>
<p>Will clear out the cache, which after a while can grow quite large.</p>
</div>
</div>
</div>
<span id="document-builtin_filters"></span><span class="target" id="module-webassets.filter"></span><div class="section" id="included-filters">
<span id="builtin-filters"></span><h3>Included Filters<a class="headerlink" href="#included-filters" title="Permalink to this headline">¶</a></h3>
<p>The following filters are included in <tt class="docutils literal"><span class="pre">webassets</span></tt>, though some may
require the installation of an external library, or the availability of
external tools.</p>
<p>You can also write <a class="reference internal" href="index.html#document-custom_filters"><em>custom filters</em></a>.</p>
<div class="section" id="javascript-compressors">
<h4>Javascript compressors<a class="headerlink" href="#javascript-compressors" title="Permalink to this headline">¶</a></h4>
<div class="section" id="rjsmin">
<h5><tt class="docutils literal"><span class="pre">rjsmin</span></tt><a class="headerlink" href="#rjsmin" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.rjsmin.RJSMin">
<em class="property">class </em><tt class="descclassname">webassets.filter.rjsmin.</tt><tt class="descname">RJSMin</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.rjsmin.RJSMin" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies Javascript by removing whitespace, comments, etc.</p>
<p>Uses the <a class="reference external" href="http://opensource.perlig.de/rjsmin/">rJSmin library</a>,
which is included with webassets. However, if you have the external
package installed, it will be used instead. You may want to do this
to get access to the faster C-extension.</p>
</dd></dl>

</div>
<div class="section" id="module-webassets.filter.yui">
<span id="yui-js"></span><h5><tt class="docutils literal"><span class="pre">yui_js</span></tt><a class="headerlink" href="#module-webassets.filter.yui" title="Permalink to this headline">¶</a></h5>
<p>Minify Javascript and CSS with
<a class="reference external" href="http://developer.yahoo.com/yui/compressor/">YUI Compressor</a>.</p>
<p>YUI Compressor is an external tool written in Java, which needs to be
available. One way to get it is to install the
<a class="reference external" href="http://pypi.python.org/pypi/yuicompressor">yuicompressor</a> package:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install yuicompressor
</pre></div>
</div>
<p>No configuration is necessary in this case.</p>
<p>You can also get YUI compressor a different way and define
a <tt class="docutils literal"><span class="pre">YUI_COMPRESSOR_PATH</span></tt> setting that points to the <tt class="docutils literal"><span class="pre">.jar</span></tt> file.
Otherwise, an environment variable by the same name is tried. The
filter will also look for a <tt class="docutils literal"><span class="pre">JAVA_HOME</span></tt> environment variable to
run the <tt class="docutils literal"><span class="pre">.jar</span></tt> file, or will otherwise assume that <tt class="docutils literal"><span class="pre">java</span></tt> is
on the system path.</p>
<dl class="class">
<dt id="webassets.filter.yui.YUIJS">
<em class="property">class </em><tt class="descclassname">webassets.filter.yui.</tt><tt class="descname">YUIJS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.yui.YUIJS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-webassets.filter.closure">
<span id="closure-js"></span><h5><tt class="docutils literal"><span class="pre">closure_js</span></tt><a class="headerlink" href="#module-webassets.filter.closure" title="Permalink to this headline">¶</a></h5>
<p>Minify Javascript with <a class="reference external" href="https://code.google.com/p/closure-compiler/">Google Closure Compiler</a>.</p>
<p>Google Closure Compiler is an external tool written in Java, which needs
to be available. One way to get it is to install the
<a class="reference external" href="http://pypi.python.org/pypi/closure">closure</a> package:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install closure
</pre></div>
</div>
<p>No configuration is necessary in this case.</p>
<p>You can also define a <tt class="docutils literal"><span class="pre">CLOSURE_COMPRESSOR_PATH</span></tt> setting that
points to the <tt class="docutils literal"><span class="pre">.jar</span></tt> file. Otherwise, an environment variable by
the same name is tried. The filter will also look for a <tt class="docutils literal"><span class="pre">JAVA_HOME</span></tt>
environment variable to run the <tt class="docutils literal"><span class="pre">.jar</span></tt> file, or will otherwise
assume that <tt class="docutils literal"><span class="pre">java</span></tt> is on the system path.</p>
<p>Supported configuration options:</p>
<dl class="docutils">
<dt>CLOSURE_COMPRESSOR_OPTIMIZATION</dt>
<dd>Corresponds to Google Closure&#8217;s <a class="reference external" href="https://code.google.com/closure/compiler/docs/compilation_levels.html">compilation level parameter</a>.</dd>
<dt>CLOSURE_EXTRA_ARGS</dt>
<dd><p class="first">A list of further options to be passed to the Closure compiler.
There are a lot of them.</p>
<p>For options which take values you want to use two items in the list:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;--output_wrapper&#39;</span><span class="p">,</span> <span class="s">&#39;foo: </span><span class="si">%o</span><span class="s">utput%&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="uglifyjs">
<h5><tt class="docutils literal"><span class="pre">uglifyjs</span></tt><a class="headerlink" href="#uglifyjs" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.uglifyjs.UglifyJS">
<em class="property">class </em><tt class="descclassname">webassets.filter.uglifyjs.</tt><tt class="descname">UglifyJS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.uglifyjs.UglifyJS" title="Permalink to this definition">¶</a></dt>
<dd><p>Minify Javascript using <a class="reference external" href="https://github.com/mishoo/UglifyJS/">UglifyJS</a>.</p>
<p>The filter requires version 2 of UglifyJS.</p>
<p>UglifyJS is an external tool written for NodeJS; this filter assumes that
the <tt class="docutils literal"><span class="pre">uglifyjs</span></tt> executable is in the path. Otherwise, you may define
a <tt class="docutils literal"><span class="pre">UGLIFYJS_BIN</span></tt> setting.</p>
<p>Additional options may be passed to <tt class="docutils literal"><span class="pre">uglifyjs</span></tt> using the setting
<tt class="docutils literal"><span class="pre">UGLIFYJS_EXTRA_ARGS</span></tt>, which expects a list of strings.</p>
</dd></dl>

</div>
<div class="section" id="jsmin">
<h5><tt class="docutils literal"><span class="pre">jsmin</span></tt><a class="headerlink" href="#jsmin" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.jsmin.JSMin">
<em class="property">class </em><tt class="descclassname">webassets.filter.jsmin.</tt><tt class="descname">JSMin</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.jsmin.JSMin" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies Javascript by removing whitespace, comments, etc.</p>
<p>This filter uses a Python port of Douglas Crockford&#8217;s <a class="reference external" href="http://www.crockford.com/javascript/jsmin.html">JSMin</a>, which needs
to be installed separately.</p>
<p>There are actually multiple implementations available, for
example one by Baruch Even. Easiest to install via PyPI is
the one by Dave St. Germain:</p>
<div class="highlight-python"><div class="highlight"><pre>$ pip install jsmin
</pre></div>
</div>
<p>The filter is tested with this <tt class="docutils literal"><span class="pre">jsmin</span></tt> package from PyPI,
but will work with any module that exposes a
<tt class="docutils literal"><span class="pre">JavascriptMinify</span></tt> object with a <tt class="docutils literal"><span class="pre">minify</span></tt> method.</p>
<p>If you want to avoid installing another dependency, use the
<a class="reference internal" href="index.html#webassets.filter.rjsmin.RJSMin" title="webassets.filter.rjsmin.RJSMin"><tt class="xref py py-class docutils literal"><span class="pre">webassets.filter.rjsmin.RJSMin</span></tt></a> filter instead.</p>
</dd></dl>

</div>
<div class="section" id="jspacker">
<h5><tt class="docutils literal"><span class="pre">jspacker</span></tt><a class="headerlink" href="#jspacker" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.jspacker.JSPacker">
<em class="property">class </em><tt class="descclassname">webassets.filter.jspacker.</tt><tt class="descname">JSPacker</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.jspacker.JSPacker" title="Permalink to this definition">¶</a></dt>
<dd><p>Reduces the size of Javascript using an inline compression
algorithm, i.e. the script will be unpacked on the client side
by the browser.</p>
<p>Based on Dean Edwards&#8217; <a class="reference external" href="http://dean.edwards.name/packer/">jspacker 2</a>,
as ported by Florian Schulze.</p>
</dd></dl>

</div>
<div class="section" id="slimit">
<h5><tt class="docutils literal"><span class="pre">slimit</span></tt><a class="headerlink" href="#slimit" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.slimit.Slimit">
<em class="property">class </em><tt class="descclassname">webassets.filter.slimit.</tt><tt class="descname">Slimit</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.slimit.Slimit" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies JS.</p>
<p>Requires the <tt class="docutils literal"><span class="pre">slimit</span></tt> package (<a class="reference external" href="https://github.com/rspivak/slimit">https://github.com/rspivak/slimit</a>),
which is a JavaScript minifier written in Python. It compiles JavaScript
into more compact code so that it downloads and runs faster.</p>
<p>Right now it does not use the mangle options to its minifier.</p>
</dd></dl>

</div>
</div>
<div class="section" id="css-compressors">
<h4>CSS compressors<a class="headerlink" href="#css-compressors" title="Permalink to this headline">¶</a></h4>
<div class="section" id="cssmin">
<h5><tt class="docutils literal"><span class="pre">cssmin</span></tt><a class="headerlink" href="#cssmin" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.cssmin.CSSMin">
<em class="property">class </em><tt class="descclassname">webassets.filter.cssmin.</tt><tt class="descname">CSSMin</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.cssmin.CSSMin" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies CSS.</p>
<p>Requires the <tt class="docutils literal"><span class="pre">cssmin</span></tt> package (<a class="reference external" href="http://github.com/zacharyvoase/cssmin">http://github.com/zacharyvoase/cssmin</a>),
which is a port of the YUI CSS compression algorithm.</p>
</dd></dl>

</div>
<div class="section" id="cssutils">
<h5><tt class="docutils literal"><span class="pre">cssutils</span></tt><a class="headerlink" href="#cssutils" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.cssutils.CSSUtils">
<em class="property">class </em><tt class="descclassname">webassets.filter.cssutils.</tt><tt class="descname">CSSUtils</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.cssutils.CSSUtils" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies CSS by removing whitespace, comments etc., using the Python
<a class="reference external" href="http://cthedot.de/cssutils/">cssutils</a> library.</p>
<p>Note that since this works as a parser on the syntax level, so invalid
CSS input could potentially result in data loss.</p>
</dd></dl>

</div>
<div class="section" id="yui-css">
<h5><tt class="docutils literal"><span class="pre">yui_css</span></tt><a class="headerlink" href="#yui-css" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.yui.YUICSS">
<em class="property">class </em><tt class="descclassname">webassets.filter.yui.</tt><tt class="descname">YUICSS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.yui.YUICSS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="cleancss">
<h5><tt class="docutils literal"><span class="pre">cleancss</span></tt><a class="headerlink" href="#cleancss" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.cleancss.CleanCSS">
<em class="property">class </em><tt class="descclassname">webassets.filter.cleancss.</tt><tt class="descname">CleanCSS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.cleancss.CleanCSS" title="Permalink to this definition">¶</a></dt>
<dd><p>Minify css using <a class="reference external" href="https://github.com/GoalSmashers/clean-css/">Clean-css</a>.</p>
<p>Clean-css is an external tool written for NodeJS; this filter assumes that
the <tt class="docutils literal"><span class="pre">cleancss</span></tt> executable is in the path. Otherwise, you may define
a <tt class="docutils literal"><span class="pre">CLEANCSS_BIN</span></tt> setting.</p>
<p>Additional options may be passed to <tt class="docutils literal"><span class="pre">cleancss</span></tt> binary using the setting
<tt class="docutils literal"><span class="pre">CLEANCSS_EXTRA_ARGS</span></tt>, which expects a list of strings.</p>
</dd></dl>

</div>
<div class="section" id="slimmer-css">
<h5><tt class="docutils literal"><span class="pre">slimmer_css</span></tt><a class="headerlink" href="#slimmer-css" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.slimmer.CSSSlimmer">
<em class="property">class </em><tt class="descclassname">webassets.filter.slimmer.</tt><tt class="descname">CSSSlimmer</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.slimmer.CSSSlimmer" title="Permalink to this definition">¶</a></dt>
<dd><p>Minifies CSS by removing whitespace, comments etc., using the Python
<a class="reference external" href="http://pypi.python.org/pypi/slimmer/">slimmer</a> library.</p>
</dd></dl>

</div>
</div>
<div class="section" id="js-css-compilers">
<span id="filters-css-compilers"></span><h4>JS/CSS compilers<a class="headerlink" href="#js-css-compilers" title="Permalink to this headline">¶</a></h4>
<div class="section" id="clevercss">
<h5><tt class="docutils literal"><span class="pre">clevercss</span></tt><a class="headerlink" href="#clevercss" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.clevercss.CleverCSS">
<em class="property">class </em><tt class="descclassname">webassets.filter.clevercss.</tt><tt class="descname">CleverCSS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.clevercss.CleverCSS" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://sandbox.pocoo.org/clevercss/">CleverCSS</a> markup
to real CSS.</p>
<p>If you want to combine it with other CSS filters, make sure this one
runs first.</p>
</dd></dl>

</div>
<div class="section" id="less">
<span id="filters-less"></span><h5><tt class="docutils literal"><span class="pre">less</span></tt><a class="headerlink" href="#less" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.less.Less">
<em class="property">class </em><tt class="descclassname">webassets.filter.less.</tt><tt class="descname">Less</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.less.Less" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://lesscss.org/">less</a> markup to real CSS.</p>
<p>This depends on the NodeJS implementation of less, installable via npm.
To use the old Ruby-based version (implemented in the 1.x Ruby gem), see
<a class="reference internal" href="index.html#webassets.filter.less_ruby.Less" title="webassets.filter.less_ruby.Less"><tt class="xref py py-class docutils literal"><span class="pre">Less</span></tt></a>.</p>
<p><em>Supported configuration options</em>:</p>
<dl class="docutils">
<dt>LESS_BIN (binary)</dt>
<dd>Path to the less executable used to compile source files. By default,
the filter will attempt to run <tt class="docutils literal"><span class="pre">lessc</span></tt> via the system path.</dd>
<dt>LESS_LINE_NUMBERS (line_numbers)</dt>
<dd>Outputs filename and line numbers. Can be either &#8216;comments&#8217;, which
will output the debug info within comments, &#8216;mediaquery&#8217; that will
output the information within a fake media query which is compatible
with the SASSPath to the less executable used to compile source files.</dd>
<dt>LESS_RUN_IN_DEBUG (run_in_debug)</dt>
<dd>By default, the filter will compile in debug mode. Since the less
compiler is written in Javascript and capable of running in the
browser, you can set this to <tt class="docutils literal"><span class="pre">False</span></tt> to have your original less
source files served (see below).</dd>
<dt>LESS_PATHS (paths)</dt>
<dd>Add include paths for less command line.
It should be a list of paths relatives to Environment.directory or absolute paths.
Order matters as less will pick the first file found in path order.</dd>
</dl>
<div class="admonition-compiling-less-in-the-browser admonition">
<p class="first admonition-title">Compiling less in the browser</p>
<p>less is an interesting case because it is written in Javascript and
capable of running in the browser. While for performance reason you
should prebuild your stylesheets in production, while developing you
may be interested in serving the original less files to the client,
and have less compile them in the browser.</p>
<p>To do so, you first need to make sure the less filter is not applied
when <tt class="xref py py-attr docutils literal"><span class="pre">Environment.debug</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt>. You can do so via an
option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;less_run_in_debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<p>Second, in order for the less to identify the  less source files as
needing to be compiled, they have to be referenced with a
<tt class="docutils literal"><span class="pre">rel=&quot;stylesheet/less&quot;</span></tt> attribute. One way to do this is to use the
<tt class="xref py py-attr docutils literal"><span class="pre">Bundle.extra</span></tt> dictionary, which works well with the template
tags that webassets provides for some template languages:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">less_bundle</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span>
    <span class="s">&#39;**/*.less&#39;</span><span class="p">,</span>
    <span class="n">filters</span><span class="o">=</span><span class="s">&#39;less&#39;</span><span class="p">,</span>
    <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;rel&#39;</span><span class="p">:</span> <span class="s">&#39;stylesheet/less&#39;</span> <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span> <span class="k">else</span> <span class="s">&#39;stylesheet&#39;</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then, for example in a Jinja2 template, you would write:</p>
<div class="highlight-python"><div class="highlight"><pre>{% assets less_bundle %}
    &lt;link rel=&quot;{{ EXTRA.rel }}&quot; type=&quot;text/css&quot; href=&quot;{{ ASSET_URL }}&quot;&gt;
{% endassets %}
</pre></div>
</div>
<p>With this, the <tt class="docutils literal"><span class="pre">&lt;link&gt;</span></tt> tag will sport the correct <tt class="docutils literal"><span class="pre">rel</span></tt> value both
in development and in production.</p>
<p>Finally, you need to include the less compiler:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
    <span class="n">js_bundle</span><span class="o">.</span><span class="n">contents</span> <span class="o">+=</span> <span class="s">&#39;http://lesscss.googlecode.com/files/less-1.3.0.min.js&#39;</span>
</pre></div>
</div>
</div>
</dd></dl>

</div>
<div class="section" id="less-ruby">
<h5><tt class="docutils literal"><span class="pre">less_ruby</span></tt><a class="headerlink" href="#less-ruby" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.less_ruby.Less">
<em class="property">class </em><tt class="descclassname">webassets.filter.less_ruby.</tt><tt class="descname">Less</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.less_ruby.Less" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://lesscss.org/">Less</a> markup to real CSS.</p>
<p>This uses the old Ruby implementation available in the 1.x versions of the
less gem. All 2.x versions of the gem are wrappers around the newer
NodeJS/Javascript implementation, which you are generally encouraged to
use, and which is available in webassets via the <a class="reference internal" href="index.html#webassets.filter.less.Less" title="webassets.filter.less.Less"><tt class="xref py py-class docutils literal"><span class="pre">Less</span></tt></a>
filter.</p>
<p>This filter for the Ruby version is being kept around for
backwards-compatibility.</p>
<p><em>Supported configuration options</em>:</p>
<dl class="docutils">
<dt>LESS_RUBY_PATH (binary)</dt>
<dd>Path to the less executable used to compile source files. By default,
the filter will attempt to run <tt class="docutils literal"><span class="pre">lessc</span></tt> via the system path.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="sass">
<span id="filters-sass"></span><h5><tt class="docutils literal"><span class="pre">sass</span></tt><a class="headerlink" href="#sass" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.sass.Sass">
<em class="property">class </em><tt class="descclassname">webassets.filter.sass.</tt><tt class="descname">Sass</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.sass.Sass" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://sass-lang.com/">Sass</a> markup to real CSS.</p>
<p>Requires the Sass executable to be available externally. To install
it, you might be able to do:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo gem install sass
</pre></div>
</div>
<p>By default, this works as an &#8220;input filter&#8221;, meaning <tt class="docutils literal"><span class="pre">sass</span></tt> is
called for each source file in the bundle. This is because the
path of the source file is required so that &#64;import directives
within the Sass file can be correctly resolved.</p>
<p>However, it is possible to use this filter as an &#8220;output filter&#8221;,
meaning the source files will first be concatenated, and then the
Sass filter is applied in one go. This can provide a speedup for
bigger projects.</p>
<p>To use Sass as an output filter:</p>
<div class="highlight-python"><div class="highlight"><pre>from webassets.filter import get_filter
sass = get_filter(&#39;sass&#39;, as_output=True)
Bundle(...., filters=(sass,))
</pre></div>
</div>
<p>However, if you want to use the output filter mode and still also
use the &#64;import directive in your Sass files, you will need to
pass along the <tt class="docutils literal"><span class="pre">load_paths</span></tt> argument, which specifies the path
to which the imports are relative to (this is implemented by
changing the working directory before calling the <tt class="docutils literal"><span class="pre">sass</span></tt>
executable):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sass</span> <span class="o">=</span> <span class="n">get_filter</span><span class="p">(</span><span class="s">&#39;sass&#39;</span><span class="p">,</span> <span class="n">as_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">load_paths</span><span class="o">=</span><span class="s">&#39;/tmp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With <tt class="docutils literal"><span class="pre">as_output=True</span></tt>, the resulting concatenation of the Sass
files is piped to Sass via stdin (<tt class="docutils literal"><span class="pre">cat</span> <span class="pre">...</span> <span class="pre">|</span> <span class="pre">sass</span> <span class="pre">--stdin</span> <span class="pre">...</span></tt>)
and may cause applications to not compile if import statements are
given as relative paths.</p>
<p>For example, if a file <tt class="docutils literal"><span class="pre">foo/bar/baz.scss</span></tt> imports file
<tt class="docutils literal"><span class="pre">foo/bar/bat.scss</span></tt> (same directory) and the import is defined as
<tt class="docutils literal"><span class="pre">&#64;import</span> <span class="pre">&quot;bat&quot;;</span></tt> then Sass will fail compiling because Sass
has naturally no information on where <tt class="docutils literal"><span class="pre">baz.scss</span></tt> is located on
disk (since the data was passed via stdin) in order for Sass to
resolve the location of <tt class="docutils literal"><span class="pre">bat.scss</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>Traceback (most recent call last):
...
webassets.exceptions.FilterError: sass: subprocess had error: stderr=(sass):1: File to import not found or unreadable: bat. (Sass::SyntaxError)
       Load paths:
         /path/to/project-foo
        on line 1 of standard input
  Use --trace for backtrace.
, stdout=, returncode=65
</pre></div>
</div>
<p>To overcome this issue, the full path must be provided in the
import statement, <tt class="docutils literal"><span class="pre">&#64;import</span> <span class="pre">&quot;foo/bar/bat&quot;</span></tt>, then webassets
will pass the <tt class="docutils literal"><span class="pre">load_paths</span></tt> argument (e.g.,
<tt class="docutils literal"><span class="pre">/path/to/project-foo</span></tt>) to Sass via its <tt class="docutils literal"><span class="pre">-I</span></tt> flags so Sass can
resolve the full path to the file to be imported:
<tt class="docutils literal"><span class="pre">/path/to/project-foo/foo/bar/bat</span></tt></p>
<p>Support configuration options:</p>
<dl class="docutils">
<dt>SASS_BIN</dt>
<dd>The path to the Sass binary. If not set, the filter will
try to run <tt class="docutils literal"><span class="pre">sass</span></tt> as if it&#8217;s in the system path.</dd>
<dt>SASS_STYLE</dt>
<dd>The style for the output CSS. Can be one of <tt class="docutils literal"><span class="pre">expanded</span></tt> (default),
<tt class="docutils literal"><span class="pre">nested</span></tt>, <tt class="docutils literal"><span class="pre">compact</span></tt> or <tt class="docutils literal"><span class="pre">compressed</span></tt>.</dd>
<dt>SASS_DEBUG_INFO</dt>
<dd><p class="first">If set to <tt class="docutils literal"><span class="pre">True</span></tt>, will cause Sass to output debug information
to be used by the FireSass Firebug plugin. Corresponds to the
<tt class="docutils literal"><span class="pre">--debug-info</span></tt> command line option of Sass.</p>
<p>Note that for this, Sass uses <tt class="docutils literal"><span class="pre">&#64;media</span></tt> rules, which are
not removed by a CSS compressor. You will thus want to make
sure that this option is disabled in production.</p>
<p class="last">By default, the value of this option will depend on the
environment <tt class="docutils literal"><span class="pre">DEBUG</span></tt> setting.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="scss">
<h5><tt class="docutils literal"><span class="pre">scss</span></tt><a class="headerlink" href="#scss" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.sass.SCSS">
<em class="property">class </em><tt class="descclassname">webassets.filter.sass.</tt><tt class="descname">SCSS</tt><big>(</big><em>*a</em>, <em>**kw</em><big>)</big><a class="headerlink" href="#webassets.filter.sass.SCSS" title="Permalink to this definition">¶</a></dt>
<dd><p>Version of the <tt class="docutils literal"><span class="pre">sass</span></tt> filter that uses the SCSS syntax.</p>
</dd></dl>

</div>
<div class="section" id="compass">
<h5><tt class="docutils literal"><span class="pre">compass</span></tt><a class="headerlink" href="#compass" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.compass.Compass">
<em class="property">class </em><tt class="descclassname">webassets.filter.compass.</tt><tt class="descname">Compass</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.compass.Compass" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://compass-style.org/">Compass</a> .sass files to
CSS.</p>
<p>Requires at least version 0.10.</p>
<p>To compile a standard Compass project, you only need to have
to compile your main <tt class="docutils literal"><span class="pre">screen.sass</span></tt>, <tt class="docutils literal"><span class="pre">print.sass</span></tt> and <tt class="docutils literal"><span class="pre">ie.sass</span></tt>
files. All the partials that you include will be handled by Compass.</p>
<p>If you want to combine the filter with other CSS filters, make
sure this one runs first.</p>
<p>Supported configuration options:</p>
<dl class="docutils">
<dt>COMPASS_BIN</dt>
<dd>The path to the Compass binary. If not set, the filter will
try to run <tt class="docutils literal"><span class="pre">compass</span></tt> as if it&#8217;s in the system path.</dd>
<dt>COMPASS_PLUGINS</dt>
<dd>Compass plugins to use. This is equivalent to the <tt class="docutils literal"><span class="pre">--require</span></tt>
command line option of the Compass. and expects a Python list
object of Ruby libraries to load.</dd>
<dt>COMPASS_CONFIG</dt>
<dd><p class="first">An optional dictionary of Compass <a class="reference external" href="http://compass-style.org/help/tutorials/configuration-reference/">configuration options</a>.
The values are emitted as strings, and paths are relative to the
Environment&#8217;s <tt class="docutils literal"><span class="pre">directory</span></tt> by default; include a <tt class="docutils literal"><span class="pre">project_path</span></tt>
entry to override this.</p>
<p class="last">The <tt class="docutils literal"><span class="pre">sourcemap</span></tt> option has a caveat. A file called _.css.map is
created by Compass in the tempdir (where _.scss is the original asset),
which is then moved into the output_path directory. Since the tempdir
is created one level down from the output path, the relative links in
the sourcemap should correctly map. This file, however, will not be
versioned, and thus this option should ideally only be used locally
for development and not in production with a caching service as the
_.css.map file will not be invalidated.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="pyscss">
<h5><tt class="docutils literal"><span class="pre">pyscss</span></tt><a class="headerlink" href="#pyscss" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.pyscss.PyScss">
<em class="property">class </em><tt class="descclassname">webassets.filter.pyscss.</tt><tt class="descname">PyScss</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.pyscss.PyScss" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://sass-lang.com/">Scss</a> markup to real CSS.</p>
<p>This uses <a class="reference external" href="https://github.com/Kronuz/pyScss">PyScss</a>, a native
Python implementation of the Scss language. The PyScss module needs
to be installed. It&#8217;s API has been changing; currently, version
1.1.5 is known to be supported.</p>
<p>This is an alternative to using the <tt class="docutils literal"><span class="pre">sass</span></tt> or <tt class="docutils literal"><span class="pre">scss</span></tt> filters,
which are based on the original, external tools.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Sass syntax is not supported by PyScss. You need to use
the <tt class="docutils literal"><span class="pre">sass</span></tt> filter based on the original Ruby implementation
instead.</p>
</div>
<p><em>Supported configuration options:</em></p>
<dl class="docutils">
<dt>PYSCSS_DEBUG_INFO (debug_info)</dt>
<dd><p class="first">Include debug information in the output for use with FireSass.</p>
<p class="last">If unset, the default value will depend on your
<tt class="xref py py-attr docutils literal"><span class="pre">Environment.debug</span></tt> setting.</p>
</dd>
<dt>PYSCSS_LOAD_PATHS (load_paths)</dt>
<dd><p class="first">Additional load paths that PyScss should use.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The filter currently does not automatically use
<tt class="xref py py-attr docutils literal"><span class="pre">Environment.load_path</span></tt> for this.</p>
</div>
</dd>
<dt>PYSCSS_STATIC_ROOT (static_root)</dt>
<dd>The directory PyScss should look in when searching for include
files that you have referenced. Will use
<tt class="xref py py-attr docutils literal"><span class="pre">Environment.directory</span></tt> by default.</dd>
<dt>PYSCSS_STATIC_URL (static_url)</dt>
<dd>The url PyScss should use when generating urls to files in
<tt class="docutils literal"><span class="pre">PYSCSS_STATIC_ROOT</span></tt>. Will use <tt class="xref py py-attr docutils literal"><span class="pre">Environment.url</span></tt> by
default.</dd>
<dt>PYSCSS_ASSETS_ROOT (assets_root)</dt>
<dd>The directory PyScss should look in when searching for things
like images that you have referenced. Will use
<tt class="docutils literal"><span class="pre">PYSCSS_STATIC_ROOT</span></tt> by default.</dd>
<dt>PYSCSS_ASSETS_URL (assets_url)</dt>
<dd>The url PyScss should use when generating urls to files in
<tt class="docutils literal"><span class="pre">PYSCSS_ASSETS_ROOT</span></tt>. Will use <tt class="docutils literal"><span class="pre">PYSCSS_STATIC_URL</span></tt> by
default.</dd>
<dt>PYSCSS_STYLE (style)</dt>
<dd>The style of the output CSS. Can be one of <tt class="docutils literal"><span class="pre">nested`</span> <span class="pre">(default),</span>
<span class="pre">``compact</span></tt>, <tt class="docutils literal"><span class="pre">compressed</span></tt>, or <tt class="docutils literal"><span class="pre">expanded</span></tt>.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="stylus">
<h5><tt class="docutils literal"><span class="pre">stylus</span></tt><a class="headerlink" href="#stylus" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.stylus.Stylus">
<em class="property">class </em><tt class="descclassname">webassets.filter.stylus.</tt><tt class="descname">Stylus</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.stylus.Stylus" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://learnboost.github.com/stylus/">Stylus</a> markup to CSS.</p>
<p>Requires the Stylus executable to be available externally. You can install
it using the <a class="reference external" href="http://npmjs.org/">Node Package Manager</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ npm install -g stylus
</pre></div>
</div>
<p>Supported configuration options:</p>
<dl class="docutils">
<dt>STYLUS_BIN</dt>
<dd>The path to the Stylus binary. If not set, assumes <tt class="docutils literal"><span class="pre">stylus</span></tt> is in the
system path.</dd>
<dt>STYLUS_PLUGINS</dt>
<dd>A Python list of Stylus plugins to use. Each plugin will be included
via Stylus&#8217;s command-line <tt class="docutils literal"><span class="pre">--use</span></tt> argument.</dd>
<dt>STYLUS_EXTRA_ARGS</dt>
<dd>A Python list of any additional command-line arguments.</dd>
<dt>STYLUS_EXTRA_PATHS</dt>
<dd>A Python list of any additional import paths.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="coffeescript">
<h5><tt class="docutils literal"><span class="pre">coffeescript</span></tt><a class="headerlink" href="#coffeescript" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.coffeescript.CoffeeScript">
<em class="property">class </em><tt class="descclassname">webassets.filter.coffeescript.</tt><tt class="descname">CoffeeScript</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.coffeescript.CoffeeScript" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <a class="reference external" href="http://jashkenas.github.com/coffee-script/">CoffeeScript</a>
to real JavaScript.</p>
<p>If you want to combine it with other JavaScript filters, make sure this
one runs first.</p>
<p>Supported configuration options:</p>
<dl class="docutils">
<dt>COFFEE_NO_BARE</dt>
<dd>Set to <tt class="docutils literal"><span class="pre">True</span></tt> to compile with the top-level function
wrapper (suppresses the &#8211;bare option to <tt class="docutils literal"><span class="pre">coffee</span></tt>, which
is used by default).</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="requirejs">
<h5><tt class="docutils literal"><span class="pre">requirejs</span></tt><a class="headerlink" href="#requirejs" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.requirejs.RequireJSFilter">
<em class="property">class </em><tt class="descclassname">webassets.filter.requirejs.</tt><tt class="descname">RequireJSFilter</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.requirejs.RequireJSFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimizes AMD-style modularized JavaScript into a single asset
using <a class="reference external" href="http://requirejs.org/">RequireJS</a>.</p>
<p>This depends on the NodeJS executable <tt class="docutils literal"><span class="pre">r.js</span></tt>; install via npm:</p>
<div class="highlight-python"><div class="highlight"><pre>$ npm install -g requirejs
</pre></div>
</div>
<p>Details on configuring r.js can be found at
<a class="reference external" href="http://requirejs.org/docs/optimization.html#basics">http://requirejs.org/docs/optimization.html#basics</a>.</p>
<p><em>Supported configuration options</em>:</p>
<p>executable (env: REQUIREJS_BIN)</p>
<blockquote>
<div>Path to the RequireJS executable used to compile source
files. By default, the filter will attempt to run <tt class="docutils literal"><span class="pre">r.js</span></tt> via
the system path.</div></blockquote>
<p>config (env: REQUIREJS_CONFIG)</p>
<blockquote>
<div>The RequireJS options file. The path is taken to be relative
to the Enviroment.directory (by defualt is /static).</div></blockquote>
<p>baseUrl (env: REQUIREJS_BASEURL)</p>
<blockquote>
<div>The <tt class="docutils literal"><span class="pre">baseUrl</span></tt> parameter to r.js; this is the directory that
AMD modules will be loaded from. The path is taken relative
to the Enviroment.directory (by defualt is /static).
Typically, this is used in
conjunction with a <tt class="docutils literal"><span class="pre">baseUrl</span></tt> parameter set in the <cite>config</cite>
options file, where the baseUrl value in the config file is
used for client-side processing, and the value here is for
server-side processing.</div></blockquote>
<p>optimize (env: REQUIREJS_OPTIMIZE)</p>
<blockquote>
<div>The <tt class="docutils literal"><span class="pre">optimize</span></tt> parameter to r.js; controls whether or not
r.js minifies the output. By default, it is enabled, but can
be set to <tt class="docutils literal"><span class="pre">none</span></tt> to disable minification. The typical
scenario to disable minification is if you do some additional
processing of the JavaScript (such as removing
<tt class="docutils literal"><span class="pre">console.log()</span></tt> lines) before minification by the <tt class="docutils literal"><span class="pre">rjsmin</span></tt>
filter.</div></blockquote>
<p>extras (env: REQUIREJS_EXTRAS)</p>
<blockquote>
<div>Any other command-line parameters to be passed to r.js. The
string is expected to be in unix shell-style format, meaning
that quotes can be used to escape spaces, etc.</div></blockquote>
<p>run_in_debug (env: REQUIREJS_RUN_IN_DEBUG)</p>
<blockquote>
<div>Boolean which controls if the AMD requirejs is evaluated
client-side or server-side in debug mode. If set to a truthy
value (e.g. &#8216;yes&#8217;), then server-side compilation is done, even
in debug mode. The default is false.</div></blockquote>
<div class="admonition-client-side-amd-evaluation admonition">
<p class="first admonition-title">Client-side AMD evaluation</p>
<p>AMD modules can be loaded client-side without any processing
done on the server-side. The advantage to this is that
debugging is easier because the browser can tell you which
source file is responsible for a particular line of code. The
disadvantage is that it means that each loaded AMD module is a
separate HTTP request. When running client-side, the client
needs access to the <cite>config</cite> &#8211; for this reason, when running
in client-side mode, the webassets environment must be
adjusted to include a reference to this
configuration. Typically, this is done by adding something
similar to the following during webassets initialization:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;requirejs_run_in_debug&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span>
    <span class="n">env</span><span class="p">[</span><span class="s">&#39;requirejs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contents</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;requirejs-browser-config.js&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<p>And the file <tt class="docutils literal"><span class="pre">requirejs-browser-config.js</span></tt> will look
something like:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">require</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span><span class="nx">baseUrl</span><span class="o">:</span> <span class="s1">&#39;/static/script/&#39;</span><span class="p">});</span>
</pre></div>
</div>
<p class="last">Set the <cite>run_in_debug</cite> option to control client-side or
server-side compilation in debug.</p>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="javascript-templates">
<h4>JavaScript templates<a class="headerlink" href="#javascript-templates" title="Permalink to this headline">¶</a></h4>
<div class="section" id="jst">
<h5><tt class="docutils literal"><span class="pre">jst</span></tt><a class="headerlink" href="#jst" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.jst.JST">
<em class="property">class </em><tt class="descclassname">webassets.filter.jst.</tt><tt class="descname">JST</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.jst.JST" title="Permalink to this definition">¶</a></dt>
<dd><p>This filter processes generic JavaScript templates. It will generate
JavaScript code that runs all files through a template compiler, and makes
the templates available as an object.</p>
<p>It was inspired by <a class="reference external" href="http://documentcloud.github.com/underscore/#template">Jammit</a>.</p>
<p>For example, if you have a file named <tt class="docutils literal"><span class="pre">license.jst</span></tt>:</p>
<div class="highlight-html"><div class="highlight"><pre>&lt;div class=&quot;drivers-license&quot;&gt;
  &lt;h2&gt;Name: &lt;%= name %&gt;&lt;/h2&gt;
  &lt;em&gt;Hometown: &lt;%= birthplace %&gt;&lt;/em&gt;
&lt;/div&gt;
</pre></div>
</div>
<p>Then, after applying this filter, you could use the template in JavaScript:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">JST</span><span class="p">.</span><span class="nx">license</span><span class="p">({</span><span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;Moe&quot;</span><span class="p">,</span> <span class="nx">birthplace</span> <span class="o">:</span> <span class="s2">&quot;Brooklyn&quot;</span><span class="p">});</span>
</pre></div>
</div>
<p>The name of each template is derived from the filename. If your JST files
are spread over different directories, the path up to the common prefix
will be included. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;templates/app1/license.jst&#39;</span><span class="p">,</span> <span class="s">&#39;templates/app2/profile.jst&#39;</span><span class="p">,</span>
       <span class="n">filters</span><span class="o">=</span><span class="s">&#39;jst&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>will make the templates available as <tt class="docutils literal"><span class="pre">app1/license</span></tt> and <tt class="docutils literal"><span class="pre">app2/profile</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The filter is &#8220;generic&#8221; in the sense that it does not actually compile
the templates, but wraps them in a JavaScript function call, and can
thus be used with any template language. webassets also has filters
for specific JavaScript template languages like
<a class="reference internal" href="index.html#webassets.filter.dust.DustJS" title="webassets.filter.dust.DustJS"><tt class="xref py py-class docutils literal"><span class="pre">DustJS</span></tt></a> or
<a class="reference internal" href="index.html#webassets.filter.handlebars.Handlebars" title="webassets.filter.handlebars.Handlebars"><tt class="xref py py-class docutils literal"><span class="pre">Handlebars</span></tt></a>, and those filters precompile
the templates on the server, which means a performance boost on the
client-side.</p>
</div>
<p>Unless configured otherwise, the filter will use the same micro-templating
language that <a class="reference external" href="http://documentcloud.github.com/underscore/#template">Jammit</a> uses, which is turn is the same one that is
available in <a class="reference external" href="http://documentcloud.github.com/underscore/#template">underscore.js</a>. The JavaScript code necessary to compile
such templates will implicitly be included in the filter output.</p>
<p><em>Supported configuration options:</em></p>
<dl class="docutils">
<dt>JST_COMPILER (template_function)</dt>
<dd><p class="first">A string that is inserted into the generated JavaScript code in place
of the function to be called that should do the compiling. Unless you
specify a custom function here, the filter will include the JavaScript
code of it&#8217;s own micro-templating language, which is the one used by
<a class="reference external" href="http://documentcloud.github.com/underscore/#template">underscore.js</a> and <a class="reference external" href="http://documentcloud.github.com/underscore/#template">Jammit</a>.</p>
<p>If you assign a custom function, it is your responsibility to ensure
that it is available in your final JavaScript.</p>
<p class="last">If this option is set to <tt class="docutils literal"><span class="pre">False</span></tt>, then the template strings will be
output directly, which is to say, <tt class="docutils literal"><span class="pre">JST.foo</span></tt> will be a string holding
the raw source of the <tt class="docutils literal"><span class="pre">foo</span></tt> template.</p>
</dd>
<dt>JST_NAMESPACE (namespace)</dt>
<dd>How the templates should be made available in JavaScript. Defaults to
<tt class="docutils literal"><span class="pre">window.JST</span></tt>, which gives you a global <tt class="docutils literal"><span class="pre">JST</span></tt> object.</dd>
<dt>JST_BARE (bare)</dt>
<dd><p class="first">Whether everything generated by this filter should be wrapped inside
an anonymous function. Default to <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you enable this option, the namespace must be a property
of the <tt class="docutils literal"><span class="pre">window</span></tt> object, or you won&#8217;t be able to access the
templates.</p>
</div>
</dd>
<dt>JST_DIR_SEPARATOR (separator)</dt>
<dd>The separator character to use for templates within directories.
Defaults to &#8216;/&#8217;</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="handlebars">
<h5><tt class="docutils literal"><span class="pre">handlebars</span></tt><a class="headerlink" href="#handlebars" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.handlebars.Handlebars">
<em class="property">class </em><tt class="descclassname">webassets.filter.handlebars.</tt><tt class="descname">Handlebars</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.handlebars.Handlebars" title="Permalink to this definition">¶</a></dt>
<dd><p>Compile <a class="reference external" href="http://handlebarsjs.com/">Handlebars</a> templates.</p>
<p>This filter assumes that the <tt class="docutils literal"><span class="pre">handlebars</span></tt> executable is in the path.
Otherwise, you may define a <tt class="docutils literal"><span class="pre">HANDLEBARS_BIN</span></tt> setting.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use this filter if you want to precompile Handlebars templates.
If compiling them in the browser is acceptable, you may use the
JST filter, which needs no external dependency.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Currently, this filter is not compatible with input filters. Any
filters that would run during the input-stage will simply be
ignored. Input filters tend to be other compiler-style filters,
so this is unlikely to be an issue.</p>
</div>
</dd></dl>

</div>
<div class="section" id="dustjs">
<h5><tt class="docutils literal"><span class="pre">dustjs</span></tt><a class="headerlink" href="#dustjs" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.dust.DustJS">
<em class="property">class </em><tt class="descclassname">webassets.filter.dust.</tt><tt class="descname">DustJS</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.dust.DustJS" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="http://akdubya.github.com/dustjs/">DustJS</a> templates compilation
filter.</p>
<p>Takes a directory full <tt class="docutils literal"><span class="pre">.dust</span></tt> files and creates a single Javascript
object that registers to the <tt class="docutils literal"><span class="pre">dust</span></tt> global when loaded in the browser:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;js/templates/&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s">&#39;dustjs&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that in the above example, a directory is given as the bundle
contents, which is unusual, but required by this filter.</p>
<p>This uses the <tt class="docutils literal"><span class="pre">dusty</span></tt> compiler, which is a separate project from the
DustJS implementation. To install <tt class="docutils literal"><span class="pre">dusty</span></tt> together with LinkedIn&#8217;s
version of <tt class="docutils literal"><span class="pre">dustjs</span></tt> (the original does not support NodeJS &gt; 0.4):</p>
<div class="highlight-python"><div class="highlight"><pre>npm install dusty
rm -rf node_modules/dusty/node_modules/dust
git clone https://github.com/linkedin/dustjs node_modules/dust
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To generate the DustJS client-side Javascript, you can then do:</p>
<div class="last highlight-python"><div class="highlight"><pre>cd node_modules/dust
make dust
cp dist/dist-core...js your/static/assets/path
</pre></div>
</div>
</div>
<p>For compilation, set the <tt class="docutils literal"><span class="pre">DUSTY_PATH=.../node_modules/dusty/bin/dusty</span></tt>.
Optionally, set <tt class="docutils literal"><span class="pre">NODE_PATH=.../node</span></tt>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="other">
<h4>Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h4>
<div class="section" id="cssrewrite">
<span id="filters-cssrewrite"></span><h5><tt class="docutils literal"><span class="pre">cssrewrite</span></tt><a class="headerlink" href="#cssrewrite" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.cssrewrite.CSSRewrite">
<em class="property">class </em><tt class="descclassname">webassets.filter.cssrewrite.</tt><tt class="descname">CSSRewrite</tt><big>(</big><em>replace=False</em><big>)</big><a class="headerlink" href="#webassets.filter.cssrewrite.CSSRewrite" title="Permalink to this definition">¶</a></dt>
<dd><p>Source filter that rewrites relative urls in CSS files.</p>
<p>CSS allows you to specify urls relative to the location of the CSS file.
However, you may want to store your compressed assets in a different place
than source files, or merge source files from different locations. This
would then break these relative CSS references, since the base URL changed.</p>
<p>This filter transparently rewrites CSS <tt class="docutils literal"><span class="pre">url()</span></tt> instructions in the source
files to make them relative to the location of the output path. It works as
a <em>source filter</em>, i.e. it is applied individually to each source file
before they are merged.</p>
<p>No configuration is necessary.</p>
<p>The filter also supports a manual mode:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">get_filter</span><span class="p">(</span><span class="s">&#39;cssrewrite&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;old_directory&#39;</span><span class="p">:</span><span class="s">&#39;/custom/path/&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>This will rewrite all urls that point to files within <tt class="docutils literal"><span class="pre">old_directory</span></tt> to
use <tt class="docutils literal"><span class="pre">/custom/path</span></tt> as a prefix instead.</p>
<p>You may plug in your own replace function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">get_filter</span><span class="p">(</span><span class="s">&#39;cssrewrite&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="k">lambda</span> <span class="n">url</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;^/?images/&#39;</span><span class="p">,</span> <span class="s">&#39;/images/&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
<span class="n">get_filter</span><span class="p">(</span><span class="s">&#39;cssrewrite&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="k">lambda</span> <span class="n">url</span><span class="p">:</span> <span class="s">&#39;/images/&#39;</span><span class="o">+</span><span class="n">url</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span> <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;images/&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="datauri">
<h5><tt class="docutils literal"><span class="pre">datauri</span></tt><a class="headerlink" href="#datauri" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.datauri.CSSDataUri">
<em class="property">class </em><tt class="descclassname">webassets.filter.datauri.</tt><tt class="descname">CSSDataUri</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.datauri.CSSDataUri" title="Permalink to this definition">¶</a></dt>
<dd><p>Will replace CSS url() references to external files with internal
<a class="reference external" href="http://en.wikipedia.org/wiki/Data_URI_scheme">data: URIs</a>.</p>
<p>The external file is now included inside your CSS, which minimizes HTTP
requests.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Data Uris have <a class="reference external" href="http://stackoverflow.com/questions/5258057/images-in-css-or-html-as-data-base64">clear disadvantages</a>,
so put some thought into if and how you would like to use them. Have
a look at some <a class="reference external" href="http://www.ravelrumba.com/blog/data-uris-for-css-images-more-tests-more-questions/">performance measurements</a>.</p>
</div>
<p>The filter respects a <tt class="docutils literal"><span class="pre">DATAURI_MAX_SIZE</span></tt> option, which is the maximum
size (in bytes) of external files to include. The default limit is what
I think should be a reasonably conservative number, 2048 bytes.</p>
</dd></dl>

</div>
<div class="section" id="cssprefixer">
<h5><tt class="docutils literal"><span class="pre">cssprefixer</span></tt><a class="headerlink" href="#cssprefixer" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.cssprefixer.CSSPrefixer">
<em class="property">class </em><tt class="descclassname">webassets.filter.cssprefixer.</tt><tt class="descname">CSSPrefixer</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.cssprefixer.CSSPrefixer" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses <a class="reference external" href="http://github.com/myfreeweb/cssprefixer/">CSSPrefixer</a>
to add vendor prefixes to CSS files.</p>
</dd></dl>

</div>
<div class="section" id="autoprefixer">
<h5><tt class="docutils literal"><span class="pre">autoprefixer</span></tt><a class="headerlink" href="#autoprefixer" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.autoprefixer.AutoprefixerFilter">
<em class="property">class </em><tt class="descclassname">webassets.filter.autoprefixer.</tt><tt class="descname">AutoprefixerFilter</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.autoprefixer.AutoprefixerFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Prefixes vendor-prefixes using <cite>autoprefixer
&lt;https://github.com/ai/autoprefixer&gt;</cite>, which uses the <cite>Can I Use?
&lt;http://www.caniuse.com&gt;</cite> database to know which prefixes need to be
inserted.</p>
<p>This depends on the <cite>autoprefixer &lt;https://github.com/ai/autoprefixer&gt;</cite>
command line tool being installed (use <tt class="docutils literal"><span class="pre">npm</span> <span class="pre">install</span> <span class="pre">autoprefixer</span></tt>).</p>
<p><em>Supported configuration options</em>:</p>
<dl class="docutils">
<dt>AUTOPREFIXER_BIN</dt>
<dd>Path to the autoprefixer executable used to compile source files. By
default, the filter will attempt to run <tt class="docutils literal"><span class="pre">autoprefixer</span></tt> via the
system path.</dd>
<dt>AUTOPREFIXER_BROWSERS</dt>
<dd><p class="first">The browser expressions to use.  This corresponds to the <tt class="docutils literal"><span class="pre">--browsers</span>
<span class="pre">&lt;value&gt;</span></tt> flag, see the <cite>&#8211;browsers documentation
&lt;https://github.com/ai/autoprefixer#browsers&gt;</cite>.  By default, this flag
won&#8217;t be passed, and autoprefixer&#8217;s default will be used.</p>
<p>Example:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">AUTOPREFIXER_BROWSERS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&gt; 1%&#39;</span><span class="p">,</span> <span class="s">&#39;last 2 versions&#39;</span><span class="p">,</span> <span class="s">&#39;firefox 24&#39;</span><span class="p">,</span> <span class="s">&#39;opera 12.1&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd>
<dt>AUTOPREFIXER_EXTRA_ARGS</dt>
<dd>Additional options may be passed to <tt class="docutils literal"><span class="pre">autoprefixer</span></tt> using this
setting, which expects a list of strings.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="jinja2">
<h5><tt class="docutils literal"><span class="pre">jinja2</span></tt><a class="headerlink" href="#jinja2" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.jinja2.Jinja2">
<em class="property">class </em><tt class="descclassname">webassets.filter.jinja2.</tt><tt class="descname">Jinja2</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.jinja2.Jinja2" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a file through the Jinja2 templating engine.</p>
<p>Requires the <tt class="docutils literal"><span class="pre">jinja2</span></tt> package (<a class="reference external" href="https://github.com/mitsuhiko/jinja2">https://github.com/mitsuhiko/jinja2</a>).</p>
<p>The Jinja2 context can be specified with the <cite>JINJA2_CONTEXT</cite> configuration
option or directly with <cite>context={...}</cite>. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;input.css&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">Jinja2</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="s">&#39;bar&#39;</span><span class="p">}))</span>
</pre></div>
</div>
<p>Additionally to enable template loading mechanics from your project you can provide
<cite>JINJA2_ENV</cite> or <cite>jinja2_env</cite> arg to make use of already created environment.</p>
</dd></dl>

</div>
<div class="section" id="spritemapper">
<h5><tt class="docutils literal"><span class="pre">spritemapper</span></tt><a class="headerlink" href="#spritemapper" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="webassets.filter.spritemapper.Spritemapper">
<em class="property">class </em><tt class="descclassname">webassets.filter.spritemapper.</tt><tt class="descname">Spritemapper</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#webassets.filter.spritemapper.Spritemapper" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate CSS spritemaps using
<a class="reference external" href="http://yostudios.github.com/Spritemapper/">Spritemapper</a>, a Python
utility that merges multiple images into one and generates CSS positioning
for the corresponding slices. Installation is easy:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install spritemapper
</pre></div>
</div>
<p>Supported configuration options:</p>
<dl class="docutils">
<dt>SPRITEMAPPER_PADDING</dt>
<dd>A tuple of integers indicating the number of pixels of padding to
place between sprites</dd>
<dt>SPRITEMAPPER_ANNEAL_STEPS</dt>
<dd>Affects the number of combinations to be attempted by the box packer
algorithm</dd>
</dl>
<p><strong>Note:</strong> Since the <tt class="docutils literal"><span class="pre">spritemapper</span></tt> command-line utility expects source
and output files to be on the filesystem, this filter interfaces directly
with library internals instead. It has been tested to work with
Spritemapper version 1.0.</p>
</dd></dl>

</div>
</div>
</div>
<span id="document-expiring"></span><div class="section" id="url-expiry-cache-busting">
<span id="expiry"></span><h3>URL Expiry (cache busting)<a class="headerlink" href="#url-expiry-cache-busting" title="Permalink to this headline">¶</a></h3>
<div class="section" id="for-beginners">
<h4>For beginners<a class="headerlink" href="#for-beginners" title="Permalink to this headline">¶</a></h4>
<p>You are using <tt class="docutils literal"><span class="pre">webassets</span></tt> because you care about the performance of your
site. For the same reason, you have configured your web server to send out
your media files with a so called <em>far future expires</em> header: Your web server
sets the <tt class="docutils literal"><span class="pre">Expires</span></tt> header to some date many years in the future. Your user&#8217;s
browser will never spend any time trying to retrieve an updated version.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Of course, the user&#8217;s browser will already use the <tt class="docutils literal"><span class="pre">Etag</span></tt> and
<tt class="docutils literal"><span class="pre">Last-Modified/If-Modified-Since</span></tt> to avoid downloading content it has
already cached, and if your web server isn&#8217;t misconfigured entirely, this
will work. The point of <em>far future expires</em> is to get rid of <strong>even</strong>
those requests which would return only a <tt class="docutils literal"><span class="pre">304</span> <span class="pre">Not</span> <span class="pre">Modified</span></tt> response.</p>
</div>
<p>What if you actually deploy an update to your site? Now you need to convince
the browser to download new versions of your assets after all, but you have
just told it not to bother to check for new versions. You work around this by
<em>modifying the URL with which the asset is included</em>. There are two distinct
ways to so:</p>
<ol class="arabic">
<li><p class="first">Append a version identifier as a querystring:</p>
<div class="highlight-python"><div class="highlight"><pre>http://www.example.org/media/print.css?acefe50
</pre></div>
</div>
</li>
<li><p class="first">Add a version identifier to the actual filename:</p>
<div class="highlight-python"><div class="highlight"><pre>http://www.example.org/media/print.acefe50.css
</pre></div>
</div>
</li>
</ol>
<p>How webassets helps you do this is explained in the sections below.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even if you are not using <em>far future expires</em> headers, you might still find
<tt class="docutils literal"><span class="pre">webassets</span></tt> expiry features useful to navigate around any funny browser
caching behaviour that might require a <tt class="docutils literal"><span class="pre">Shift</span></tt>-reload.</p>
</div>
</div>
<div class="section" id="what-is-the-version-of-a-file">
<h4>What is the version of a file<a class="headerlink" href="#what-is-the-version-of-a-file" title="Permalink to this headline">¶</a></h4>
<p>To expire an URL, it is modified with a version identifier. What is this
identifier? By default, <tt class="docutils literal"><span class="pre">webassets</span></tt> will create an MD5-hash of the file
contents, and use the first few characters as the file version. <tt class="docutils literal"><span class="pre">webassets</span></tt>
also allows you to use the <em>last modified</em> timestamp of the file. You can
configure this via the <tt class="docutils literal"><span class="pre">versions</span></tt> option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="s">&#39;hash&#39;</span>         <span class="c"># the default</span>
<span class="n">env</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="s">&#39;hash:32&#39;</span>      <span class="c"># use the full md5 hash</span>
<span class="n">env</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="s">&#39;timestamp&#39;</span>    <span class="c"># use the last modified timestamp</span>
</pre></div>
</div>
<p>It is generally recommended that you use a hash as the version, since it will
remain the same as long as the content does not change, regardless of any
filesystem metadata, which can change for any number of reasons.</p>
</div>
<div class="section" id="expire-using-a-querystring">
<h4>Expire using a querystring<a class="headerlink" href="#expire-using-a-querystring" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><span class="pre">webassets</span></tt> will automatically add the version as a querystring to the urls
it generates, by virtue of the <tt class="docutils literal"><span class="pre">url_expire</span></tt> option defaulting to <tt class="docutils literal"><span class="pre">True</span></tt>.
If you want to be explicit:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">url_expire</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>There is nothing else you need to do here. The URLs that are generated might
look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>/media/print.css?acefe50
</pre></div>
</div>
<p>However, while the default, expiring with a querystring is not be the best
option:</p>
</div>
<div class="section" id="expire-using-the-filename">
<h4>Expire using the filename<a class="headerlink" href="#expire-using-the-filename" title="Permalink to this headline">¶</a></h4>
<p>Adding the version as a querystring has two problems. First, it may not always
be a browser that implements caching through which we need to bust. It is said
that certain (possibly older) proxies do ignore the querystring with respect
to their caching behavior.</p>
<p>Second, in certain more complex deployment scenarios, where you have multiple
frontend and/or multiple backend servers, an upgrade is anything but
instantaneous. You need to be able to serve both the old and the new version
of your assets at the same time. See for example how this affects you <a class="reference external" href="http://bjk5.com/post/4918954974/js-css-packaging-to-minimize-requests-and-randomly-evil">when
using Google App Engine</a>.</p>
<p>To expire using the filename, you add a <tt class="docutils literal"><span class="pre">%(version)s</span></tt> placeholder to your
bundle output target:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">bundle</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;screen.</span><span class="si">%(version)s</span><span class="s">.css&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The URLs that are generated might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>/media/screen.acefe50.css
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="docutils literal"><span class="pre">webassets</span></tt> will use this modified filename for the actual output files
it writes to disk, as opposed to just modifying the URL it generates. You
do not have to configure your web server to do any rewriting.</p>
</div>
</div>
<div class="section" id="about-manifests">
<h4>About manifests<a class="headerlink" href="#about-manifests" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is mostly an advanced feature, and you might not have to bother with
it at all.</p>
</div>
<p><tt class="docutils literal"><span class="pre">webassets</span></tt> supports Environment-wide <em>manifests</em>. A manifest remembers the
current version of every bundle. What is this good for?</p>
<ol class="arabic">
<li><p class="first">Speed. Calculating a hash can be expensive. Even if you are using
timestamp-based versions, that still means a stat-request to your disk.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that even without a manifest, <tt class="docutils literal"><span class="pre">webassets</span></tt> will cache the version
in memory. It will only need to be calculated once per process. However,
if you have <em>many</em> bundles, and a very busy site, a manifest will allow
you to both skip calculating the version (e.g. creating a hash), as well
as read the versions of all bundles into memory at once.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are using automatic building, all of this is mostly not true. In
order to determine whether a rebuild is required, <tt class="docutils literal"><span class="pre">webassets</span></tt> will need
to check the timestamps of all files involved in any case. It goes
without saying that using automatic building on a production site is a
convenience feature for small sites, and at odds with counting paper
clips in the form of filesystem <tt class="docutils literal"><span class="pre">stat</span></tt> calls.</p>
</div>
</li>
<li><p class="first">Making it possible to know the version in the first place.</p>
<p>Depending on your configuration and deployment, consider that it might not
actually be possible for <tt class="docutils literal"><span class="pre">webassets</span></tt> to know what the version is.</p>
<p>If you are using a hash-based version, and your bundle&#8217;s output target has
a placeholder, there is no way to know what the version is, <em>unless</em> is
has been written to a manifest during the build process.</p>
<p>The timestamp-based versioning mechanism can actually look at the source
files to determine the version. But, in more complex deployments, the source
files might not actually be available to read - they might be on a
completely different server altogether.</p>
<p>A manifest allows version information to be persisted.</p>
</li>
</ol>
<p>In practice, by default the version information will be written to the cache.
You can explicitly request this behaviour be setting the <tt class="docutils literal"><span class="pre">manifest</span></tt> option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">manifest</span> <span class="o">=</span> <span class="s">&#39;cache&#39;</span>
</pre></div>
</div>
<p>In a simple setup, where you are separately building on your local machine
during development, and building on the web server for production (maybe via
the automatic building feature, enabled by default), this is exactly would
you want. Don&#8217;t worry about it.</p>
<p>There is a specific deployment scenario where you want to prebuild your bundles
locally, and for either of the two reasons above want to include  the version
data pre-made when you deploy your app to the web server. In such a case, it
is not helpful to have the versions stored in the cache. Instead, <tt class="docutils literal"><span class="pre">webassets</span></tt>
provides a manifest type that writes all information to a single file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">manifest</span> <span class="o">=</span> <span class="s">&#39;file&#39;</span>
<span class="n">env</span><span class="o">.</span><span class="n">manifest</span> <span class="o">=</span> <span class="s">&#39;file:/tmp/manifest.to-be-deployed&#39;</span>  <span class="c"># explict filename</span>
</pre></div>
</div>
<p>You can then just copy this one file to the web server, and <tt class="docutils literal"><span class="pre">webassets</span></tt>
will know all about the versions without having to consult the media files.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The file is a pickled dict.</p>
</div>
</div>
</div>
<span id="document-custom_filters"></span><div class="section" id="creating-custom-filters">
<span id="custom-filters"></span><h3>Creating custom filters<a class="headerlink" href="#creating-custom-filters" title="Permalink to this headline">¶</a></h3>
<p>Creating custom filters can be easy, or very easy.</p>
<p>Before we get to that though, it is first necessary to understand that
there are two types of filters: <em>input filters</em> and <em>output filters</em>.
Output filters are applied after the complete content after all a bundle&#8217;s
contents have been merged together. Input filters, on the other hand, are
applied to each source file after it is read from the disk. In the case
of nested bundles, input filters will be passed down, with the input filters
of a parent bundle are applied before the output filter of a child bundle:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">child_bundle</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;file.css&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s">&#39;yui_css&#39;</span><span class="p">)</span>
<span class="n">Bundle</span><span class="p">(</span><span class="n">child_bundle</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s">&#39;cssrewrite&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, because cssrewrite acts as an input filter, what will
essentially happen is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">yui_css</span><span class="p">(</span><span class="n">cssrewrite</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">css</span><span class="p">))</span>
</pre></div>
</div>
<p>To be even more specific, since a single filter can act as both an input
and an output filter, the call chain will actually look something like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cssrewrite</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">yui_css</span><span class="o">.</span><span class="n">output</span><span class="p">((</span><span class="n">cssrewrite</span><span class="o">.</span><span class="n">input</span><span class="p">((</span><span class="n">yui_css</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">css</span><span class="p">)))))</span>
</pre></div>
</div>
<p>The usual reason to use an input filter is that the filter&#8217;s
transformation depends on the source file&#8217;s filename. For example,
the <a class="reference internal" href="index.html#filters-cssrewrite"><em>cssrewrite</em></a> filter needs to know the
location of the source file relative to the final output file, so it
can properly update relative references. Another example
are CSS converters like <a class="reference internal" href="index.html#filters-less"><em>less</em></a>, which support
include mechanisms that work relative to the input filename.</p>
<p>With that in mind...</p>
<div class="section" id="the-very-easy-way">
<h4>The very easy way<a class="headerlink" href="#the-very-easy-way" title="Permalink to this headline">¶</a></h4>
<p>In the simplest case, a filter is simply a function what takes two
arguments, an input stream and an output stream.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">noop</span><span class="p">(</span><span class="n">_in</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_in</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>That&#8217;s it! You can use this filter when defining your bundles:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">bundle</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;input.js&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">(</span><span class="n">noop</span><span class="p">,))</span>
</pre></div>
</div>
<p>If you are using Jinja2, you can also specify the callable inline,
provided that it is available in the context:</p>
<div class="highlight-django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">filters</span><span class="o">=(</span><span class="nv">noop</span><span class="o">,</span> <span class="s1">&#39;jsmin&#39;</span><span class="o">)</span> <span class="p">...</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>It even works when using Django templates, although here, you are
of course more limited in terms of syntax; if you want to use multiple
filters, you need to combine them:</p>
<div class="highlight-django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">filters</span><span class="o">=</span><span class="nv">my_filters</span> <span class="p">...</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>Just make sure that the context variable <tt class="docutils literal"><span class="pre">my_filters</span></tt> is set to
your function.</p>
<p>Note that you currently cannot write input filters in this way. Callables
always act as output filters.</p>
</div>
<div class="section" id="the-easy-way">
<h4>The easy way<a class="headerlink" href="#the-easy-way" title="Permalink to this headline">¶</a></h4>
<p>This works by subclassing <tt class="docutils literal"><span class="pre">webassets.filter.Filter</span></tt>. In doing so, you
need to write a bit more code, but you&#8217;ll be able to enjoy a few perks.</p>
<p>The <tt class="docutils literal"><span class="pre">noop</span></tt> filter from the previous example, written as a class, would
look something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets.filter</span> <span class="kn">import</span> <span class="n">Filter</span>

<span class="k">class</span> <span class="nc">NoopFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;noop&#39;</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_in</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_in</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_in</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_in</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">output</span></tt> and <tt class="docutils literal"><span class="pre">input</span></tt> methods should look familiar. They&#8217;re basically
like the callable you are already familiar with, simply pulled inside a class.</p>
<p>Class-based filters have a <tt class="docutils literal"><span class="pre">name</span></tt> attribute, which you need to set if you
want to register your filter globally.</p>
<p>The <tt class="docutils literal"><span class="pre">input</span></tt> method will be called for every source file, the <tt class="docutils literal"><span class="pre">output</span></tt>
method will be applied once after a bundle&#8217;s contents have been concated.</p>
<p>Among the <tt class="docutils literal"><span class="pre">kwargs</span></tt> you currently receive are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">source_path</span></tt> (only for <tt class="docutils literal"><span class="pre">input()</span></tt>): The filename behind the <tt class="docutils literal"><span class="pre">in</span></tt>
stream, though note that other input filters may already have transformed
it.</li>
<li><tt class="docutils literal"><span class="pre">output_path</span></tt>: The final output path that your filters work will
ultimatily end up in.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Always make your filters accept arbitrary <tt class="docutils literal"><span class="pre">**kwargs</span></tt>. The API does allow
for additional values to be passed along in the future.</p>
</div>
<div class="section" id="registering">
<h5>Registering<a class="headerlink" href="#registering" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="docutils literal"><span class="pre">name</span></tt> wouldn&#8217;t make much sense, if it couldn&#8217;t be used to reference
the filter. First, you need to register the class with the system though:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets.filter</span> <span class="kn">import</span> <span class="n">register_filter</span>
<span class="n">register_filter</span><span class="p">(</span><span class="n">NoopFilter</span><span class="p">)</span>
</pre></div>
</div>
<p>After that, you can use the filter like you would any of the built-in ones:</p>
<div class="highlight-django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">filters</span><span class="o">=</span><span class="s1">&#39;jsmin,noop&#39;</span> <span class="p">...</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="options">
<h5>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h5>
<p>Class-based filters are used as instances, and as such, you can easily
define a <tt class="docutils literal"><span class="pre">__init__</span></tt> method that takes arguments. However, you should
make all parameters optional, if possible, or your filter will not be
usable through a name reference.</p>
<p>There might be another thing to consider. If a filter is specified
multiple times, which sometimes can happen unsuspectingly when bundles
are nested within each other, it will only be applied a single time.
By default, all filters of the same class are considered <em>the same</em>. In
almost all cases, this will be just fine.</p>
<p>However, in case you want your filter to be applicable multiple times
with different options, you can implement the <tt class="docutils literal"><span class="pre">unique</span></tt> method and
return a hashable object that represents data unique to this instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>
    <span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>
</pre></div>
</div>
<p>This will cause two instances of this filter to be both applied, as long
as the arguments given differ. Two instances with the exact same arguments
will still be considered equal.</p>
<p>If you want each of your filter&#8217;s instances to be unique, you can simply do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="useful-helpers">
<h5>Useful helpers<a class="headerlink" href="#useful-helpers" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="docutils literal"><span class="pre">Filter</span></tt> base class provides some useful features.</p>
<div class="section" id="setup">
<h6>setup()<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h6>
<p>It&#8217;s quite common that filters have dependencies - on other Python
libraries, external tools, etc. If you want to provide your filter
regardless of whether such dependencies are matched, and fail only
if the filter is actually used, implement a <tt class="docutils literal"><span class="pre">setup()</span></tt> method on
your filter class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">foolib</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foolib</span> <span class="o">=</span> <span class="n">foolib</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_in</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foolib</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h6>options<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h6>
<p>Some filters will need to be configured. This can of course be done by
passing arguments into <tt class="docutils literal"><span class="pre">__init__</span></tt> as explained above, but it restricts
you to configuring your filters in code, and can be tedious if necessary
every single time the filter is used.</p>
<p>In some cases, it makes more sense to have an option configured globally,
like the path to an external binary. A number of the built-in filters do
this, allowing you to both specify a config variable in the webassets
<tt class="docutils literal"><span class="pre">Environment</span></tt> instance, or as an OS environment variable.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;binary&#39;</span><span class="p">:</span> <span class="s">&#39;FOO_BIN&#39;</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>If you define a an <tt class="docutils literal"><span class="pre">options</span></tt> attribute on your filter class, these
options will automatically be supported both by your filter&#8217;s __init__,
as well as via a configuration or environment variable. In the example
above, you may pass <tt class="docutils literal"><span class="pre">binary</span></tt> when creating a filter instance manually,
or define <tt class="docutils literal"><span class="pre">FOO_BIN</span></tt> in <tt class="docutils literal"><span class="pre">Environment.config</span></tt>, or as an OS environment
variable.</p>
</div>
<div class="section" id="get-config">
<h6>get_config()<a class="headerlink" href="#get-config" title="Permalink to this headline">¶</a></h6>
<p>In cases where the declarative approach of the <tt class="docutils literal"><span class="pre">options</span></tt> attribute is
not enough, you can implement custom options yourself using the
<tt class="docutils literal"><span class="pre">Filter.get_config()</span></tt> helper:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s">&#39;BINARY_PATH&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will check first the configuration, then the environment for
<tt class="docutils literal"><span class="pre">BINARY_PATH</span></tt>, and raise an exception if nothing is found.</p>
<p><tt class="docutils literal"><span class="pre">get_config()</span></tt> allows you to specify different names for the setting
and the environment variable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="n">setting</span><span class="o">=</span><span class="s">&#39;ASSETS_BINARY_PATH&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="s">&#39;BINARY_PATH&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It also supports disabling either of the two, causing only the other to
be checked for the given name:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="n">setting</span><span class="o">=</span><span class="s">&#39;ASSETS_BINARY_PATH&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you can easily make a value optional using the <tt class="docutils literal"><span class="pre">require</span></tt>
parameter. Instead of raising an exception, <tt class="docutils literal"><span class="pre">get_config()</span></tt> then returns
<tt class="docutils literal"><span class="pre">None</span></tt>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">java</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s">&#39;JAVA_BIN&#39;</span><span class="p">,</span> <span class="n">require</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;java&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="abstract-base-classes">
<h5>Abstract base classes<a class="headerlink" href="#abstract-base-classes" title="Permalink to this headline">¶</a></h5>
<p>In some cases, you might want to have a common base class for multiple
filters. You can make the base class abstract by setting <tt class="docutils literal"><span class="pre">name</span></tt> to
<tt class="docutils literal"><span class="pre">None</span></tt> explicitly. However, this is currently only relevant for the
built-in filters, since your own filters will not be registered
automatically in any case.</p>
</div>
</div>
<div class="section" id="more">
<h4>More?<a class="headerlink" href="#more" title="Permalink to this headline">¶</a></h4>
<p>You can have a look inside the <tt class="docutils literal"><span class="pre">webassets.filter</span></tt> module source
code to see a large number of example filters.</p>
</div>
</div>
<span id="document-css_compilers"></span><div class="section" id="css-compilers">
<span id="id1"></span><h3>CSS compilers<a class="headerlink" href="#css-compilers" title="Permalink to this headline">¶</a></h3>
<p>CSS compilers intend to improve upon the default CSS syntax, allow you
to write your stylesheets in a syntax more powerful, or more easily
readable. Since browsers do not understand this new syntax, the CSS compiler
needs to translate its own syntax to original CSS.</p>
<p><tt class="docutils literal"><span class="pre">webassets</span></tt> includes <a class="reference internal" href="index.html#filters-css-compilers"><em>builtin filters for a number of popular
CSS compilers</em></a>, which you can use like any other
filter. There is one problem though: While developing, you will probably
want to disable asset packaging, and instead work with the uncompressed
assets (i.e., you would disable the
<a class="reference internal" href="index.html#environment-setting-debug"><em>environment.debug</em></a> option). However,
you still need to apply the filter for your CSS compiler, since otherwise,
the Browser wouldn&#8217;t understand your stylesheets.</p>
<p>For this reason, such compiler filters run even when in debug mode:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">less</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;css/base.less&#39;</span><span class="p">,</span> <span class="s">&#39;css/forms.less&#39;</span><span class="p">,</span>
              <span class="n">filters</span><span class="o">=</span><span class="s">&#39;less,cssmin&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;screen.css&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code block behaves exactly like you would want it to: When
debugging, the less files are compiled to CSS, but the code is not minified.
In production, both filters are applied.</p>
<p>Sometimes, you need to merge together good old CSS code, and you have a
compiler that, unlike <tt class="docutils literal"><span class="pre">less</span></tt>, cannot process those. Then you can use a
child bundle:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sass</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;*.sass&#39;</span> <span class="n">filters</span><span class="o">=</span><span class="s">&#39;sass&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;gen/sass.css&#39;</span><span class="p">)</span>
<span class="n">all_css</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;css/jquery.calendar.css&#39;</span><span class="p">,</span> <span class="n">sass</span><span class="p">,</span>
                 <span class="n">filters</span><span class="o">=</span><span class="s">&#39;cssmin&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&quot;gen/all.css&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above case, the <tt class="docutils literal"><span class="pre">sass</span></tt> filter is only applied to the Sass source
files, within a nested bundle (which needs it&#8217;s own output target!). The
minification is applied to all CSS content in the outer bundle.</p>
</div>
<span id="document-loaders"></span><div class="section" id="loaders">
<span id="id1"></span><h3>Loaders<a class="headerlink" href="#loaders" title="Permalink to this headline">¶</a></h3>
<p>Using these helper classes, you can define your bundles or even
your complete environment in some external data source, rather than
constructing them in code.</p>
<dl class="class">
<dt id="webassets.loaders.YAMLLoader">
<em class="property">class </em><tt class="descclassname">webassets.loaders.</tt><tt class="descname">YAMLLoader</tt><big>(</big><em>file_or_filename</em><big>)</big><a class="headerlink" href="#webassets.loaders.YAMLLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Will load an environment or a set of bundles from
<a class="reference external" href="http://en.wikipedia.org/wiki/YAML">YAML</a> files.</p>
<dl class="method">
<dt id="webassets.loaders.YAMLLoader.load_bundles">
<tt class="descname">load_bundles</tt><big>(</big><em>environment=None</em><big>)</big><a class="headerlink" href="#webassets.loaders.YAMLLoader.load_bundles" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a list of <tt class="xref py py-class docutils literal"><span class="pre">Bundle</span></tt> instances defined in the YAML file.</p>
<p>Expects the following format:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">bundle-name</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">filters</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sass,cssutils</span>
    <span class="l-Scalar-Plain">output</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">cache/default.css</span>
    <span class="l-Scalar-Plain">contents</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">css/jquery.ui.calendar.css</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">css/jquery.ui.slider.css</span>
<span class="l-Scalar-Plain">another-bundle</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>Bundles may reference each other:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">js-all</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">contents</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">jquery.js</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">jquery-ui</span>    <span class="c1"># This is a bundle reference</span>
<span class="l-Scalar-Plain">jquery-ui</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">contents</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jqueryui/*.js</span>
</pre></div>
</div>
<p>If an <tt class="docutils literal"><span class="pre">environment</span></tt> argument is given, it&#8217;s bundles
may be referenced as well. Note that you may pass any
compatibly dict-like object.</p>
<p>Finally, you may also use nesting:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">js-all</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">contents</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">jquery.js</span>
        <span class="c1"># This is a nested bundle</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">contents</span><span class="p-Indicator">:</span> <span class="s">&quot;*.coffee&quot;</span>
          <span class="l-Scalar-Plain">filters</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">coffeescript</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="webassets.loaders.YAMLLoader.load_environment">
<tt class="descname">load_environment</tt><big>(</big><big>)</big><a class="headerlink" href="#webassets.loaders.YAMLLoader.load_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Load an <tt class="xref py py-class docutils literal"><span class="pre">Environment</span></tt> instance defined in the YAML file.</p>
<p>Expects the following format:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">directory</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../static</span>
<span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/media</span>
<span class="l-Scalar-Plain">debug</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
<span class="l-Scalar-Plain">updater</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">timestamp</span>
<span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">compass_bin</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/opt/compass</span>
    <span class="l-Scalar-Plain">another_custom_config_value</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">foo</span>

<span class="l-Scalar-Plain">bundles</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>All values, including <tt class="docutils literal"><span class="pre">directory</span></tt> and <tt class="docutils literal"><span class="pre">url</span></tt> are optional. The
syntax for defining bundles is the same as for
<a class="reference internal" href="index.html#webassets.loaders.YAMLLoader.load_bundles" title="webassets.loaders.YAMLLoader.load_bundles"><tt class="xref py py-meth docutils literal"><span class="pre">load_bundles()</span></tt></a>.</p>
<p>Sample usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webassets.loaders</span> <span class="kn">import</span> <span class="n">YAMLLoader</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">YAMLLoader</span><span class="p">(</span><span class="s">&#39;asset.yml&#39;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_environment</span><span class="p">()</span>

<span class="n">env</span><span class="p">[</span><span class="s">&#39;some-bundle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">urls</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="webassets.loaders.PythonLoader">
<em class="property">class </em><tt class="descclassname">webassets.loaders.</tt><tt class="descname">PythonLoader</tt><big>(</big><em>module_name</em><big>)</big><a class="headerlink" href="#webassets.loaders.PythonLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Basically just a simple helper to import a Python file and
retrieve the bundles defined there.</p>
<dl class="method">
<dt id="webassets.loaders.PythonLoader.load_bundles">
<tt class="descname">load_bundles</tt><big>(</big><big>)</big><a class="headerlink" href="#webassets.loaders.PythonLoader.load_bundles" title="Permalink to this definition">¶</a></dt>
<dd><p>Load <tt class="docutils literal"><span class="pre">Bundle</span></tt> objects defined in the Python module.</p>
<p>Collects all bundles in the global namespace.</p>
</dd></dl>

<dl class="method">
<dt id="webassets.loaders.PythonLoader.load_environment">
<tt class="descname">load_environment</tt><big>(</big><big>)</big><a class="headerlink" href="#webassets.loaders.PythonLoader.load_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Load an <tt class="docutils literal"><span class="pre">Environment</span></tt> defined in the Python module.</p>
<p>Expects as default a global name <tt class="docutils literal"><span class="pre">environment</span></tt> to be defined,
or overriden by passing a string <tt class="docutils literal"><span class="pre">module:environent</span></tt> to the
constructor.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-integration/index"></span><div class="section" id="integration-with-other-libraries">
<h3>Integration with other libraries<a class="headerlink" href="#integration-with-other-libraries" title="Permalink to this headline">¶</a></h3>
<p>While the <em>webassets</em> core is designed to work with any WSGI application,
also included are some additional utilities for some popular frameworks
and libraries.</p>
<div class="toctree-wrapper compound">
<span id="document-integration/jinja2"></span><div class="section" id="jinja2">
<h4>Jinja2<a class="headerlink" href="#jinja2" title="Permalink to this headline">¶</a></h4>
<p>A Jinja2 extension is available as <tt class="docutils literal"><span class="pre">webassets.ext.jinja2.AssetsExtension</span></tt>.
It will provide a <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">assets</span> <span class="pre">%}</span></tt> tag which allows you to reference your
bundles from within a template to render its urls.</p>
<p>It also allows you to create bundles on-the-fly, thus making it possible
to define your assets entirly within your templates.</p>
<p>If you are using Jinja2 inside of Django, see
<a class="reference external" href="http://elsdoerfer.name/docs/django-assets/jinja2.html">this page</a>.</p>
<div class="section" id="setting-up-the-extension">
<h5>Setting up the extension<a class="headerlink" href="#setting-up-the-extension" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span> <span class="k">as</span> <span class="n">Jinja2Environment</span>
<span class="kn">from</span> <span class="nn">webassets</span> <span class="kn">import</span> <span class="n">Environment</span> <span class="k">as</span> <span class="n">AssetsEnvironment</span>
<span class="kn">from</span> <span class="nn">webassets.ext.jinja2</span> <span class="kn">import</span> <span class="n">AssetsExtension</span>

<span class="n">assets_env</span> <span class="o">=</span> <span class="n">AssetsEnvironment</span><span class="p">(</span><span class="s">&#39;./static/media&#39;</span><span class="p">,</span> <span class="s">&#39;/media&#39;</span><span class="p">)</span>
<span class="n">jinja2_env</span> <span class="o">=</span> <span class="n">Jinja2Environment</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="n">AssetsExtension</span><span class="p">])</span>
<span class="n">jinja2_env</span><span class="o">.</span><span class="n">assets_environment</span> <span class="o">=</span> <span class="n">assets_env</span>
</pre></div>
</div>
<p>After adding the extension to your Jinja 2 environment, you need to
make sure that it knows about your <tt class="docutils literal"><span class="pre">webassets.Environment</span></tt> instance.
This is done by setting the <tt class="docutils literal"><span class="pre">assets_environment</span></tt> attribute.</p>
</div>
<div class="section" id="using-the-tag">
<h5>Using the tag<a class="headerlink" href="#using-the-tag" title="Permalink to this headline">¶</a></h5>
<p>To output a bundle that has been registered with the environment, simply
pass its name to the tag:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="s2">&quot;all_js&quot;</span><span class="o">,</span> <span class="s2">&quot;ie_js&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;script type=&quot;text/javascript&quot; src=&quot;</span><span class="cp">{{</span> <span class="nv">ASSET_URL</span> <span class="cp">}}</span><span class="x">&quot;&gt;&lt;/script&gt;</span>
<span class="cp">{%</span> <span class="k">endassets</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>The tag will repeatedly output its content for each <tt class="docutils literal"><span class="pre">ASSET_URL</span></tt> of each
bundle. In the above case, that might be the output urls of the <em>all_js</em>
and <em>ie_js</em> bundles, or, in debug mode, urls referencing the source files
of both bundles.</p>
<p>If you pass something to the tag that isn&#8217;t a known bundle name, it will
be considered a filename. This allows you to define a bundle entirely
within your templates:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">filters</span><span class="o">=</span><span class="s2">&quot;cssmin,datauri&quot;</span><span class="o">,</span> <span class="nv">output</span><span class="o">=</span><span class="s2">&quot;gen/packed.css&quot;</span><span class="o">,</span> <span class="s2">&quot;common/jquery.css&quot;</span><span class="o">,</span> <span class="s2">&quot;site/base.css&quot;</span><span class="o">,</span> <span class="s2">&quot;site/widgets.css&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">...</span>
</pre></div>
</div>
<p>Of course, this means you can combine the two approaches as well. The
following code snippet will merge together the given bundle and the contents
of the <tt class="docutils literal"><span class="pre">jquery.js</span></tt> file that was explicitly passed:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">assets</span> <span class="nv">output</span><span class="o">=</span><span class="s2">&quot;gen/packed.js&quot;</span><span class="o">,</span> <span class="s2">&quot;common/jquery.js&quot;</span><span class="o">,</span> <span class="s2">&quot;my-bundle&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">...</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-faq"></span><div class="section" id="faq">
<span id="id1"></span><h3>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h3>
<div class="section" id="is-there-a-cache-busting-feature">
<h4>Is there a cache-busting feature?<a class="headerlink" href="#is-there-a-cache-busting-feature" title="Permalink to this headline">¶</a></h4>
<p>Yes! See <a class="reference internal" href="index.html#document-expiring"><em>URL Expiry (cache busting)</em></a>.</p>
</div>
<div class="section" id="relative-urls-in-my-css-code-break-if-the-merged-asset-is-written-to-a-different-location-than-the-source-files-how-do-i-fix-this">
<h4>Relative URLs in my CSS code break if the merged asset is written to a different location than the source files. How do I fix this?<a class="headerlink" href="#relative-urls-in-my-css-code-break-if-the-merged-asset-is-written-to-a-different-location-than-the-source-files-how-do-i-fix-this" title="Permalink to this headline">¶</a></h4>
<p>Use the builtin <a class="reference internal" href="index.html#filters-cssrewrite"><em>cssrewrite</em></a> filter which
will transparently fix <tt class="docutils literal"><span class="pre">url()</span></tt> instructions in CSS files on the fly.</p>
</div>
<div class="section" id="i-am-using-a-css-compiler-and-i-need-its-filter-to-apply-even-in-debug-mode">
<h4>I am using a CSS compiler and I need its filter to apply even in debug mode!<a class="headerlink" href="#i-am-using-a-css-compiler-and-i-need-its-filter-to-apply-even-in-debug-mode" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="index.html#document-css_compilers"><em>CSS compilers</em></a> for how this is best done.</p>
</div>
<div class="section" id="is-google-app-engine-supported">
<h4>Is Google App Engine supported?<a class="headerlink" href="#is-google-app-engine-supported" title="Permalink to this headline">¶</a></h4>
<p>Yes. Due to the way Google App Engine works (static files are stored on
separate servers), you need to build your assets locally, possibly using one
of the management commands provided for your preferred framework, and then
deploy them.</p>
<p>In production mode, you need to disable the <tt class="docutils literal"><span class="pre">Environment.auto_build</span></tt> setting.</p>
<p>For URL expiry functionality, you need to use a manifest that holds version
information. See <a class="reference internal" href="index.html#document-expiring"><em>URL Expiry (cache busting)</em></a>.</p>
<p>There is a barebone Google App Engine example in the
<a class="reference external" href="https://github.com/miracle2k/webassets/blob/master/tests/">examples/appengine/</a>
folder.</p>
</div>
</div>
<span id="document-upgrading"></span><div class="section" id="upgrading">
<h3>Upgrading<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h3>
<p>When upgrading from an older version, you might encounter some backwards
incompatibility. The <tt class="docutils literal"><span class="pre">webassets</span></tt> API is not stable yet.</p>
<div class="section" id="in-0-10">
<h4>In 0.10<a class="headerlink" href="#in-0-10" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">The <tt class="xref py py-class docutils literal"><span class="pre">Resolver</span></tt> API has changed. Rather than being bound to an
environment via the constructor, the individual methods now receive
a <a href="#id1"><span class="problematic" id="id2">``</span></a>ctx` object, which allows access to the environment&#8217;s settings.</p>
<p>See <em class="xref std std-ref">the page on implementing resolvers</em>.</p>
</li>
<li><p class="first">The <tt class="xref py py-meth docutils literal"><span class="pre">Bundle.build()</span></tt> and <tt class="xref py py-meth docutils literal"><span class="pre">Bundle.url()</span></tt> methods no longer accept
an environment argument. To work with a Bundle that is not attached to
an environment already, use the following syntax instead:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">bundle</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
    <span class="n">bundle</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">Filters can no longer access a <tt class="docutils literal"><span class="pre">self.env</span></tt> attribute. It has been renamed
to <tt class="docutils literal"><span class="pre">self.ctx</span></tt>, which provides a compatible object.</p>
</li>
</ul>
</div>
<div class="section" id="in-0-9">
<h4>In 0.9<a class="headerlink" href="#in-0-9" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Python 2.5 is no longer supported.</li>
<li>The API of the BaseCache.get() method has changed. It no longer receives
a <tt class="docutils literal"><span class="pre">python</span></tt> keyword argument. This only affects you if you have
implemented a custom cache class.</li>
</ul>
</div>
<div class="section" id="in-0-8">
<h4>In 0.8<a class="headerlink" href="#in-0-8" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first"><strong>django-assets is no longer included!</strong>
You need to install it&#8217;s package separately. See the current
<a class="reference external" href="https://github.com/miracle2k/django-assets">development version</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When upgrading, you need to take extra care to rid yourself of the old
version of webassets before installing the separate <tt class="docutils literal"><span class="pre">django-assets</span></tt>
package. This is to avoid that Python still finds the old <tt class="docutils literal"><span class="pre">django_assets</span></tt>
module that used to be included with <tt class="docutils literal"><span class="pre">webassets</span></tt>.</p>
<p>In some cases, even <tt class="docutils literal"><span class="pre">pip</span> <span class="pre">uninstall</span> <span class="pre">webassets</span></tt> is not enough, and old
<tt class="docutils literal"><span class="pre">*.pyc</span></tt> files are kept around. I recommend that you delete your old
webassets install manually from the filesystem. To find out where it is
stored, open a Python shell and do:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">webassets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">webassets</span>
<span class="go">&lt;module &#39;webassets&#39; from &#39;/usr/local/lib/python2.7/dist-packages/webassets/src/webassets/__init__.pyc&#39;&gt;</span>
</pre></div>
</div>
</div>
</li>
<li><p class="first">Some filters now run in debug mode. Specifically, there are two things that
deserve mention:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">cssrewrite</span></tt> now runs when <tt class="docutils literal"><span class="pre">debug=&quot;merge&quot;</span></tt>. This is always what is
wanted; it was essentially a bug that this didn&#8217;t happen before.</p>
</li>
<li><p class="first">All kinds of compiler-style filters (Sass, less, Coffeescript, JST
templates etc). all now run in debug mode. The presence of such a filter
causes bundles to be merged even while <tt class="docutils literal"><span class="pre">debug=True</span></tt>.</p>
<p>In practice, if you&#8217;ve been using custom bundle <tt class="docutils literal"><span class="pre">debug</span></tt> values to get
such compilers to run, this will continue to work. Though it can now be
simplified. Code like this:</p>
<div class="highlight-python"><div class="highlight"><pre>Bundle(
    Bundle(&#39;*.coffee&#39;, filters=&#39;coffeescript&#39;, debug=False)
    filters=&#39;jsmin&#39;)
</pre></div>
</div>
<p>can be replaced with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;*.coffee&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s">&#39;coffeescript,jsmin&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>which has the same effect, which is that during debugging, Coffeescript
will be compiled, but not minimized. This also allows you to define bundles
that use compilers from within the templates tags, because nesting is no
longer necessary.</p>
<p>However, if you need to combine Coffeescript files (or other files needing
compiling) with regular CSS or JS files, nesting is still required:</p>
<div class="highlight-python"><div class="highlight"><pre>Bundle(&#39;*.js&#39;
       Bundle(&#39;*.coffee&#39;, filters=&#39;coffeescript&#39;),
       filters=&#39;jsmin&#39;)
</pre></div>
</div>
<p>If for some reason you do not want these compilers to run, you may still
use a manual <tt class="docutils literal"><span class="pre">debug</span></tt> value to override the behavior. A case where this
is useful is the <tt class="docutils literal"><span class="pre">less</span></tt> filter, which can be compiled in the browser:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bundle</span><span class="p">(</span><span class="s">&#39;*.less&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s">&#39;less&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, as long as the environment is in debug mode, the bundle will output
the source urls, despite the <tt class="docutils literal"><span class="pre">less</span></tt> filter normally forcing a merge.</p>
</li>
</ul>
<p>As part of this new feature, the handling of nested bundle debug values
has changed such that in rare cases you may see a different outcome. In
the unlikely case that you are using these a lot, the rule is simple: The
debug level can only ever be decreased. Child bundles cannot cannot do
&#8220;more debugging&#8221; than their parent, and if  <tt class="docutils literal"><span class="pre">Environment.debug=False</span></tt>,
all bundle debug values are effectively ignored.</p>
</li>
<li><p class="first">The internal class names of filters have been renamed. For example,
<tt class="docutils literal"><span class="pre">JSMinFilter</span></tt> is now simply <tt class="docutils literal"><span class="pre">JSMin</span></tt>. This only affects you if you
reference these classes directly, rather than using their id (such as
<tt class="docutils literal"><span class="pre">jsmin</span></tt>), which should be rare.</p>
</li>
<li><p class="first">Removed the previously deprecated <tt class="docutils literal"><span class="pre">rebuild</span></tt> alias for the <tt class="docutils literal"><span class="pre">build</span></tt> command.</p>
</li>
<li><p class="first">Subtly changed how the <tt class="docutils literal"><span class="pre">auto_build</span></tt> setting affects the
<tt class="xref py py-meth docutils literal"><span class="pre">Bundle.build()</span></tt> method: It doesn&#8217;t anymore. Instead, the setting now
only works on the level of <tt class="xref py py-meth docutils literal"><span class="pre">Bundle.urls()</span></tt>. The new behaviour is more
consistent, makes more sense, and simplifies the code.</p>
<p>The main backwards-incompatiblity caused by this is that when
<tt class="docutils literal"><span class="pre">environment.auto_build=False</span></tt>, and you are calling <tt class="docutils literal"><span class="pre">bundle.build()</span></tt>
without specifying an explicit <tt class="docutils literal"><span class="pre">force</span></tt> argument, it used to be the case
that <tt class="docutils literal"><span class="pre">force=True</span></tt> was assumed, i.e. the bundle was built without looking
at the timestamps to see if a rebuild is necessary. Now, the timestamps will
be checked, unless <tt class="docutils literal"><span class="pre">force=True</span></tt> is explicitly given.</p>
<p>In case you don&#8217;t want to pass <tt class="docutils literal"><span class="pre">force=True</span></tt>, you can instead also set
the <tt class="xref py py-attr docutils literal"><span class="pre">Environment.updater</span></tt> property to <tt class="docutils literal"><span class="pre">False</span></tt>; without an updater
to check timestamps, every <tt class="docutils literal"><span class="pre">build()</span></tt> call will act as if <tt class="docutils literal"><span class="pre">force=True</span></tt>.</p>
<p><strong>Note</strong>: This only affects you if you work with the <tt class="xref py py-meth docutils literal"><span class="pre">Bundle.build()</span></tt>
and <tt class="xref py py-meth docutils literal"><span class="pre">Bundle.url()</span></tt> methods directly. The behavior of the command line
interface, or the template tags is not affected.</p>
</li>
<li><p class="first">The implementation of the <tt class="xref py py-class docutils literal"><span class="pre">CommandLineEnvironment</span></tt> has changed, and
each command is now a separate class. If you have been subclassing
<tt class="xref py py-class docutils literal"><span class="pre">CommandLineEnvironment</span></tt> to override individual command methods like
<tt class="xref py py-meth docutils literal"><span class="pre">CommandLineEnvironment.build()</span></tt>, you need to update your code.</p>
</li>
<li><p class="first">The <tt class="xref py py-class docutils literal"><span class="pre">JavaMixin</span></tt> helper class to implement Java-based filters has been
removed, and in it&#8217;s stead there is now a <tt class="xref py py-class docutils literal"><span class="pre">JavaTool</span></tt> base class that
can be used.</p>
</li>
<li><p class="first">The code to resolve bundle contents has been refactored. As a result, the
behavior of the semi-internal method <tt class="xref py py-meth docutils literal"><span class="pre">Bundle.resolve_contents()</span></tt> has
changed slightly; in addition, the
<tt class="xref py py-meth docutils literal"><span class="pre">Environment._normalize_source_path()</span></tt> method used mainly by
extensions like <tt class="docutils literal"><span class="pre">Flask-Assets</span></tt> has been removed. Instead, extensions now
need to implement a custom <tt class="xref py py-class docutils literal"><span class="pre">Resolver</span></tt>. The
<tt class="xref py py-class docutils literal"><span class="pre">Evironment.absurl</span></tt> method has also disappeared, and replacing it
can now be done via a custom <tt class="xref py py-class docutils literal"><span class="pre">Resolver`</span></tt> class.</p>
</li>
<li><p class="first"><tt class="xref py py-attr docutils literal"><span class="pre">Environment.directory</span></tt> now always returns an absolute path; if a
relative path is stored, it is based off on the current working directory.
This spares <em>a lot</em> of calls to <tt class="docutils literal"><span class="pre">os.abspath</span></tt> throughout the code. If you
need the original value you can always use
<tt class="docutils literal"><span class="pre">environment.config['directory']</span></tt>.</p>
</li>
<li><p class="first">If the <tt class="docutils literal"><span class="pre">JST_COMPILER</span></tt> option of the <tt class="docutils literal"><span class="pre">jst</span></tt> filter is set to <tt class="docutils literal"><span class="pre">False</span></tt>
(as opposed to the default value, <tt class="docutils literal"><span class="pre">None</span></tt>), the templates will now be
output as raw strings. Before, <tt class="docutils literal"><span class="pre">False</span></tt> behaved like <tt class="docutils literal"><span class="pre">None</span></tt> and used
the builtin compiler.</p>
</li>
<li><p class="first">The API of the <tt class="docutils literal"><span class="pre">concat()</span></tt> filter method has changed. Instead of a
list of hunks, it is now given a list of 2-tuples of
<tt class="docutils literal"><span class="pre">(hunk,</span> <span class="pre">info_dict)</span></tt>.</p>
</li>
<li><p class="first">The internal <tt class="docutils literal"><span class="pre">JSTTemplateFilter</span></tt> base class has changed API.
- concat filter
- jst handlebar filters have changed, use concat, base class has changed</p>
</li>
</ul>
</div>
<div class="section" id="in-0-7">
<h4>In 0.7<a class="headerlink" href="#in-0-7" title="Permalink to this headline">¶</a></h4>
<p>There are some significant backwards incompatible changes in this release.</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">Environment.updater</span></tt> property (corresponds to the
<tt class="docutils literal"><span class="pre">ASSETS_UPDATER</span></tt> setting) can no longer be set to <tt class="docutils literal"><span class="pre">False</span></tt> or
<tt class="docutils literal"><span class="pre">&quot;never&quot;</span></tt> in order to disable the automatic rebuilding. Instead, this
now needs to be done using <tt class="docutils literal"><span class="pre">Environment.auto_build</span></tt>, or the corresponding
<tt class="docutils literal"><span class="pre">ASSETS_AUTO_BUILD</span></tt> setting.</li>
<li>The <tt class="docutils literal"><span class="pre">Environment.expire</span></tt> (<tt class="docutils literal"><span class="pre">ASSETS_EXPIRE</span></tt>) option as been renamed to
<tt class="docutils literal"><span class="pre">Environment.url_expire</span></tt> (<tt class="docutils literal"><span class="pre">ASSETS_URL_EXPIRE</span></tt>), and the default value
is now <tt class="docutils literal"><span class="pre">True</span></tt>.</li>
<li>To disable automatic building, set the new <tt class="docutils literal"><span class="pre">Environment.auto_build</span></tt>
(<tt class="docutils literal"><span class="pre">ASSETS_AUTO_BUILD</span></tt>) option to <tt class="docutils literal"><span class="pre">False</span></tt>. Before, this was done via
the <tt class="docutils literal"><span class="pre">Environment.updater</span></tt>, which is now deprecated.</li>
</ul>
<p>Other changes:</p>
<ul class="simple">
<li>If <tt class="docutils literal"><span class="pre">Environment.auto_build</span></tt> is disabled, the API of Bundle.build()
now assumes a default value of <tt class="docutils literal"><span class="pre">True</span></tt> for the <tt class="docutils literal"><span class="pre">force</span></tt> argument.
This should not cause any problems, since it is the only call signature
that really makes sense in this case.</li>
<li>The former <tt class="docutils literal"><span class="pre">less</span></tt> filter, based on the old Ruby version of lessCSS
(still available as the 1.x Ruby gems, but no longer developed) has been
renamed <tt class="docutils literal"><span class="pre">less_ruby</span></tt>, and <tt class="docutils literal"><span class="pre">less</span></tt> now uses the new NodeJS/Javascript
implementation, which a while ago superseded the Ruby one.</li>
<li>The <tt class="docutils literal"><span class="pre">rebuild</span></tt> command (of the command line mode) has been renamed to
<tt class="docutils literal"><span class="pre">build</span></tt>.</li>
<li>The command line interface now requires the external dependency
<tt class="docutils literal"><span class="pre">argparse</span></tt> on Python versions 2.6 and before. <tt class="docutils literal"><span class="pre">argparse</span></tt> is included
with Python starting with version 2.7.</li>
<li><tt class="docutils literal"><span class="pre">PythonLoader.load_bundles()</span></tt> now returns a dict with the bundle names
as keys, rather than a list.</li>
<li>Filters now receive new keyword arguments. The API now officially requires
filters to accept arbitrary <tt class="docutils literal"><span class="pre">**kwargs</span></tt> for compatibility with future
versions. While the documentation has always suggested <tt class="docutils literal"><span class="pre">**kwargs</span></tt> be used,
not all builtin filters followed this rule. Your custom filters may need
updating as well.</li>
<li>Filter classes now longer get an auto-generated name. If you have a custom
filter and have not explicitly given it a name, you need to do this now if
you want to register the filter globally.</li>
<li><tt class="docutils literal"><span class="pre">django_assets</span></tt> no longer tries to load a global <tt class="docutils literal"><span class="pre">assets.py</span></tt> module (it
will still find bundles defined in application-level <tt class="docutils literal"><span class="pre">assets.py</span></tt> files). If
you want to define bundles in other modules, you now need to list those
explicitly in the <em class="xref std std-ref">ASSETS_MODULES</em> setting.</li>
</ul>
</div>
<div class="section" id="in-0-6">
<h4>In 0.6<a class="headerlink" href="#in-0-6" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">Environment.updater</span></tt> class no longer support custom callables.
Instead, you need to subclass <tt class="docutils literal"><span class="pre">BaseUpdater</span></tt>. Nobody is likely to use
this feature though.</li>
<li>The cache is no longer debug-mode only. If you enable
<tt class="docutils literal"><span class="pre">Environment.cache</span></tt> (<tt class="docutils literal"><span class="pre">ASSETS_CACHE</span></tt> in <tt class="docutils literal"><span class="pre">django-assets</span></tt>),
the cache will be enabled regardless of the
<tt class="docutils literal"><span class="pre">Environment.debug</span></tt>/<tt class="docutils literal"><span class="pre">ASSETS_DEBUG</span></tt> option. If you want the old
behavior, you can easily configure it manually.</li>
<li>The <tt class="docutils literal"><span class="pre">Bundle.build</span></tt> method no longer takes the <tt class="docutils literal"><span class="pre">no_filters</span></tt>
argument. This was always intended for internal use and its existence
not advertised, so its removal shouldn&#8217;t cause too many problems.</li>
<li>The <tt class="docutils literal"><span class="pre">Bundle.build</span></tt> method now returns a list of <tt class="docutils literal"><span class="pre">FileHunk</span></tt> objects,
rather than a single one. It now works for container bundles (bundles
which only have other bundles for children, not files), rather than
raising an exception.</li>
<li>The <tt class="docutils literal"><span class="pre">rebuild</span></tt> command now ignores a <tt class="docutils literal"><span class="pre">debug=False</span></tt> setting, and
forces a build in production mode instead.</li>
</ul>
</div>
<div class="section" id="in-0-4">
<h4>In 0.4<a class="headerlink" href="#in-0-4" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Within <tt class="docutils literal"><span class="pre">django_assets</span></tt>. the semantics of the <tt class="docutils literal"><span class="pre">debug</span></tt> setting have
changed again. It once again allows you to specifically enable debug mode
for the assets handling, irrespective of Django&#8217;s own <tt class="docutils literal"><span class="pre">DEBUG</span></tt> setting.</li>
<li><tt class="docutils literal"><span class="pre">RegistryError</span></tt> is now <tt class="docutils literal"><span class="pre">RegisterError</span></tt>.</li>
<li>The <tt class="docutils literal"><span class="pre">ASSETS_AUTO_CREATE</span></tt> option no longer exists. Instead, automatic
creation of bundle output files is now bound to the <tt class="docutils literal"><span class="pre">ASSETS_UPDATER</span></tt>
setting. If it is <tt class="docutils literal"><span class="pre">False</span></tt>, i.e. automatic updating is disabled, then
assets won&#8217;t be automatically created either.</li>
</ul>
</div>
<div class="section" id="in-0-2">
<h4>In 0.2<a class="headerlink" href="#in-0-2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The filter API has changed. Rather than defining an <tt class="docutils literal"><span class="pre">apply</span></tt> method and
optionally an <tt class="docutils literal"><span class="pre">is_source_filter</span></tt> attribute, those now have been replaced
by <tt class="docutils literal"><span class="pre">input()</span></tt> and <tt class="docutils literal"><span class="pre">output()</span></tt> methods. As a result, a single filter can
now act as both an input and an output filter.</li>
</ul>
</div>
<div class="section" id="in-0-1">
<h4>In 0.1<a class="headerlink" href="#in-0-1" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">The semantics of the <tt class="docutils literal"><span class="pre">ASSETS_DEBUG</span></tt> setting have changed. In 0.1,
setting this to <tt class="docutils literal"><span class="pre">True</span></tt> meant <em>enable the django-assets debugging mode</em>.
However, <tt class="docutils literal"><span class="pre">django-assets</span></tt> now follows the default Django <tt class="docutils literal"><span class="pre">DEBUG</span></tt>
setting, and <tt class="docutils literal"><span class="pre">ASSETS_DEBUG</span></tt> should be understood as meaning <em>how to
behave when in debug mode</em>. See <em class="xref std std-ref">ASSETS_DEBUG</em>
for more information.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">ASSETS_AUTO_CREATE</span></tt> now causes an error to be thrown if due it it
being disabled a file cannot be created. Previously, it caused
the source files to be linked directly (as if debug mode were active).</p>
<p>This was done due to <tt class="docutils literal"><span class="pre">Explicit</span> <span class="pre">is</span> <span class="pre">better</span> <span class="pre">than</span> <span class="pre">implicit</span></tt>, and for
security considerations; people might trusting their comments to be
removed. If it turns out to be necessary, the functionality to fall
back to source could be added again in a future version through a
separate setting.</p>
</li>
<li><p class="first">The YUI Javascript filter can no longer be referenced via <tt class="docutils literal"><span class="pre">yui</span></tt>.
Instead, you need to explicitly specify which filter you want to use,
<tt class="docutils literal"><span class="pre">yui_js</span></tt> or <tt class="docutils literal"><span class="pre">yui_css</span></tt>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009, 2010, Michael Elsdörfer.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/latest/">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//readthedocs.org/projects/webassets/downloads/pdf/latest/">pdf</a></dd>
        
          <dd><a href="//readthedocs.org/projects/webassets/downloads/htmlzip/latest/">htmlzip</a></dd>
        
          <dd><a href="//readthedocs.org/projects/webassets/downloads/epub/latest/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/webassets/?fromdocs=webassets">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/webassets/?fromdocs=webassets">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.11.dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
